import{j as s,c as i,b as a,aa as e}from"./chunks/framework.Cst8pIsI.js";const g=JSON.parse('{"title":"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸ƒï¼šå»¶è¿Ÿå‡½æ•°è°ƒç”¨Defer","description":"","frontmatter":{"sidebar":false,"cover":"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover1-slices.jpeg","date":"2022-07-13T00:00:00.000Z","tag":["Go","ç¼–ç¨‹åŸºç¡€"],"sticky":1,"prev":{"text":"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—å…­ï¼šäº’æ–¥é”mutex","link":"/posts/programming/go/mutex"},"head":[]},"headers":[],"relativePath":"posts/programming/go/defer.md","filePath":"posts/programming/go/defer.md","lastUpdated":1738671020000}'),n={name:"posts/programming/go/defer.md"},p=e(`<h1 id="go-åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸ƒ-å»¶è¿Ÿå‡½æ•°è°ƒç”¨defer" tabindex="-1">Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸ƒï¼šå»¶è¿Ÿå‡½æ•°è°ƒç”¨Defer <a class="header-anchor" href="#go-åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸ƒ-å»¶è¿Ÿå‡½æ•°è°ƒç”¨defer" aria-label="Permalink to &quot;Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸ƒï¼šå»¶è¿Ÿå‡½æ•°è°ƒç”¨Defer&quot;">â€‹</a></h1><p><code>defer</code>è¯­å¥ç”¨äºå»¶è¿Ÿå‡½æ•°çš„è°ƒç”¨ï¼Œæ¯æ¬¡<code>defer</code>éƒ½ä¼šæŠŠä¸€ä¸ªå‡½æ•°å‹å…¥æ ˆä¸­ï¼Œå‡½æ•°è¿”å›å‰å†æŠŠå»¶è¿Ÿçš„å‡½æ•°å–å‡ºå¹¶æ‰§è¡Œã€‚</p><p>ä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬æŠŠåˆ›å»º<code>defer</code>çš„å‡½æ•°ç§°ä¸ºä¸»å‡½æ•°ï¼Œ<code>defer</code>è¯­å¥åé¢çš„å‡½æ•°ç§°ä¸ºå»¶è¿Ÿå‡½æ•°ã€‚</p><p>å»¶è¿Ÿå‡½æ•°å¯èƒ½æœ‰è¾“å…¥å‚æ•°ï¼Œè¿™äº›å‚æ•°å¯èƒ½æ¥æºäºå®šä¹‰<code>defer</code>çš„å‡½æ•°ï¼Œå»¶è¿Ÿå‡½æ•°ä¹Ÿå¯èƒ½å¼•ç”¨ä¸»å‡½æ•°ç”¨äºè¿”å›çš„å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´å»¶è¿Ÿå‡½æ•°å¯èƒ½ä¼šå½±å“ä¸»å‡½æ•°çš„ä¸€äº›è¡Œä¸ºï¼Œè¿™äº›åœºæ™¯ä¸‹ï¼Œå¦‚æœä¸äº†è§£<code>defer</code>çš„è§„åˆ™å¾ˆå®¹æ˜“å‡ºé”™ã€‚</p><h2 id="è§„åˆ™ä¸€-å»¶è¿Ÿå‡½æ•°çš„å‚æ•°åœ¨deferè¯­å¥å‡ºç°æ—¶å°±å·²ç»ç¡®å®š" tabindex="-1">è§„åˆ™ä¸€ï¼šå»¶è¿Ÿå‡½æ•°çš„å‚æ•°åœ¨deferè¯­å¥å‡ºç°æ—¶å°±å·²ç»ç¡®å®š <a class="header-anchor" href="#è§„åˆ™ä¸€-å»¶è¿Ÿå‡½æ•°çš„å‚æ•°åœ¨deferè¯­å¥å‡ºç°æ—¶å°±å·²ç»ç¡®å®š" aria-label="Permalink to &quot;è§„åˆ™ä¸€ï¼šå»¶è¿Ÿå‡½æ•°çš„å‚æ•°åœ¨deferè¯­å¥å‡ºç°æ—¶å°±å·²ç»ç¡®å®š&quot;">â€‹</a></h2><p>å®˜æ–¹ç»™å‡ºä¸€ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    defer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>defer</code>è¯­å¥ä¸­çš„<code>fmt.Println()</code>å‚æ•°iå€¼åœ¨<code>defer</code>å‡ºç°æ—¶å°±å·²ç»ç¡®å®šä¸‹æ¥ï¼Œå®é™…ä¸Šæ˜¯æ‹·è´äº†ä¸€ä»½ã€‚åé¢å¯¹å˜é‡<code>i</code>çš„ä¿®æ”¹ä¸ä¼šå½±å“<code>fmt.Println()</code>å‡½æ•°çš„æ‰§è¡Œï¼Œä»ç„¶æ‰“å°<code>0</code>ã€‚</p><div class="warning custom-block"><p class="custom-block-title">æ³¨æ„ğŸ“¢ï¼š</p><p>å¯¹äºæŒ‡é’ˆç±»å‹å‚æ•°ï¼Œè§„åˆ™ä»ç„¶é€‚ç”¨ï¼Œåªä¸è¿‡å»¶è¿Ÿå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªåœ°å€å€¼ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ<code>defer</code>åé¢çš„è¯­å¥å¯¹å˜é‡çš„ä¿®æ”¹å¯èƒ½ä¼šå½±å“å»¶è¿Ÿå‡½æ•°ã€‚</p></div><div class="important custom-block github-alert"><p class="custom-block-title">ä¾‹å­ä¸€</p><p></p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> deferFuncParameter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aInt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  defer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aInt)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  aInt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>é¢˜ç›®è¯´æ˜ï¼šå‡½æ•°<code>deferFuncParameter()</code>å®šä¹‰ä¸€ä¸ªæ•´å‹å˜é‡å¹¶åˆå§‹åŒ–ä¸º<code>1</code>ï¼Œç„¶åä½¿ç”¨<code>defer</code>è¯­å¥æ‰“å°å‡ºå˜é‡å€¼ï¼Œæœ€åä¿®æ”¹å˜é‡å€¼ä¸º<code>2</code>.</p><p>å‚è€ƒç­”æ¡ˆï¼šè¾“å‡º<code>1</code>ã€‚å»¶è¿Ÿå‡½æ•°<code>fmt.Println(aInt)</code>çš„å‚æ•°åœ¨<code>defer</code>è¯­å¥å‡ºç°æ—¶å°±å·²ç»ç¡®å®šäº†ï¼Œæ‰€ä»¥æ— è®ºåé¢å¦‚ä½•ä¿®æ”¹<code>aInt</code>å˜é‡éƒ½ä¸ä¼šå½±å“å»¶è¿Ÿå‡½æ•°ã€‚</p></div><p>æˆ‘ä»¬å†æ¥çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼š</p><div class="important custom-block github-alert"><p class="custom-block-title">ä¾‹å­äºŒ</p><p></p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> printArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">array</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> array {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(array[i])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> deferFuncParameter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aArray </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  defer</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> printArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aArray)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  aArray[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  deferFuncParameter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å‡½æ•°è¯´æ˜ï¼šå‡½æ•°<code>deferFuncParameter()</code>å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œé€šè¿‡<code>defer</code>å»¶è¿Ÿå‡½æ•°<code>printArray()</code>çš„è°ƒç”¨ï¼Œæœ€åä¿®æ”¹æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚<code>printArray()</code>å‡½æ•°æ¥å—æ•°ç»„çš„æŒ‡é’ˆå¹¶æŠŠæ•°ç»„å…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚</p><p>å‚è€ƒç­”æ¡ˆï¼šè¾“å‡º<code>10ã€2ã€3</code>ä¸‰ä¸ªå€¼ã€‚å»¶è¿Ÿå‡½æ•°<code>printArray()</code>çš„å‚æ•°åœ¨<code>defer</code>è¯­å¥å‡ºç°æ—¶å°±å·²ç»ç¡®å®šäº†ï¼Œå³æ•°ç»„çš„åœ°å€ï¼Œç”±äºå»¶è¿Ÿå‡½æ•°æ‰§è¡Œæ—¶æœºæ˜¯åœ¨returnè¯­å¥ä¹‹å‰ï¼Œæ‰€ä»¥å¯¹æ•°ç»„çš„æœ€ç»ˆä¿®æ”¹å€¼ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚</p></div><h2 id="è§„åˆ™äºŒ-å»¶è¿Ÿå‡½æ•°æ‰§è¡ŒæŒ‰åè¿›å…ˆå‡ºé¡ºåºæ‰§è¡Œ-å³å…ˆå‡ºç°çš„deferæœ€åæ‰§è¡Œ" tabindex="-1">è§„åˆ™äºŒï¼šå»¶è¿Ÿå‡½æ•°æ‰§è¡ŒæŒ‰åè¿›å…ˆå‡ºé¡ºåºæ‰§è¡Œï¼Œå³å…ˆå‡ºç°çš„<code>defer</code>æœ€åæ‰§è¡Œ <a class="header-anchor" href="#è§„åˆ™äºŒ-å»¶è¿Ÿå‡½æ•°æ‰§è¡ŒæŒ‰åè¿›å…ˆå‡ºé¡ºåºæ‰§è¡Œ-å³å…ˆå‡ºç°çš„deferæœ€åæ‰§è¡Œ" aria-label="Permalink to &quot;è§„åˆ™äºŒï¼šå»¶è¿Ÿå‡½æ•°æ‰§è¡ŒæŒ‰åè¿›å…ˆå‡ºé¡ºåºæ‰§è¡Œï¼Œå³å…ˆå‡ºç°çš„\`defer\`æœ€åæ‰§è¡Œ&quot;">â€‹</a></h2><p>è¿™ä¸ªè§„åˆ™å¾ˆå¥½ç†è§£ï¼Œå®šä¹‰<code>defer</code>ç±»ä¼¼äºå…¥æ ˆæ“ä½œï¼Œæ‰§è¡Œ<code>defer</code>ç±»ä¼¼äºå‡ºæ ˆæ“ä½œã€‚</p><p>è®¾è®¡<code>defer</code>çš„åˆè¡·æ˜¯ç®€åŒ–å‡½æ•°è¿”å›æ—¶èµ„æºæ¸…ç†çš„åŠ¨ä½œï¼Œèµ„æºå¾€å¾€æœ‰ä¾èµ–é¡ºåºï¼Œæ¯”å¦‚å…ˆç”³è¯·<code>A</code>èµ„æºï¼Œå†è·Ÿæ®<code>A</code>èµ„æºç”³è¯·<code>B</code>èµ„æºï¼Œè·Ÿæ®<code>B</code>èµ„æºç”³è¯·<code>C</code>èµ„æºï¼Œå³ç”³è¯·é¡ºåºæ˜¯:<code>Aâ€”&gt;Bâ€”&gt;C</code>ï¼Œé‡Šæ”¾æ—¶å¾€å¾€åˆè¦åå‘è¿›è¡Œã€‚è¿™å°±æ˜¯<code>defer</code>è®¾è®¡æˆFIFOçš„åŸå› ã€‚</p><p>æ¯ç”³è¯·åˆ°ä¸€ä¸ªç”¨å®Œéœ€è¦é‡Šæ”¾çš„èµ„æºæ—¶ï¼Œç«‹å³å®šä¹‰ä¸€ä¸ª<code>defer</code>æ¥é‡Šæ”¾èµ„æºæ˜¯ä¸ªå¾ˆå¥½çš„ä¹ æƒ¯ã€‚</p><h2 id="è§„åˆ™ä¸‰-å»¶è¿Ÿå‡½æ•°å¯èƒ½æ“ä½œä¸»å‡½æ•°çš„å…·åè¿”å›å€¼" tabindex="-1">è§„åˆ™ä¸‰ï¼šå»¶è¿Ÿå‡½æ•°å¯èƒ½æ“ä½œä¸»å‡½æ•°çš„å…·åè¿”å›å€¼ <a class="header-anchor" href="#è§„åˆ™ä¸‰-å»¶è¿Ÿå‡½æ•°å¯èƒ½æ“ä½œä¸»å‡½æ•°çš„å…·åè¿”å›å€¼" aria-label="Permalink to &quot;è§„åˆ™ä¸‰ï¼šå»¶è¿Ÿå‡½æ•°å¯èƒ½æ“ä½œä¸»å‡½æ•°çš„å…·åè¿”å›å€¼&quot;">â€‹</a></h2><p>å®šä¹‰<code>defer</code>çš„å‡½æ•°ï¼Œå³ä¸»å‡½æ•°å¯èƒ½æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼æœ‰æ²¡æœ‰åå­—æ²¡æœ‰å…³ç³»ï¼Œ<code>defer</code>æ‰€ä½œç”¨çš„å‡½æ•°ï¼Œå³å»¶è¿Ÿå‡½æ•°å¯èƒ½ä¼šå½±å“åˆ°è¿”å›å€¼ã€‚</p><p>è‹¥è¦ç†è§£å»¶è¿Ÿå‡½æ•°æ˜¯å¦‚ä½•å½±å“ä¸»å‡½æ•°è¿”å›å€¼çš„ï¼Œåªè¦æ˜ç™½å‡½æ•°æ˜¯å¦‚ä½•è¿”å›çš„å°±è¶³å¤Ÿäº†ã€‚</p>`,19),t=[p];function l(h,k,d,r,c,o){return a(),i("div",null,t)}const y=s(n,[["render",l]]);export{g as __pageData,y as default};
