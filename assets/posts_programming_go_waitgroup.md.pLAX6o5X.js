import{j as s,b as i,c as a,aa as n}from"./chunks/framework._Kr-eMMD.js";const c=JSON.parse('{"title":"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰: ç­‰å¾…ç»„waitGroup","description":"","frontmatter":{"sidebar":false,"cover":"https://hyper2t.github.io/waitgroup/featured-image.jpeg","date":"2022-07-04T00:00:00.000Z","tag":["Go","ç¼–ç¨‹åŸºç¡€"],"sticky":1,"prev":{"text":"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—äºŒ: åç¨‹","link":"/posts/programming/go/goroutine"},"next":{"text":"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—å››ï¼šæ¥å£interface","link":"/posts/programming/go/interface"},"head":[]},"headers":[],"relativePath":"posts/programming/go/waitgroup.md","filePath":"posts/programming/go/waitgroup.md","lastUpdated":1714400951000}'),t={name:"posts/programming/go/waitgroup.md"},e=n(`<h1 id="go-åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰-ç­‰å¾…ç»„waitgroup" tabindex="-1">Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰: ç­‰å¾…ç»„waitGroup <a class="header-anchor" href="#go-åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰-ç­‰å¾…ç»„waitgroup" aria-label="Permalink to &quot;Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰: ç­‰å¾…ç»„waitGroup&quot;">â€‹</a></h1><p>è¿™ç¯‡æ–‡ç« æ€»ç»“äº† Golang çš„çŸ¥è¯†ä½“ç³»: <code>waitGroup</code>ï¼ŒåŒ…æ‹¬å…¶ä¸­çš„åº•å±‚å®ç°ç­‰ç­‰ã€‚</p><p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ­£éœ€è¦çŸ¥é“ <code>goroutine</code> æ˜¯å¦å®Œæˆã€‚è¿™éœ€è¦å€ŸåŠ© <code>sync</code> åŒ…çš„ <code>WaitGroup</code> æ¥å®ç°ã€‚<code>WaitGroup</code> æ˜¯ <code>sync</code> åŒ…ä¸­çš„ä¸€ä¸ª <code>struct</code> ç±»å‹ï¼Œç”¨æ¥æ”¶é›†éœ€è¦ç­‰å¾…æ‰§è¡Œå®Œæˆçš„ <code>goroutine</code>ã€‚ä¸‹é¢æ˜¯å®ƒçš„å®šä¹‰ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WaitGroup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Has unexported fields.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // A WaitGroup waits for a collection of goroutines to finish. The main</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // goroutine calls Add to set the number of goroutines to wait for. Then each</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // of the goroutines runs and calls Done when finished. At the same time, Wait</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // can be used to block until all goroutines have finished.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // A WaitGroup must not be copied after first use.</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">wg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WaitGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">delta</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">wg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WaitGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Done</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">wg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WaitGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wait</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><p>å®ƒæœ‰3ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>Add()</code>ï¼šæ¯æ¬¡æ¿€æ´»æƒ³è¦è¢«ç­‰å¾…å®Œæˆçš„ <code>goroutine</code> ä¹‹å‰ï¼Œå…ˆè°ƒç”¨ <code>Add()</code>ï¼Œç”¨æ¥è®¾ç½®æˆ–æ·»åŠ è¦ç­‰å¾…å®Œæˆçš„ <code>goroutine</code> æ•°é‡ä¾‹å¦‚ <code>Add(2)</code> æˆ–è€…ä¸¤æ¬¡è°ƒç”¨ <code>Add(1)</code> éƒ½ä¼šè®¾ç½®ç­‰å¾…è®¡æ•°å™¨çš„å€¼ä¸º2ï¼Œè¡¨ç¤ºè¦ç­‰å¾…2ä¸ª <code>goroutine</code> å®Œæˆ</li><li><code>Done()</code>ï¼šæ¯æ¬¡éœ€è¦ç­‰å¾…çš„ <code>goroutine</code> åœ¨çœŸæ­£å®Œæˆä¹‹å‰ï¼Œåº”è¯¥è°ƒç”¨è¯¥æ–¹æ³•æ¥äººä¸ºè¡¨ç¤º <code>goroutine</code> å®Œæˆäº†ï¼Œè¯¥æ–¹æ³•ä¼šå¯¹ç­‰å¾…è®¡æ•°å™¨å‡1</li><li><code>Wait()</code>ï¼šåœ¨ç­‰å¾…è®¡æ•°å™¨å‡ä¸º0ä¹‹å‰ï¼Œ<code>Wait()</code> ä¼šä¸€ç›´é˜»å¡å½“å‰çš„ <code>goroutine</code></li></ul><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (  </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sync</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">wg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WaitGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;started Goroutine &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, i)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    time.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.Second)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Goroutine </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ended</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, i)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    wg.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Done</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wg </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WaitGroup</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> no; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        wg.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        go</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    wg.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wait</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;All go routines finished executing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>ä¸Šé¢æ¿€æ´»äº†3ä¸ª <code>goroutine</code>ï¼Œæ¯æ¬¡æ¿€æ´» <code>goroutine</code> ä¹‹å‰ï¼Œéƒ½å…ˆè°ƒç”¨ <code>Add()</code> æ–¹æ³•å¢åŠ ä¸€ä¸ªéœ€è¦ç­‰å¾…çš„ <code>goroutine</code> è®¡æ•°ã€‚æ¯ä¸ª <code>goroutine</code> éƒ½è¿è¡Œ <code>process()</code> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨æ‰§è¡Œå®Œæˆæ—¶éœ€è¦è°ƒç”¨ <code>Done()</code> æ–¹æ³•æ¥è¡¨ç¤º <code>goroutine</code> çš„ç»“æŸã€‚æ¿€æ´»3ä¸ª <code>goroutine</code> åï¼Œ<code>main goroutine</code> ä¼šæ‰§è¡Œåˆ° <code>Wait()</code>ï¼Œç”±äºæ¯ä¸ªæ¿€æ´»çš„ <code>goroutine</code> è¿è¡Œçš„ <code>process()</code> éƒ½éœ€è¦ç¡çœ 2ç§’ï¼Œæ‰€ä»¥ <code>main goroutine</code> åœ¨ <code>Wait()</code> è¿™é‡Œä¼šé˜»å¡ä¸€æ®µæ—¶é—´(å¤§çº¦2ç§’)ï¼Œå½“æ‰€æœ‰ <code>goroutine</code> éƒ½å®Œæˆåï¼Œç­‰å¾…è®¡æ•°å™¨å‡ä¸º0ï¼Œ<code>Wait()</code> å°†ä¸å†é˜»å¡ï¼Œäºæ˜¯ <code>main goroutine</code> å¾—ä»¥æ‰§è¡Œåé¢çš„ <code>Println()</code>ã€‚</p><div class="warning custom-block"><p class="custom-block-title">æ³¨æ„ğŸ“¢ï¼š</p><p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ <code>process()</code> ä¸­ä½¿ç”¨æŒ‡é’ˆç±»å‹çš„ <code>*sync.WaitGroup</code> ä½œä¸ºå‚æ•°ï¼Œè¿™é‡Œä¸èƒ½ä½¿ç”¨å€¼ç±»å‹çš„ <code>sync.WaitGroup</code> ä½œä¸ºå‚æ•°ï¼Œå› ä¸ºè¿™æ„å‘³ç€æ¯ä¸ª<code>goroutine</code>éƒ½æ‹·è´ä¸€ä»½ <code>wg</code>ï¼Œæ¯ä¸ª <code>goroutine</code> éƒ½ä½¿ç”¨è‡ªå·±çš„ <code>wg</code>ã€‚è¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œè¿™3ä¸ª <code>goroutine</code> åº”è¯¥å…±äº«ä¸€ä¸ª <code>wg</code>ï¼Œæ‰èƒ½çŸ¥é“è¿™3ä¸ª <code>goroutine</code> éƒ½å®Œæˆäº†ã€‚å®é™…ä¸Šï¼Œå¦‚æœä½¿ç”¨å€¼ç±»å‹çš„å‚æ•°ï¼Œ<code>main goroutine</code> å°†ä¼šæ°¸ä¹…é˜»å¡è€Œå¯¼è‡´äº§ç”Ÿæ­»é”ã€‚</p></div>`,9),h=[e];function p(k,l,o,d,r,g){return i(),a("div",null,h)}const y=s(t,[["render",p]]);export{c as __pageData,y as default};
