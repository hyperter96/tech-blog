import{j as e,b as i,c as s,aa as a}from"./chunks/framework._Kr-eMMD.js";const F=JSON.parse('{"title":"Client-goç³»åˆ—ä¸€ï¼šClient-goçŸ¥è¯†ä½“ç³»","description":"","frontmatter":{"sidebar":false,"date":"2022-10-02T00:00:00.000Z","tag":["Go","Client-go"],"sticky":1,"next":{"text":"Client-goç³»åˆ—äºŒ: è®¤è¯†ClientSet","link":"/posts/programming/go/client-go/clientset"},"head":[]},"headers":[],"relativePath":"posts/programming/go/client-go/intro.md","filePath":"posts/programming/go/client-go/intro.md","lastUpdated":1714451013000}'),t={name:"posts/programming/go/client-go/intro.md"},n=a(`<h1 id="client-goç³»åˆ—ä¸€-client-goçŸ¥è¯†ä½“ç³»" tabindex="-1">Client-goç³»åˆ—ä¸€ï¼šClient-goçŸ¥è¯†ä½“ç³» <a class="header-anchor" href="#client-goç³»åˆ—ä¸€-client-goçŸ¥è¯†ä½“ç³»" aria-label="Permalink to &quot;Client-goç³»åˆ—ä¸€ï¼šClient-goçŸ¥è¯†ä½“ç³»&quot;">â€‹</a></h1><p>åˆæ­¥è®¤è¯† Client-go ä¸»ä½“æ¡†æ¶.</p><h2 id="å…³äºclient-go" tabindex="-1">å…³äºclient-go <a class="header-anchor" href="#å…³äºclient-go" aria-label="Permalink to &quot;å…³äºclient-go&quot;">â€‹</a></h2><p><code>client-go</code>æ˜¯kuberneteså®˜æ–¹æä¾›çš„goè¯­è¨€çš„å®¢æˆ·ç«¯åº“ï¼Œgoåº”ç”¨ä½¿ç”¨è¯¥åº“å¯ä»¥è®¿é—®kubernetesçš„API Serverï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½é€šè¿‡ç¼–ç¨‹æ¥å¯¹kubernetesèµ„æºè¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œã€‚</p><p>é™¤äº†æä¾›ä¸°å¯Œçš„APIç”¨äºæ“ä½œkubernetesèµ„æºï¼Œ<code>client-go</code>è¿˜ä¸º<code>controller</code>å’Œ<code>operator</code>æä¾›äº†é‡è¦æ”¯æŒï¼Œå¦‚ä¸‹å›¾ï¼Œ<code>client-go</code>çš„<code>informer</code>æœºåˆ¶å¯ä»¥å°†<code>controller</code>å…³æ³¨çš„èµ„æºå˜åŒ–åŠæ—¶å¸¦ç»™æ­¤<code>controller</code>ï¼Œä½¿<code>controller</code>èƒ½å¤ŸåŠæ—¶å“åº”å˜åŒ–ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-image.png" alt="" loading="lazy"></p><p>æˆ‘ä»¬å…ˆæ¥ç„ä¸€çœ¼ <code>client-go</code> çš„ä¸»è¦ä»£ç ç»“æ„ï¼Œæˆ‘ä¼šç»™å‡ºå„ä¸ªä¸»è¦éƒ¨åˆ†çš„æ ¸å¿ƒåŠŸèƒ½è®©å¤§å®¶æœ‰ä¸€ä¸ªæ„Ÿæ€§çš„è®¤è¯†ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tree</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> client-go</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">client-go</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">â”œâ”€â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> discovery</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # åŒ…å«dicoveryClientï¼Œç”¨äºå‘ç°k8sæ‰€æ”¯æŒGVR(Group/Version,/Resource),&#39;kubectl api-resources&#39;å‘½ä»¤æ­£æ˜¯ä½¿ç”¨å®ƒæ¥åˆ—å‡ºclusterä¸­çš„å„ç§èµ„æºã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">â”œâ”€â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dynamic</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # åŒ…å«dynamicClientï¼Œå®ƒå°è£…äº† RESTClientï¼Œå¯ä»¥åŠ¨æ€çš„æŒ‡å®šapièµ„æºçš„GVRï¼Œç»“åˆunstructured.Unstructuredç±»å‹æ¥è®¿é—®å„ç§ç±»å‹çš„k8sèµ„æº(å¦‚: Pod,Deploy...)ï¼Œä¹Ÿå¯ä»¥è®¿é—®ç”¨æˆ·è‡ªå®šä¹‰èµ„æº(CRD)ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">â”œâ”€â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> informers</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # ä¸ºäº†å‡å°‘clientå¯¹äºapiserverçš„é¢‘ç¹è®¿é—®ï¼Œéœ€è¦informeræ¥ç¼“å­˜apiserverä¸­èµ„æºï¼Œåªæœ‰å½“apièµ„æºå¯¹è±¡å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰æ”¶åˆ°é€šçŸ¥ã€‚æ¯ç§apièµ„æºä¼šæœ‰è‡ªå·±çš„informerå®ç°ï¼Œä¹Ÿæ˜¯æŒ‰ç…§apiåˆ†ç»„ä¸ç‰ˆæœ¬æ¥åŒºåˆ†ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">â”œâ”€â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubernetes</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # ä¸»è¦å®šä¹‰ClientSetï¼Œå®ƒä¹Ÿå¯¹restClientè¿›è¡Œäº†å°è£…ï¼Œå¹¶ä¸”åŒ…å«å¯¹å„ç§k8sèµ„æºå’Œç‰ˆæœ¬çš„ç®¡ç†æ–¹æ³•ã€‚æ¯ä¸ªapièµ„æºæœ‰å•ç‹¬çš„clientï¼Œè€ŒClientSetåˆ™æ˜¯å¤šä¸ªå®¢æˆ·ç«¯çš„é›†åˆã€‚ClientSetä»¥åŠæ¯ç§k8så†…ç½®èµ„æºçš„clientçš„æ‰€æœ‰è¯·æ±‚æœ€ç»ˆè¿˜æ˜¯ç”±restClientå‘å‡ºçš„ï¼›åœ¨typedç›®å½•åŒ…æ‹¬å…·ä½“æ¯ç§k8så†…ç½®èµ„æºçš„clientå®ç°ï¼Œä¹Ÿæ˜¯æŒ‰ç…§apiåˆ†ç»„ä¸ç‰ˆæœ¬æ¥åŒºåˆ†ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">â”‚</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   â”œâ”€â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clientset.go</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">â”‚</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   â””â”€â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> typed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">â”œâ”€â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> listers</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # åŒ…å«å„ç§k8så†…ç½®èµ„æºçš„åªè¯»å®¢æˆ·ç«¯ã€‚æ¯ç§listeréƒ½æœ‰Get()å’ŒList()æ–¹æ³•ï¼Œå¹¶ä¸”ç»“æœéƒ½æ˜¯ä»ç¼“å­˜ä¸­è¯»å–çš„ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">â”œâ”€â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rest</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # åŒ…å«çœŸæ­£ç»™apiserverå‘è¯·æ±‚çš„clientï¼Œå®ç°äº†Restfulçš„APIï¼ŒåŒæ—¶æ”¯æŒProtobufå’ŒJSONæ ¼å¼æ•°æ®ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">â”œâ”€â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scale</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # åªè¦åŒ…å«scalClientç”¨äºDeploy, RSç­‰çš„æ‰©/ç¼©å®¹ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">â”œâ”€â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tools</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # å„ç§ç±»å‹çš„å·¥å…·åŒ…ï¼Œå¸¸è§çš„æ¯”å¦‚è·å–kubeconfigçš„æ–¹æ³•ï¼Œä»¥SharedInformerã€Reflectorã€DealtFIFOå’ŒIndexerç­‰å·¥å…·ï¼Œè¿™äº›å·¥å…·ä¸»è¦ç”¨äºå®ç°clientæŸ¥è¯¢å’Œç¼“å­˜æœºåˆ¶ï¼Œå‡è½»apiserverçš„è´Ÿè½½ç­‰ã€‚</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">æ³¨æ„ğŸ“¢ï¼š</p><p>ä¸ºäº†ç®€åŒ–ï¼Œä¸é‡è¦çš„æ–‡ä»¶ä¸ç›®å½•æ²¡æœ‰åˆ—å‡ºæ¥ã€‚</p></div><h2 id="å®¢æˆ·ç«¯å¯¹è±¡" tabindex="-1">å®¢æˆ·ç«¯å¯¹è±¡ <a class="header-anchor" href="#å®¢æˆ·ç«¯å¯¹è±¡" aria-label="Permalink to &quot;å®¢æˆ·ç«¯å¯¹è±¡&quot;">â€‹</a></h2><p><code>Client-go</code> æä¾›äº†ä»¥ä¸‹å››ç§å®¢æˆ·ç«¯å¯¹è±¡ä¸kubernetesçš„API Serverè¿›è¡Œäº¤äº’</p><h3 id="restclient" tabindex="-1"><code>RESTClient</code> <a class="header-anchor" href="#restclient" aria-label="Permalink to &quot;\`RESTClient\`&quot;">â€‹</a></h3><p>è¿™æ˜¯æœ€åŸºç¡€çš„å®¢æˆ·ç«¯å¯¹è±¡ï¼Œä»…å¯¹<code>HTTPRequest</code>è¿›è¡Œäº†å°è£…ï¼Œå®ç°RESTFulé£æ ¼APIï¼Œè¿™ä¸ªå¯¹è±¡çš„ä½¿ç”¨å¹¶ä¸æ–¹ä¾¿ï¼Œå› ä¸ºå¾ˆå¤šå‚æ•°éƒ½è¦ä½¿ç”¨è€…æ¥è®¾ç½®ï¼Œäºæ˜¯<code>client-go</code>åŸºäº<code>RESTClient</code>åˆå®ç°äº†ä¸‰ç§æ–°çš„å®¢æˆ·ç«¯å¯¹è±¡ã€‚</p><h3 id="clientset" tabindex="-1"><code>ClientSet</code> <a class="header-anchor" href="#clientset" aria-label="Permalink to &quot;\`ClientSet\`&quot;">â€‹</a></h3><p>æŠŠ<code>Resource</code>å’Œ<code>Version</code>ä¹Ÿå°è£…æˆæ–¹æ³•äº†ï¼Œç”¨èµ·æ¥æ›´ç®€å•ç›´æ¥ï¼Œä¸€ä¸ªèµ„æºæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå¤šä¸ªèµ„æºå°±å¯¹åº”äº†å¤šä¸ªå®¢æˆ·ç«¯ï¼Œæ‰€ä»¥<code>ClientSet</code>å°±æ˜¯å¤šä¸ªå®¢æˆ·ç«¯çš„é›†åˆäº†ï¼Œè¿™æ ·å°±å¥½ç†è§£äº†ï¼Œä¸è¿‡<code>ClientSet</code>åªèƒ½è®¿é—®å†…ç½®èµ„æºï¼Œè®¿é—®ä¸äº†è‡ªå®šä¹‰èµ„æºã€‚</p><h3 id="dynamicclient" tabindex="-1"><code>DynamicClient</code> <a class="header-anchor" href="#dynamicclient" aria-label="Permalink to &quot;\`DynamicClient\`&quot;">â€‹</a></h3><p>å¯ä»¥è®¿é—®å†…ç½®èµ„æºå’Œè‡ªå®šä¹‰èµ„æºï¼Œæ‹¿å‡ºçš„å†…å®¹æ˜¯<code>Object</code>ç±»å‹ï¼ŒæŒ‰å®é™…æƒ…å†µè‡ªå·±å»åšå¼ºåˆ¶è½¬æ¢ï¼Œå½“ç„¶äº†ä¹Ÿä¼šæœ‰å¼ºè½¬å¤±è´¥çš„é£é™©ã€‚</p><h3 id="discoveryclient" tabindex="-1"><code>DiscoveryClient</code> <a class="header-anchor" href="#discoveryclient" aria-label="Permalink to &quot;\`DiscoveryClient\`&quot;">â€‹</a></h3><p>ç”¨äºå‘ç°kubernetesçš„API Serveræ”¯æŒçš„<code>Group</code>ã€<code>Version</code>ã€<code>Resources</code>ç­‰ä¿¡æ¯ã€‚</p><h3 id="å„æ¨¡å—çš„ä¾èµ–å…³ç³»" tabindex="-1">å„æ¨¡å—çš„ä¾èµ–å…³ç³» <a class="header-anchor" href="#å„æ¨¡å—çš„ä¾èµ–å…³ç³»" aria-label="Permalink to &quot;å„æ¨¡å—çš„ä¾èµ–å…³ç³»&quot;">â€‹</a></h3><p><code>client-go</code> ä¸»è¦åŠŸèƒ½æ¨¡å—ä»¥åŠå„æ¨¡å—çš„ä¾èµ–å…³ç³»å¤§è‡´å¦‚ä¸‹é¢è¿™å¼ å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-module.jpg" alt="" loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡æ˜¯å„ç§é™æ€ç±»å‹çš„å®¢æˆ·ç«¯ <code>ClientSet</code> ï¼ŒåŠ¨æ€å®¢æˆ·ç«¯ <code>DynamicClient</code> è¿˜æ˜¯èµ„æºå‘ç°å®¢æˆ·ç«¯ <code>DiscoveryClient</code> éƒ½å°è£…äº† <code>RESTClient</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€åè¯·æ±‚çš„å‘é€éƒ½æ˜¯æœ‰ <code>RESTClient</code> å‘é€ç»™ <code>kube-apiserver</code> çš„ã€‚è€Œ <code>k8s.io/api-machinery</code> ä¸­ API èµ„æºçš„åˆ†ç»„ä¸ç‰ˆæœ¬æ˜¯æ‰€æœ‰ç±»å‹å®¢æˆ·ç«¯çš„åŸºç¡€ï¼Œå…·ä½“æ¯ç§ API èµ„æºçš„å®šä¹‰åˆ™æ˜¯åŒ…å«åœ¨ <code>k8s.io/api</code> æ¨¡å—ã€‚</p>`,23),l=[n];function o(c,r,d,p,h,k){return i(),s("div",null,l)}const C=e(t,[["render",o]]);export{F as __pageData,C as default};
