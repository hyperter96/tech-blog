import{j as s,c as i,b as a,aa as n}from"./chunks/framework.Cst8pIsI.js";const g=JSON.parse('{"title":"Client-goç³»åˆ—ä¸‰ï¼šè®¤è¯†Informer","description":"","frontmatter":{"sidebar":false,"cover":"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg","date":"2022-12-25T00:00:00.000Z","tag":["Go","Client-go"],"sticky":1,"prev":{"text":"Client-goç³»åˆ—äºŒ: è®¤è¯†ClientSet","link":"/posts/programming/go/client-go/clientset"},"next":{"text":"Client-goç³»åˆ—å››ï¼šInformerå®æˆ˜","link":"/posts/programming/go/client-go/informer-exercise"},"head":[]},"headers":[],"relativePath":"posts/programming/go/client-go/informer.md","filePath":"posts/programming/go/client-go/informer.md","lastUpdated":1738685001000}'),h={name:"posts/programming/go/client-go/informer.md"},l=n(`<h1 id="client-goç³»åˆ—ä¸‰-è®¤è¯†informer" tabindex="-1">Client-goç³»åˆ—ä¸‰ï¼šè®¤è¯†Informer <a class="header-anchor" href="#client-goç³»åˆ—ä¸‰-è®¤è¯†informer" aria-label="Permalink to &quot;Client-goç³»åˆ—ä¸‰ï¼šè®¤è¯†Informer&quot;">â€‹</a></h1><p>Informer å¯¹äºå®ç° kubernetes çš„ <code>controller</code> æ¨¡å¼éå¸¸é‡è¦.</p><h2 id="informer-ç®€ä»‹" tabindex="-1">Informer ç®€ä»‹ <a class="header-anchor" href="#informer-ç®€ä»‹" aria-label="Permalink to &quot;Informer ç®€ä»‹&quot;">â€‹</a></h2><blockquote><p>å‰é¢æˆ‘ä»¬åœ¨ä½¿ç”¨ <code>ClientSet</code> çš„æ—¶å€™äº†è§£åˆ°æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>ClientSet</code> æ¥è·å–æ‰€æœ‰çš„åŸç”Ÿèµ„æºå¯¹è±¡ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³è¦å»ä¸€ç›´è·å–é›†ç¾¤çš„èµ„æºå¯¹è±¡æ•°æ®å‘¢ï¼Ÿå²‚ä¸æ˜¯éœ€è¦ç”¨ä¸€ä¸ªè½®è¯¢å»ä¸æ–­æ‰§è¡Œ <code>List()</code> æ“ä½œï¼Ÿ</p><p>è¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œå®é™…ä¸Šé™¤äº†å¸¸ç”¨çš„ CRUD æ“ä½œä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿›è¡Œ <code>Watch</code> æ“ä½œï¼Œç›‘å¬èµ„æºå¯¹è±¡çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å»å¤„ç†è¿™äº›æ•°æ®äº†ã€‚</p></blockquote><p>ä½œä¸ºå®¢æˆ·ç«¯ï¼ŒClient-go å®ç°äº†ä¸€å¥—å¯¹åº”çš„ <code>list-watch</code> è¿›è¡Œç”¨æ¥å¤„ç†å¯¹è±¡çš„å˜åŒ–ã€‚è¿™ä¸ªæœºåˆ¶åœ¨ Client-go å°±æ˜¯ <code>Informer</code> æœºåˆ¶ã€‚</p><p><code>Informer</code> æœºåˆ¶è¿è¡ŒåŸç†å¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-image.png" alt="" loading="lazy"></p><div class="warning custom-block"><p class="custom-block-title">æ³¨æ„ğŸ“¢ï¼š</p><p>Informer çš„å¤§ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><code>new</code> ä¸€ä¸ª <code>informer</code>ï¼Œåˆ›å»º <code>informer</code> ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª <code>ListWatch</code> çš„æ¥å£ç±»å‹ï¼ˆè¿™ä¸ªå°±æ˜¯è·å– apiserver æ•°æ®ï¼‰ã€‚</li><li><code>informer.Run</code> çš„æ—¶å€™ï¼Œä¼š <code>new</code> ä¸€ä¸ª <code>Reflector</code> å¯¹è±¡ã€‚<code>Reflector</code> åŒ…å«äº† <code>ListWatch</code> ï¼Œæ¥ä¸‹æ¥åŸºæœ¬å°±æ˜¯ <code>Reflector</code> è¿›è¡Œæ“ä½œäº†ã€‚</li><li><code>Reflector</code> å¯¹ <code>ListWatch</code> æ¥çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œä½¿ç”¨åˆ°äº† <code>DeltaFIFO</code> é˜Ÿåˆ—å¯¹ <code>watch</code> æ¥çš„æ•°æ®ä¸€ä¸ªä¸ªçš„å¤„ç†ï¼Œ<code>HandleDeltas</code> å‡½æ•°ã€‚</li><li>å…·ä½“çš„å¤„ç†é€»è¾‘åˆ†ä¸ºä¸¤éƒ¨åˆ†: <ul><li>é€šè¿‡æ“ä½œ <code>cache.indexer</code> ï¼Œæ›´æ–°æœ¬åœ°ç¼“å­˜ + ç´¢å¼•;</li><li>å°† <code>watch</code> çš„æ•°æ®å‘é€ç»™ <code>Informer</code> è‡ªå®šä¹‰çš„å¤„ç†å‡½æ•°è¿›è¡Œå¤„ç†ã€‚</li></ul></li></ol></div><p>è¦åˆ›å»ºä¸€ä¸ª <code>Informe</code>r å¾ˆç®€å•ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">store, controller </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cache.NewInformer {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ListWatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{},</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Pod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	resyncPeriod, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// how often the controller goes through all items remaining in the cache and fires the UpdateFunc again</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResourceEventHandlerFuncs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å®é™…ä¸Šï¼Œ<code>Informer</code> å¾ˆå°‘è¢«ä½¿ç”¨ï¼Œç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯ <code>SharedInformer</code>ã€‚</p><blockquote><p>æˆ‘ä»¬å¹³æ—¶è¯´çš„ <code>Informer</code> å…¶å®å°±æ˜¯ <code>SharedInformer</code>ï¼Œå®ƒæ˜¯å¯ä»¥å…±äº«ä½¿ç”¨çš„ã€‚å¦‚æœåŒä¸€ä¸ªèµ„æºçš„ <code>Informer</code> è¢«å®ä¾‹åŒ–å¤šæ¬¡ï¼Œé‚£ä¹ˆå°±ä¼šè¿è¡Œå¤šä¸ª <code>ListAndWatch</code> æ“ä½œï¼Œè¿™ä¼šåŠ å¤§ APIServer çš„å‹åŠ›ã€‚è€Œ <code>SharedInformer</code> é€šè¿‡ä¸€ä¸ª <code>map</code> æ¥è®©åŒä¸€ç±»èµ„æºçš„ <code>Informer</code> å®ç°å…±äº«ä¸€ä¸ª <code>Refelctor</code>ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°ä¸Šé¢è¿™ä¸ªé—®é¢˜äº†ã€‚</p></blockquote><h2 id="informer-ç¼–ç " tabindex="-1">Informer ç¼–ç  <a class="header-anchor" href="#informer-ç¼–ç " aria-label="Permalink to &quot;Informer ç¼–ç &quot;">â€‹</a></h2><blockquote><p>ç›´æ¥é˜…è¯» Informer æœºåˆ¶ä»£ç ä¼šæ¯”è¾ƒæ™¦æ¶©ï¼Œé€šè¿‡ Informers Example ä»£ç ç¤ºä¾‹æ¥ç†è§£ <code>Informer</code> ï¼Œå°è±¡ä¼šæ›´æ·±åˆ»ã€‚Informers Example ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p></blockquote><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">flag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">path/filepath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	v1 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k8s.io/api/apps/v1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k8s.io/apimachinery/pkg/labels</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k8s.io/client-go/informers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k8s.io/client-go/kubernetes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k8s.io/client-go/rest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k8s.io/client-go/tools/cache</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k8s.io/client-go/tools/clientcmd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k8s.io/client-go/util/homedir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kubeconfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> home </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> homedir.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HomeDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); home </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		kubeconfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> flag.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;kubeconfig&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, filepath.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(home, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.kube&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;config&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[å¯é€‰] kubeconfig ç»å¯¹è·¯å¾„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		kubeconfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> flag.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;kubeconfig&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;kubeconfig ç»å¯¹è·¯å¾„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// åˆå§‹åŒ– rest.Config å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">InClusterConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clientcmd.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BuildConfigFromFlags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kubeconfig); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">			panic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// åˆ›å»º Clientset å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	clientset, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kubernetes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewForConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		panic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// åˆå§‹åŒ– informer factoryï¼ˆä¸ºäº†æµ‹è¯•æ–¹ä¾¿è¿™é‡Œè®¾ç½®æ¯30sé‡æ–° List ä¸€æ¬¡ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	informerFactory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> informers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewSharedInformerFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(clientset, time.Second</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// å¯¹ Deployment ç›‘å¬</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	deployInformer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> informerFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Apps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">V1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Deployments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// åˆ›å»º Informerï¼ˆç›¸å½“äºæ³¨å†Œåˆ°å·¥å‚ä¸­å»ï¼Œè¿™æ ·ä¸‹é¢å¯åŠ¨çš„æ—¶å€™å°±ä¼šå» List &amp; Watch å¯¹åº”çš„èµ„æºï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	informer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deployInformer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Informer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// åˆ›å»º Lister</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	deployLister </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deployInformer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Lister</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åº</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	informer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddEventHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResourceEventHandlerFuncs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		AddFunc:    onAdd,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		UpdateFunc: onUpdate,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		DeleteFunc: onDelete,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	stopper </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">chan</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	defer</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(stopper)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// å¯åŠ¨ informerï¼ŒList &amp; Watch</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	informerFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(stopper)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// ç­‰å¾…æ‰€æœ‰å¯åŠ¨çš„ Informer çš„ç¼“å­˜è¢«åŒæ­¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	informerFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WaitForCacheSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(stopper)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// ä»æœ¬åœ°ç¼“å­˜ä¸­è·å– default ä¸­çš„æ‰€æœ‰ deployment åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	deployments, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deployLister.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Deployments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;default&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(labels.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Everything</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		panic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx, deploy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deployments {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, idx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, deploy.Name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	&lt;-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stopper</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onAdd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	deploy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> obj.(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Deployment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;add a deployment:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, deploy.Name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">old</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">new</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	oldDeploy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> old.(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Deployment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	newDeploy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> new.(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Deployment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;update deployment:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, oldDeploy.Name, newDeploy.Name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onDelete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	deploy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> obj.(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Deployment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;delete a deployment:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, deploy.Name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">ä¿¡æ¯</p><ol><li>é¦–å…ˆé€šè¿‡ <code>kubernetes.NewForConfig</code> åˆ›å»º <code>ClientSet</code> å¯¹è±¡ã€‚</li><li><code>Informer</code> éœ€è¦é€šè¿‡ <code>ClientSet</code> ä¸ Kubernetes API Server è¿›è¡Œäº¤äº’ã€‚</li><li>å¦å¤–ï¼Œåˆ›å»º <code>stopCh</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç”¨äºåœ¨ç¨‹åºè¿›ç¨‹é€€å‡ºä¹‹å‰é€šçŸ¥ <code>Informer</code> æå‰é€€å‡ºï¼Œå› ä¸º <code>Informer</code> æ˜¯ä¸€ä¸ªæŒä¹…è¿è¡Œçš„ <code>goroutine</code>ã€‚</li><li><code>informers.NewSharedInformerFactory</code> å‡½æ•°å®ä¾‹åŒ–äº† <code>SharedInformer</code> å¯¹è±¡ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š <ul><li>ç¬¬1ä¸ªå‚æ•° <code>ClientSet</code> æ˜¯ç”¨äºä¸ Kubernetes API Server äº¤äº’çš„å®¢æˆ·ç«¯</li><li>ç¬¬2ä¸ªå‚æ•° <code>time.Minute</code> ç”¨äºè®¾ç½®å¤šä¹…è¿›è¡Œä¸€æ¬¡ <code>resync</code>ï¼ˆé‡æ–°åŒæ­¥ï¼‰ï¼Œ<code>resync</code> ä¼šå‘¨æœŸæ€§åœ°æ‰§è¡Œ <code>List</code> æ“ä½œï¼Œå°†æ‰€æœ‰çš„èµ„æºå­˜æ”¾åœ¨ <code>Informer Store</code> ä¸­ï¼Œå¦‚æœè¯¥å‚æ•°ä¸º 0ï¼Œåˆ™ç¦ç”¨ <code>resync</code> åŠŸèƒ½ã€‚</li></ul></li><li>åœ¨ Informers Example ä»£ç ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡ <code>informerFactory.Apps().V1().Deployments()</code> ã€‚ <code>Informer</code> å¯ä»¥å¾—åˆ°å…·ä½“ <code>Deployments</code> èµ„æºçš„ <code>informer</code> å¯¹è±¡ã€‚é€šè¿‡ <code>informer.AddEventHandler</code> å‡½æ•°å¯ä»¥ä¸º <code>deployment</code> èµ„æºæ·»åŠ èµ„æºäº‹ä»¶å›è°ƒæ–¹æ³•ï¼Œæ”¯æŒ3ç§èµ„æºäº‹ä»¶å›è°ƒæ–¹æ³•ï¼Œåˆ†åˆ«ä»‹ç»å¦‚ä¸‹ï¼š <ul><li><code>AddFunc</code>ï¼šå½“åˆ›å»º <code>deployment</code> èµ„æºå¯¹è±¡æ—¶è§¦å‘çš„äº‹ä»¶å›è°ƒæ–¹æ³•ã€‚</li><li><code>UpdateFunc</code>ï¼šå½“æ›´æ–° <code>deployment</code> èµ„æºå¯¹è±¡æ—¶è§¦å‘çš„äº‹ä»¶å›è°ƒæ–¹æ³•ã€‚</li><li><code>DeleteFunc</code>ï¼šå½“åˆ é™¤ <code>deployment</code> èµ„æºå¯¹è±¡æ—¶è§¦å‘çš„äº‹ä»¶å›è°ƒæ–¹æ³•ã€‚</li></ul></li><li>åœ¨æ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>Informer</code> æœºåˆ¶æ—¶è§¦å‘èµ„æºäº‹ä»¶å›è°ƒæ–¹æ³•åæ˜¯å°†èµ„æºå¯¹è±¡æ¨é€åˆ° <code>WorkQueue</code> æˆ–å…¶ä»–é˜Ÿåˆ—ä¸­(å®é™…è¿‡ç¨‹ä¸­å¤§éƒ½æ˜¯è¿™æ ·çš„)ï¼Œåœ¨ Informers Example ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥è¾“å‡ºè§¦å‘çš„ <code>deployment</code> èµ„æºçš„åç§°ã€‚</li></ol></div><p>ç¼–ç å®Œæˆï¼Œæ‰§è¡Œ<code>go run main.go</code>ï¼Œå³å¯è·å–æŒ‡å®š <code>namespace</code> ä¸‹æ‰€æœ‰ <code>deployment</code> çš„ä¿¡æ¯ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main.go</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rancher-monitoring-kube-state-metrics</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metrics-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argocd-dex-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argocd-notifications-controller</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argocd-repo-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rancher-monitoring-grafana</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fleet-agent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rancher-monitoring-operator</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> traefik</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sample</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argocd-applicationset-controller</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> crane-scheduler</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> busybox</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudcore</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cattle-cluster-agent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> crane-scheduler-controller</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sample</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kruise-controller-manager</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argo-rollouts</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argocd-redis</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argocd-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rancher-monitoring-prometheus-adapter</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> coredns</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ops-pod-cleaner</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-deployment</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> busybox</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sample</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-deployment</span></span></code></pre></div><div class="important custom-block github-alert"><p class="custom-block-title">æŠ€å·§</p><p>è¿™æ ·å½“æˆ‘ä»¬å¯åŠ¨ <code>Informer</code> çš„æ—¶å€™é¦–å…ˆä¼šå°†é›†ç¾¤çš„å…¨é‡ <code>deployment</code> æ•°æ®åŒæ­¥åˆ°æœ¬åœ°çš„ç¼“å­˜ä¸­ï¼Œä¼šè§¦å‘ <code>AddFunc</code> è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚</p></div>`,19),t=[l];function k(p,e,r,d,E,F){return a(),i("div",null,t)}const y=s(h,[["render",k]]);export{g as __pageData,y as default};
