import{_ as s,c as i,o as a,a7 as n}from"./chunks/framework.B28k8k1F.js";const y=JSON.parse('{"title":"利用Velero对K8S备份还原与集群迁移实战","description":"","frontmatter":{"sidebar":false,"cover":"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/velero-cover.png","date":"2024-01-05T00:00:00.000Z","tag":["Velero","备份恢复","kubernetes"],"sticky":1,"head":[]},"headers":[],"relativePath":"posts/velero/intro-and-practice.md","filePath":"posts/velero/intro-and-practice.md","lastUpdated":1739612366000}'),h={name:"posts/velero/intro-and-practice.md"},l=n(`<h1 id="利用velero对k8s备份还原与集群迁移实战" tabindex="-1">利用Velero对K8S备份还原与集群迁移实战 <a class="header-anchor" href="#利用velero对k8s备份还原与集群迁移实战" aria-label="Permalink to &quot;利用Velero对K8S备份还原与集群迁移实战&quot;">​</a></h1><h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h2><p>Velero 是一款云原生时代的灾难恢复和迁移工具，采用 Go 语言编写，并在 github 上进行了开源，利用 velero 用户可以安全的备份、恢复和迁移 Kubernetes 集群资源和持久卷。</p><ul><li>开源地址：<a href="https://github.com/vmware-tanzu/velero" target="_blank" rel="noreferrer">https://github.com/vmware-tanzu/velero</a></li><li>官方文档：<a href="https://velero.io/docs/main/" target="_blank" rel="noreferrer">https://velero.io/docs/main/</a></li></ul><h3 id="velero组件" tabindex="-1">Velero组件 <a class="header-anchor" href="#velero组件" aria-label="Permalink to &quot;Velero组件&quot;">​</a></h3><p>Velero 组件一共分两部分，分别是服务端和客户端。</p><ul><li>服务端：运行在你 Kubernetes 的集群中</li><li>客户端：是一些运行在本地的命令行的工具，需要已配置好 <code>kubectl</code> 及集群 kubeconfig 的机器上</li></ul><h3 id="velero备份流程" tabindex="-1">Velero备份流程 <a class="header-anchor" href="#velero备份流程" aria-label="Permalink to &quot;Velero备份流程&quot;">​</a></h3><ul><li>velero客户端调用kubernetes API Server创建backup任务</li><li>Backup控制器基于watch机制通过Api Server获取到备份任务</li><li>Backup控制器开始执行备份动作，会通过请求Api Server获取到需要备份的数据</li><li>Backup 控制器将获取到的数据备份到指定的对象存储server端</li></ul><p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/velero-workflow.png" alt="" loading="lazy"></p><h3 id="velero后端存储" tabindex="-1">Velero后端存储 <a class="header-anchor" href="#velero后端存储" aria-label="Permalink to &quot;Velero后端存储&quot;">​</a></h3><p>Velero支持两种关于后端存储的CRD，分别是<code>BackupStorageLocation</code>和<code>VolumeSnapshotLocation</code>。</p><h4 id="backupstoragelocation" tabindex="-1">BackupStorageLocation <a class="header-anchor" href="#backupstoragelocation" aria-label="Permalink to &quot;BackupStorageLocation&quot;">​</a></h4><p>主要用来定义 Kubernetes 集群资源的数据存放位置，也就是集群对象数据，不是 PVC 的数据。主要支持的后端存储是 S3 兼容的存储，比如：Mino 和阿里云 OSS 等。</p><h4 id="volumesnapshotlocation" tabindex="-1">VolumeSnapshotLocation <a class="header-anchor" href="#volumesnapshotlocation" aria-label="Permalink to &quot;VolumeSnapshotLocation&quot;">​</a></h4><p>主要用来给 PV 做快照，需要云提供商提供插件。阿里云已经提供了插件，这个需要使用 CSI 等存储机制。你也可以使用专门的备份工具 Restic，把 PV 数据备份到阿里云 OSS 中去(安装时需要自定义选项)。</p><p>Restic 是一款 GO 语言开发的数据加密备份工具，顾名思义，可以将本地数据加密后传输到指定的仓库。支持的仓库有 Local、SFTP、Aws S3、Minio、OpenStack Swift、Backblaze B2、Azure BS、Google Cloud storage、Rest Server。</p><h2 id="准备存储插件" tabindex="-1">准备存储插件 <a class="header-anchor" href="#准备存储插件" aria-label="Permalink to &quot;准备存储插件&quot;">​</a></h2><p>Velero支持很多种存储插件，可查看：<a href="https://velero.io/docs/main/supported-providers/" target="_blank" rel="noreferrer">https://velero.io/docs/main/supported-providers/</a> 获取插件信息，我们这里使用minio作为S3兼容的对象存储提供程序。您也可以在任意地方部署Minio对象存储，只需要保证K8S集群可以访问到即可。</p><h3 id="准备minio清单" tabindex="-1">准备minio清单 <a class="header-anchor" href="#准备minio清单" aria-label="Permalink to &quot;准备minio清单&quot;">​</a></h3><details class="details custom-block"><summary><code>minio.yaml</code></summary><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">minio</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">velero</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">minio</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">minio</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">api</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TCP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">console</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9001</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TCP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">StatefulSet</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">minio</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">velero</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">minio</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  serviceName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">minio</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">minio</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">minio</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">minio</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker.io/bitnami/minio:2023.3.22</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        imagePullPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">IfNotPresent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">containerPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">api</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TCP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">containerPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9001</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">console</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TCP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MINIO_ROOT_USER</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;minio&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MINIO_ROOT_PASSWORD</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;minio123&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MINIO_DEFAULT_BUCKETS</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;velero&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        volumeMounts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">data</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          mountPath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/data</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  volumeClaimTemplates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">data</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        accessModes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ReadWriteOnce&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        resources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          requests</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            storage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">50Gi</span></span></code></pre></div></details><h3 id="创建minio应用" tabindex="-1">创建minio应用 <a class="header-anchor" href="#创建minio应用" aria-label="Permalink to &quot;创建minio应用&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建velero命名空间</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建minio资源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> minio.yaml</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看部署状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sts,pod,svc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">statefulset.apps/minio</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     66s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    RESTARTS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pod/minio-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          65s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        CLUSTER-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)             </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/minio</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.99.223.162</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        9000/TCP,9001/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   66s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开放NodePort端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> patch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> svc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> minio</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;spec&quot;: {&quot;type&quot;: &quot;NodePort&quot;}}&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> patch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> svc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> minio</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --type=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;json&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/ports/0/nodePort&quot;, &quot;value&quot;:9000},{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/ports/1/nodePort&quot;, &quot;value&quot;:9001}]&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> svc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       CLUSTER-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                       </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minio</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   NodePort</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.99.223.162</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        9000:9000/TCP,9001:9001/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   140m</span></span></code></pre></div><p>通过浏览器访问服务器<code>IP:9001</code>，并使用账号<code>minio</code>密码<code>minio123</code>登入验证。</p><p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/velero-practice-1.png" alt="" loading="lazy"></p><h2 id="安装velero" tabindex="-1">安装velero <a class="header-anchor" href="#安装velero" aria-label="Permalink to &quot;安装velero&quot;">​</a></h2><p>版本列表：<a href="https://github.com/vmware-tanzu/velero/releases" target="_blank" rel="noreferrer">https://github.com/vmware-tanzu/velero/releases</a></p><h3 id="安装velero命令程序" tabindex="-1">安装velero命令程序 <a class="header-anchor" href="#安装velero命令程序" aria-label="Permalink to &quot;安装velero命令程序&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/vmware-tanzu/velero/releases/download/v1.13.0/velero-v1.13.0-linux-amd64.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zxf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero-v1.13.0-linux-amd64.tar.gz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero-v1.13.0-linux-amd64/velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/bin/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用命令补全</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> completion bash)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> completion</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/bash_completion.d/velero</span></span></code></pre></div><h3 id="创建密钥" tabindex="-1">创建密钥 <a class="header-anchor" href="#创建密钥" aria-label="Permalink to &quot;创建密钥&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> credentials-velero</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[default]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aws_access_key_id = minio</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aws_secret_access_key = minio123</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><h3 id="安装velero到k8s集群" tabindex="-1">安装velero到k8s集群 <a class="header-anchor" href="#安装velero到k8s集群" aria-label="Permalink to &quot;安装velero到k8s集群&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --provider</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aws</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero/velero:v1.13.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --plugins</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero/velero-plugin-for-aws:v1.6.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --bucket</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --secret-file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./credentials-velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --use-node-agent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --use-volume-snapshots=false</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --backup-location-config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> region=minio,s3ForcePathStyle=&quot;true&quot;,s3Url=http://minio:9000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --wait</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行install命令后会创建一系列清单，包括CustomResourceDefinition、Namespace、Deployment等。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可使用如下命令查看运行日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment/velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看velero创建的api对象</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api-versions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">velero.io/v1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看备份位置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup-location</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      PROVIDER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   BUCKET/PREFIX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   PHASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       LAST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> VALIDATED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  ACCESS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MODE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   DEFAULT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          Available</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   2023-03-28</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 15:45:30</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ReadWrite</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     true</span></span></code></pre></div><p>选项说明：</p><ul><li><code>--kubeconfig</code>(可选)：指定kubeconfig认证文件，默认使用<code>.kube/config</code>；</li><li><code>--provider</code>：定义插件提供方；</li><li><code>--image</code>：定义运行velero的镜像，默认与velero客户端一致；</li><li><code>--plugins</code>：指定使用aws s3兼容的插件镜像；</li><li><code>--bucket</code>：指定对象存储Bucket桶名称；</li><li><code>--secret-file</code>：指定对象存储认证文件；</li><li><code>--use-node-agent</code>：创建Velero Node Agent守护进程，托管FSB模块；</li><li><code>--use-volume-snapshots</code>：是否启使用快照；</li><li><code>--namespace</code>：指定部署的<code>namespace</code>名称，默认为velero；</li><li><code>--backup-location-config</code>：指定对象存储地址信息；</li></ul><h3 id="卸载velero" tabindex="-1">卸载velero <a class="header-anchor" href="#卸载velero" aria-label="Permalink to &quot;卸载velero&quot;">​</a></h3><p>如果您想从集群中完全卸载Velero，则以下命令将删除由<code>velero install</code>创建的所有资源:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> namespace/velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clusterrolebinding/velero</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> crds</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> component=velero</span></span></code></pre></div><h2 id="备份与恢复" tabindex="-1">备份与恢复 <a class="header-anchor" href="#备份与恢复" aria-label="Permalink to &quot;备份与恢复&quot;">​</a></h2><p>备份命令：<code>velero create backup NAME [flags]</code></p><p>backup选项：</p><ul><li><code>--exclude-namespaces</code>: 要从备份中排除的名称空间</li><li><code>--exclude-resources</code>: 要从备份中排除的资源，如<code>storageclasses.storage.k8s.io</code></li><li><code>--include-cluster-resources</code> optionalBool[=true]: 包含集群资源类型</li><li><code>--include-namespaces</code>: 要包含在备份中的名称空间(默认&#39;*&#39;)</li><li><code>--include-resources</code>: 备份中要包括的资源</li><li><code>--labels</code>: 给这个备份加上标签</li><li><code>-o, --output</code>: 指定输出格式，支持<code>&#39;table&#39;</code>、<code>&#39;json&#39;</code>和<code>&#39;yaml&#39;</code>；</li><li><code>-l, --selector</code>: 对指定标签的资源进行备份</li><li><code>--snapshot-volumes</code> optionalBool[=true]: 对 PV 创建快照</li><li><code>--storage-location</code>: 指定备份的位置</li><li><code>--ttl</code>: 备份数据多久删掉</li><li><code>--volume-snapshot-locations</code>: 指定快照的位置，也就是哪一个公有云驱动</li></ul><h3 id="备份" tabindex="-1">备份 <a class="header-anchor" href="#备份" aria-label="Permalink to &quot;备份&quot;">​</a></h3><h4 id="使用官方案例创建测试应用" tabindex="-1">使用官方案例创建测试应用 <a class="header-anchor" href="#使用官方案例创建测试应用" aria-label="Permalink to &quot;使用官方案例创建测试应用&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> examples/nginx-app/base.yaml</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">namespace/nginx-example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> created</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/nginx-deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> created</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/my-nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> created</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看资源清单</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-example</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                   READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    RESTARTS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pod/nginx-deployment-57d5dcb68-g42mk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          41s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pod/nginx-deployment-57d5dcb68-pcc6t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          41s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           CLUSTER-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)        </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/my-nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   LoadBalancer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.96.0.31</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pendin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     80:27370/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   41s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                               READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   UP-TO-DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AVAILABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/nginx-deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   2/2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           41s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                         DESIRED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CURRENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replicaset.apps/nginx-deployment-57d5dcb68</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       41s</span></span></code></pre></div><h4 id="备份测试应用" tabindex="-1">备份测试应用 <a class="header-anchor" href="#备份测试应用" aria-label="Permalink to &quot;备份测试应用&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-backup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --include-namespaces</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-example</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> request</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;nginx-backup&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> submitted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup describe nginx-backup\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup logs nginx-backup\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> more details.</span></span></code></pre></div><p>选项：</p><ul><li><code>--include-namespaces</code>：指定命名空间</li><li><code>--selector</code>：标签选择器，如<code>app=nginx</code></li></ul><h4 id="查看备份列表" tabindex="-1">查看备份列表 <a class="header-anchor" href="#查看备份列表" aria-label="Permalink to &quot;查看备份列表&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ERRORS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   WARNINGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                         EXPIRES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STORAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LOCATION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   SELECTOR</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx-backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Completed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          2023-03-09</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 09:38:50</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看备份详细信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-backup</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看备份日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-backup</span></span></code></pre></div><p>登入minio控制台查看备份内容</p><p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/velero-practice-2.png" alt="" loading="lazy"></p><h4 id="定时备份指南" tabindex="-1">定时备份指南 <a class="header-anchor" href="#定时备份指南" aria-label="Permalink to &quot;定时备份指南&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用cron表达式备份</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> schedule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-daily</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --schedule=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0 1 * * *&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --include-namespaces</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-example</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用一些非标准的速记 cron 表达式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> schedule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-daily</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --schedule=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@daily&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --include-namespaces</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-example</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 手动触发定时任务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --from-schedule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-daily</span></span></code></pre></div><h3 id="恢复" tabindex="-1">恢复 <a class="header-anchor" href="#恢复" aria-label="Permalink to &quot;恢复&quot;">​</a></h3><h4 id="模拟灾难" tabindex="-1">模拟灾难 <a class="header-anchor" href="#模拟灾难" aria-label="Permalink to &quot;模拟灾难&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除nginx-example命名空间和资源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-example</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查是否删除</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-example</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">No</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> resources</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> found</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> namespace.</span></span></code></pre></div><h4 id="恢复资源" tabindex="-1">恢复资源 <a class="header-anchor" href="#恢复资源" aria-label="Permalink to &quot;恢复资源&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ERRORS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   WARNINGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                         EXPIRES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STORAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LOCATION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   SELECTOR</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx-backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Completed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          2023-03-09</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 09:38:50</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --from-backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-backup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Restore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> request</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;nginx-backup-20230309095025&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> submitted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restore describe nginx-backup-20230309095025\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restore logs nginx-backup-20230309095025\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> more details.</span></span></code></pre></div><h4 id="检查恢复的资源" tabindex="-1">检查恢复的资源 <a class="header-anchor" href="#检查恢复的资源" aria-label="Permalink to &quot;检查恢复的资源&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                          BACKUP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      STARTED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                         COMPLETED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                       ERRORS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   WARNINGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                         SELECTOR</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx-backup-20230309095025</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   nginx-backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Completed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   2023-03-09</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 09:50:25</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   2023-03-09</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 09:50:25</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CST</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          2023-03-09</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 09:50:25</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看详细信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-backup-20230309095025</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查资源状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-example</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                   READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    RESTARTS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pod/nginx-deployment-57d5dcb68-g42mk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          2m19s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pod/nginx-deployment-57d5dcb68-pcc6t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          2m19s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           CLUSTER-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)        </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/my-nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   LoadBalancer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.96.0.204</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pendin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     80:31291/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   2m19s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                               READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   UP-TO-DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AVAILABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/nginx-deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   2/2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           2m19s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                         DESIRED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CURRENT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replicaset.apps/nginx-deployment-57d5dcb68</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       2m19s</span></span></code></pre></div><h2 id="项目迁移实战" tabindex="-1">项目迁移实战 <a class="header-anchor" href="#项目迁移实战" aria-label="Permalink to &quot;项目迁移实战&quot;">​</a></h2><h3 id="项目介绍" tabindex="-1">项目介绍 <a class="header-anchor" href="#项目介绍" aria-label="Permalink to &quot;项目介绍&quot;">​</a></h3><p>我们将使用Velero快速完成云原生应用及PV数据的迁移实践过程，在本文示例中，我们将A集群中的一个MOS应用迁移到集群B中，其中数据备份采用自建Minio对象存储服务。</p><p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/velero-practice-3.png" alt="" loading="lazy"></p><h4 id="环境要求" tabindex="-1">环境要求 <a class="header-anchor" href="#环境要求" aria-label="Permalink to &quot;环境要求&quot;">​</a></h4><ul><li>迁移项目最好保证两个Kubernetes集群版本一致。</li><li>为了保证PV数据成功迁移，两边需要安装好相同名字的StorageClass。</li><li>可以自己部署Minio，也可以使用公有云的对象存储服务，如华为的OBS、阿里的OSS等。</li><li>本案例将集群A中<code>app-system</code>命名空间中的服务及PV数据迁移到集群B中。</li></ul><h4 id="项目环境" tabindex="-1">项目环境 <a class="header-anchor" href="#项目环境" aria-label="Permalink to &quot;项目环境&quot;">​</a></h4><table tabindex="0"><thead><tr><th>角色</th><th>集群IP</th><th>集群版本</th><th>部署软件</th></tr></thead><tbody><tr><td>K8S 集群A</td><td>192.168.1.102</td><td>v1.22.10</td><td><code>openebs、velero、app-system</code></td></tr><tr><td>K8S 集群B</td><td>192.168.1.103</td><td>v1.22.10</td><td><code>openebs、velero、minio</code></td></tr></tbody></table><h4 id="项目说明" tabindex="-1">项目说明 <a class="header-anchor" href="#项目说明" aria-label="Permalink to &quot;项目说明&quot;">​</a></h4><p>我们需要将集群A中 <code>app-system</code> 空间的所有资源和数据全部迁移到集群B中，该项目包括了<code>deployment、statefulset、service、ingress、job、cronjob、secret、configmap、pv、pvc</code>。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 项目清单信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment,sts,pvc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-system</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   UP-TO-DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AVAILABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/hasura-graphql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/iot-backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/iot-gateway</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/iot-history</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/iot-observer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/app-backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/app-frontend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           5h27m</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">statefulset.apps/minio</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">statefulset.apps/mongo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">statefulset.apps/postgres</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">statefulset.apps/rabbitmq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">statefulset.apps/redis</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     5h27m</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                       STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   VOLUME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                     CAPACITY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ACCESS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MODES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STORAGECLASS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">persistentvolumeclaim/data-minio-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-950d15a8-20a5-4e5f-8dbf-b904295355bb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   50Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            openebs-hostpath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">persistentvolumeclaim/data-mongo-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-e435b80e-0370-4100-b223-ca841f24bd5d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   50Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            openebs-hostpath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">persistentvolumeclaim/data-postgres-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-359ec32a-4bfc-4bc8-8cf3-38322e8ef59b</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   300Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            openebs-hostpath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">persistentvolumeclaim/data-redis-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-da718e0c-992c-4f6e-af44-abb1c7214a9e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   2Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            openebs-hostpath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   5h27m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">persistentvolumeclaim/app-backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-506261a9-6be4-4d95-8807-58201e31a527</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   10Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            openebs-hostpath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   5h27m</span></span></code></pre></div><h3 id="准备对象存储" tabindex="-1">准备对象存储 <a class="header-anchor" href="#准备对象存储" aria-label="Permalink to &quot;准备对象存储&quot;">​</a></h3><p>按照2.1和2.2的方法在集群B（<code>192.168.1.103</code>）中创建minio应用，用来存放备份数据。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sts,svc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">statefulset.apps/minio</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     3h44m</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       CLUSTER-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                       </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/minio</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   NodePort</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.99.223.162</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        9000:9000/TCP,9001:9001/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   3h44m</span></span></code></pre></div><h3 id="安装velero-1" tabindex="-1">安装velero <a class="header-anchor" href="#安装velero-1" aria-label="Permalink to &quot;安装velero&quot;">​</a></h3><p>请确保在集群A和集群B中已经安装好velero客户端，请参考<a href="./intro-and-practice.html#安装velero">安装velero命令程序</a></p><h4 id="在集群a中安装velero服务" tabindex="-1">在集群A中安装velero服务 <a class="header-anchor" href="#在集群a中安装velero服务" aria-label="Permalink to &quot;在集群A中安装velero服务&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> credentials-velero</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[default]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aws_access_key_id = minio</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aws_secret_access_key = minio123</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --provider</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aws</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero/velero:v1.13.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --plugins</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero/velero-plugin-for-aws:v1.6.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --bucket</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --secret-file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./credentials-velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --use-node-agent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --use-volume-snapshots=false</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --backup-location-config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> region=minio,s3ForcePathStyle=&quot;true&quot;,s3Url=http://192.168.1.103:9000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --wait</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意📢：</p><p>其中S3的地址指向集群B（<code>192.168.1.103</code>）的minio对象存储。</p></div><h4 id="在集群b种安装velero服务" tabindex="-1">在集群B种安装velero服务 <a class="header-anchor" href="#在集群b种安装velero服务" aria-label="Permalink to &quot;在集群B种安装velero服务&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> credentials-velero</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[default]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aws_access_key_id = minio</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aws_secret_access_key = minio123</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --provider</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aws</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero/velero:v1.13.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --plugins</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero/velero-plugin-for-aws:v1.6.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --bucket</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --secret-file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./credentials-velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --use-node-agent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --use-volume-snapshots=false</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --backup-location-config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> region=minio,s3ForcePathStyle=&quot;true&quot;,s3Url=http://minio:9000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --wait</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意📢：</p><p>其中S3的地址指向本集群minio对象存储的svc地址。</p></div><h3 id="备份mos项目" tabindex="-1">备份MOS项目 <a class="header-anchor" href="#备份mos项目" aria-label="Permalink to &quot;备份MOS项目&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-backup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --default-volumes-to-fs-backup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --include-namespaces</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-system</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> request</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;app-backup&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> submitted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup describe app-backup\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup logs app-backup\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> more details.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看备份状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ERRORS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   WARNINGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                         EXPIRES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STORAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LOCATION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   SELECTOR</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">app-backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Completed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          2023-03-28</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 16:34:56</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><ul><li><code>--default-volumes-to-fs-backup</code>：默认将所有PV卷进行备份，详情查看官方文档。</li><li><code>--include-namespaces</code>：指定要备份的命名空间</li></ul><p>登入minio控制台上可以看到备份的文件：</p><p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/velero-practice-4.png" alt="" loading="lazy"></p><h3 id="恢复到集群b" tabindex="-1">恢复到集群B <a class="header-anchor" href="#恢复到集群b" aria-label="Permalink to &quot;恢复到集群B&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 到集群B中查看备份资源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ERRORS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   WARNINGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                         EXPIRES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STORAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LOCATION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   SELECTOR</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">app-backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Completed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          2023-03-28</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 16:41:55</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行恢复命令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --from-backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-backup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Restore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> request</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;app-backup-20230328164601&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> submitted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restore describe app-backup-20230328164601\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restore logs app-backup-20230328164601\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> more details.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看恢复任务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> velero</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        BACKUP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      STARTED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                         COMPLETED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                       ERRORS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   WARNINGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                         SELECTOR</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">app-backup-20230328164601</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   app-backup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Completed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   2023-03-28</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 16:46:01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   2023-03-28</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 17:01:26</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CST</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        30</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         2023-03-28</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 16:46:01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0800</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h3 id="验证服务和数据" tabindex="-1">验证服务和数据 <a class="header-anchor" href="#验证服务和数据" aria-label="Permalink to &quot;验证服务和数据&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy,sts,svc,pvc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-system</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   UP-TO-DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AVAILABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/hasura-graphql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/iot-backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/iot-gateway</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/iot-history</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/iot-observer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/app-backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployment.apps/app-frontend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           29m</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                READY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">statefulset.apps/minio</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">statefulset.apps/mongo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">statefulset.apps/postgres</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">statefulset.apps/rabbitmq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">statefulset.apps/redis</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     29m</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        CLUSTER-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                               </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/hasura-graphql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.107.231.148</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        8080/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                              29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/iot-backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.98.78.23</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        3000/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                              29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/iot-gateway</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.108.211.114</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        1880/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                              29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/iot-history</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.98.217.234</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        3000/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                              29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/iot-observer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.105.75.200</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        3010/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                              29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/minio</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.97.14.151</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        9000/TCP,9001/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/mongo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.97.212.84</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        27017/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                             29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/app-backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.107.16.116</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        5959/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                              29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/app-frontend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.100.136.90</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        80/TCP,443/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/postgres</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.101.235.245</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        5432/TCP,9187/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/rabbitmq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.108.29.67</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        15672/TCP,5672/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service/redis</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.101.105.81</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        6379/TCP,9121/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     29m</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                       STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   VOLUME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                     CAPACITY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ACCESS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MODES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STORAGECLASS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">persistentvolumeclaim/data-minio-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-ca5c63bf-9aaa-4755-ad8f-35718f51decf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   50Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            openebs-hostpath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">persistentvolumeclaim/data-mongo-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-03203801-e339-44ee-bfb4-b196808c7cc5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   50Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            openebs-hostpath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">persistentvolumeclaim/data-postgres-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-e2f2593e-5869-420c-bd39-54ce01dfa63f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   300Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            openebs-hostpath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">persistentvolumeclaim/data-redis-0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-a8e4445c-c6b5-483b-8b18-9d650daf35cc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   2Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            openebs-hostpath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">persistentvolumeclaim/app-backend</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-2b2f9747-a020-4a16-9975-2491457c4032</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   10Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            openebs-hostpath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29m</span></span></code></pre></div>`,93),k=[l];function p(t,e,F,r,d,g){return a(),i("div",{"data-pagefind-body":!0},k)}const C=s(h,[["render",p]]);export{y as __pageData,C as default};
