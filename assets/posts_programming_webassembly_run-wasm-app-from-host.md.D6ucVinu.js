import{j as s,c as i,b as a,aa as n}from"./chunks/framework.Cst8pIsI.js";const F=JSON.parse('{"title":"WebAssemblyç³»åˆ—äºŒï¼šä½¿ç”¨ WasmEdge Rust SDK æ„å»ºå¹¶è¿è¡Œ WebAssembly åº”ç”¨ç¨‹åº","description":"","frontmatter":{"sidebar":false,"cover":"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-and-wasm-cover.png","date":"2024-03-11T00:00:00.000Z","tag":["Rust","WebAssembly","å…¨æ ˆå¼€å‘"],"sticky":1,"prev":{"text":"WebAssemblyç³»åˆ—ä¸€ï¼šRust Web å…¨æ ˆå¼€å‘ä¹‹ç¼–å†™ WebAssembly åº”ç”¨","link":"/posts/programming/webassembly/webassembly-full-stack-app"},"head":[]},"headers":[],"relativePath":"posts/programming/webassembly/run-wasm-app-from-host.md","filePath":"posts/programming/webassembly/run-wasm-app-from-host.md","lastUpdated":1738671020000}'),h={name:"posts/programming/webassembly/run-wasm-app-from-host.md"},p=n(`<h1 id="webassemblyç³»åˆ—äºŒ-ä½¿ç”¨-wasmedge-rust-sdk-æ„å»ºå¹¶è¿è¡Œ-webassembly-åº”ç”¨ç¨‹åº" tabindex="-1">WebAssemblyç³»åˆ—äºŒï¼šä½¿ç”¨ WasmEdge Rust SDK æ„å»ºå¹¶è¿è¡Œ WebAssembly åº”ç”¨ç¨‹åº <a class="header-anchor" href="#webassemblyç³»åˆ—äºŒ-ä½¿ç”¨-wasmedge-rust-sdk-æ„å»ºå¹¶è¿è¡Œ-webassembly-åº”ç”¨ç¨‹åº" aria-label="Permalink to &quot;WebAssemblyç³»åˆ—äºŒï¼šä½¿ç”¨ WasmEdge Rust SDK æ„å»ºå¹¶è¿è¡Œ WebAssembly åº”ç”¨ç¨‹åº&quot;">â€‹</a></h1><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åˆ›å»º WebAssembly åº”ç”¨ç¨‹åº<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>ï¼ˆä¹Ÿæ˜¯ wasm åº”ç”¨ç¨‹åºï¼‰ä»¥åŠå¦‚ä½•åœ¨ WasmEdge è¿è¡Œæ—¶ä¸Šè¿è¡Œå®ƒã€‚</p><blockquote><p>WebAssembly åº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªå¸¸è§çš„åº”ç”¨ç¨‹åºï¼Œä½†ç¼–è¯‘ä¸º WebAssembly äºŒè¿›åˆ¶æ–‡ä»¶è€Œä¸æ˜¯é€šç”¨æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ wasm åº”ç”¨ç¨‹åºåœ¨ WebAssembly ç¯å¢ƒä¸­è¿è¡Œã€‚ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬é€šå¸¸å°†å…¶ç§°ä¸º wasm åº”ç”¨ç¨‹åºã€‚</p></blockquote><h2 id="æ¶æ„" tabindex="-1">æ¶æ„ <a class="header-anchor" href="#æ¶æ„" aria-label="Permalink to &quot;æ¶æ„&quot;">â€‹</a></h2><p>æˆ‘ä»¬å°†ä¸ºæœ¬æ•™ç¨‹åˆ›å»ºä¸¤ä¸ªå•ç‹¬çš„é¡¹ç›®ï¼š</p><ul><li><code>wasm-app</code> é¡¹ç›®åˆ›å»ºäº†ä¸€ä¸ª wasm åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­å±å¹•ä¸Šæ‰“å°å‡ºä¸€æ¡ç®€å•çš„é—®å€™æ¶ˆæ¯ã€‚</li><li><code>run-wasm-app</code> é¡¹ç›®åˆ›å»ºä¸€ä¸ª WasmEdge Vm å®ä¾‹ï¼ŒåŠ è½½ <code>wasm-app</code> çš„äºŒè¿›åˆ¶æ–‡ä»¶å¹¶é€šè¿‡ WasmEdge Runtime è¿è¡Œå®ƒã€‚</li></ul><p>æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨çš„é¡¹ç›®çš„æ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼šç»¿è‰²çŸ©å½¢æ˜¯æˆ‘ä»¬å°†åˆ›å»ºçš„ä¸¤ä¸ªé¡¹ç›®ï¼Œè“è‰²çŸ©å½¢æ˜¯ä¾èµ–é¡¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/second-state/wasmedge-rustsdk-examples/run-wasm-app-from-host/architecture.png" alt="" loading="lazy"></p><h2 id="å‰ç½®æ¡ä»¶" tabindex="-1">å‰ç½®æ¡ä»¶ <a class="header-anchor" href="#å‰ç½®æ¡ä»¶" aria-label="Permalink to &quot;å‰ç½®æ¡ä»¶&quot;">â€‹</a></h2><ul><li><p>æ“ä½œç³»ç»Ÿï¼šUbuntu-20.04+ã€macOS-11+ã€Windows WSL2</p></li><li><p>å®‰è£… <code>rustup</code> å’Œ Rust</p><p>æŒ‰ç…§ Rust-lang å®˜æ–¹ç½‘ç«™ä¸Šçš„è¯´æ˜å®‰è£… rustup å’Œ Rust<sup>[2]</sup>ï¼› ç„¶åï¼Œåœ¨ç»ˆç«¯ç¨‹åºä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤å°† <code>wasm32-wasi</code><sup>[3]</sup> ç›®æ ‡æ·»åŠ åˆ°å·¥å…·é“¾ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> å°†</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wasm32-wasi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ç¼–è¯‘ç›®æ ‡æ·»åŠ åˆ°å·¥å…·é“¾ä¸­</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rustup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ç›®æ ‡æ·»åŠ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wasm32-wasi</span></span></code></pre></div><blockquote><p>[2] Rustè¯­è¨€ç‰ˆæœ¬åº”ä¸º1.63æˆ–ä»¥ä¸Šã€‚</p><p>[3] wasm32-wasiç›®æ ‡ä»‹ç»</p></blockquote></li><li><p>å®‰è£… WasmEdge è¿è¡Œæ—¶åº“</p><p>WasmEdge è¿è¡Œæ—¶åº“ (libwasmedge) æ˜¯ä¸€ä¸ª C++ åº“ï¼Œå®ƒæä¾› WebAssembly è¿è¡Œæ—¶ã€‚ åœ¨æœ¬æ•™ç¨‹ä¸­æˆ‘ä»¬ä½¿ç”¨ WasmEdge v0.13.5ã€‚ Wasmedge Book çš„<a href="https://wasmedge.org/book/en/quick_start/install.html" target="_blank" rel="noreferrer">å®‰è£…å’Œå¸è½½éƒ¨åˆ†</a>ç»™å‡ºäº†å®‰è£…æ–¹æ³•ï¼Œæˆ–è€…æ‚¨ä¹Ÿå¯ä»¥åœ¨ç»ˆç«¯ç¨‹åºä¸­è¿è¡Œä»¥ä¸‹æŒ‡ä»¤è¿›è¡Œå®‰è£…ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Download</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> installation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> script</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> The</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wasmedge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> library</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> other</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> relevant</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> files</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> will</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> be</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> installed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/.wasmedge</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sSf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.githubusercontent.com/WasmEdge/WasmEdge/master/utils/install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> installed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> binary</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> available</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> current</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> session</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> terminal</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> program</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/.wasmedge/env</span></span></code></pre></div></li></ul><h2 id="æ„å»ºåº”ç”¨ç¨‹åº" tabindex="-1">æ„å»ºåº”ç”¨ç¨‹åº <a class="header-anchor" href="#æ„å»ºåº”ç”¨ç¨‹åº" aria-label="Permalink to &quot;æ„å»ºåº”ç”¨ç¨‹åº&quot;">â€‹</a></h2><p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º<code>run-wasm-app-from-host</code>çš„ç›®å½•ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­å®Œæˆæ‰€æœ‰ç¼–ç å·¥ä½œï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run-wasm-app-from-host</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run-wasm-app-from-host</span></span></code></pre></div><h3 id="æ­¥éª¤ä¸€-åˆ›å»ºwasmåº”ç”¨ç¨‹åºwasm-app" tabindex="-1">æ­¥éª¤ä¸€ï¼šåˆ›å»ºwasmåº”ç”¨ç¨‹åº<code>wasm-app</code> <a class="header-anchor" href="#æ­¥éª¤ä¸€-åˆ›å»ºwasmåº”ç”¨ç¨‹åºwasm-app" aria-label="Permalink to &quot;æ­¥éª¤ä¸€ï¼šåˆ›å»ºwasmåº”ç”¨ç¨‹åº\`wasm-app\`&quot;">â€‹</a></h3><p>åˆ›å»º wasm åº”ç”¨ç¨‹åºé¡¹ç›®å’Œæ™®é€š Rust åº”ç”¨ç¨‹åºé¡¹ç›®æ²¡æœ‰åŒºåˆ«ã€‚ åœ¨ç»ˆç«¯ç¨‹åºä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run-wasm-app-from-host/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Rust</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> application</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> named</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wasm-app</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wasm-app</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --bin</span></span></code></pre></div><p>æ­¤å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸º <code>wasm-app</code> çš„ç›®å½•ï¼Œå…¶ä¸­åŒ…å«æ ·æ¿ Rust åº”ç”¨ç¨‹åºã€‚ è®©æˆ‘ä»¬å¯¼èˆªåˆ° <code>wasm-app/src</code> ç›®å½•ï¼Œæ‰“å¼€ <code>main.rs</code> å¹¶åœ¨ <code>main</code> å‡½æ•°ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// run-wasm-app-from-host/wasm-app/src/main.rs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // add the following line</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  println!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Greetings from wasm-app!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å½“ç¨åè°ƒç”¨ wasm åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šæ‰“å°æ¶ˆæ¯ <code>Greetings from wasm-app!</code> åœ¨ä½ çš„ç»ˆç«¯ç¨‹åºä¸­ã€‚</p><h3 id="æ­¥éª¤äºŒ-ç¼–è¯‘wasm-app" tabindex="-1">æ­¥éª¤äºŒï¼šç¼–è¯‘<code>wasm-app</code> <a class="header-anchor" href="#æ­¥éª¤äºŒ-ç¼–è¯‘wasm-app" aria-label="Permalink to &quot;æ­¥éª¤äºŒï¼šç¼–è¯‘\`wasm-app\`&quot;">â€‹</a></h3><p>ç°åœ¨è®©æˆ‘ä»¬å°† wasm åº”ç”¨ç¨‹åºç¼–è¯‘æˆ wasm äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ä¸ºæ­¤ï¼Œåªéœ€åœ¨ç»ˆç«¯ç¨‹åº<code>run-wasm-app-from-host</code>ç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wasm-app</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wasm32-wasi</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --release</span></span></code></pre></div><p>è¯¥å‘½ä»¤ä¼šå°† wasm åº”ç”¨ç¨‹åºç¼–è¯‘æˆä½äºç›®å½•ä¸­çš„ <code>wasm-app.wasm</code> æ–‡ä»¶ <code>./target/wasm32-wasi/release/</code></p><h3 id="æ­¥éª¤ä¸‰-åˆ›å»ºä¸»ç¨‹åºrun-wasm-app" tabindex="-1">æ­¥éª¤ä¸‰ï¼šåˆ›å»ºä¸»ç¨‹åº<code>run-wasm-app</code> <a class="header-anchor" href="#æ­¥éª¤ä¸‰-åˆ›å»ºä¸»ç¨‹åºrun-wasm-app" aria-label="Permalink to &quot;æ­¥éª¤ä¸‰ï¼šåˆ›å»ºä¸»ç¨‹åº\`run-wasm-app\`&quot;">â€‹</a></h3><p>åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª wasm ä¸»æœºåº”ç”¨ç¨‹åºï¼Œé€šè¿‡å®ƒæ¥è¿è¡Œ wasm åº”ç”¨ç¨‹åºã€‚ åœ¨<code>run-wasm-app-from-host</code>æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run-wasm-app</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --bin</span></span></code></pre></div><h4 id="æ·»åŠ ä¾èµ–" tabindex="-1">æ·»åŠ ä¾èµ– <a class="header-anchor" href="#æ·»åŠ ä¾èµ–" aria-label="Permalink to &quot;æ·»åŠ ä¾èµ–&quot;">â€‹</a></h4><p>åœ¨ <code>main.rs</code> ä¸­æ·»åŠ ä»»ä½•ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å°†ä¸ºè¯¥é¡¹ç›®æ·»åŠ ä¾èµ–é¡¹ã€‚ è®©æˆ‘ä»¬å¯¼èˆªåˆ° <code>run-wasm-app</code> ç›®å½•ï¼Œæ‰“å¼€ <code>run-wasm-app</code> ç›®å½•ä¸­çš„ <code>Cargo.toml</code>ï¼Œå¹¶åœ¨ <code>[dependencies]</code> éƒ¨åˆ†æ·»åŠ  <code>wasmedge-sdk</code>ï¼š</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">edition = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2021&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;run-wasm-app&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">version = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.1.0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wasmedge-sdk = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.13.2&quot;</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">  // add \`wasmedge-sdk\` crate</span></span></code></pre></div><p><code>wasmedge-sdk</code> crate å®šä¹‰äº†ä¸€ç»„é«˜çº§ Rust APIã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥åˆ›å»ºå’Œç®¡ç† WasmEdge è™šæ‹Ÿæœºã€åœ¨å…¶ä¸­è¿è¡ŒæŸäº›å†…å®¹ç­‰ç­‰ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ‰“å¼€ <code>run-wasm-app/src</code> ç›®å½•ä¸­çš„ <code>main.rs</code> æ–‡ä»¶ï¼Œå°†ä¸€äº›å¿…è¦çš„ç±»å‹å¯¼å…¥åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå¹¶å¯¹ <code>main</code> å‡½æ•°è¿›è¡Œä¸€äº›æ›´æ”¹<sup>[4]</sup>ï¼š</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> wasmedge_sdk</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CommonConfigOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ConfigBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HostRegistrationConfigOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    params, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VmBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;(), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Box</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">dyn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> std</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>[4] æˆ‘ä»¬åœ¨åŸæ¥çš„ <code>main</code> å‡½æ•°ä¸­æ·»åŠ äº†ä¸€ä¸ªè¿”å›ç±»å‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>?</code> æ“ä½œç¬¦ä»¥é¿å…å¤§é‡çš„ <code>unwrap</code> æˆ– <code>Expect</code> æ–¹æ³•å¹¶ä½¿ä»£ç ç®€æ´ã€‚</p></blockquote><h4 id="åˆ›å»ºwasmedge-vmå®ä¾‹" tabindex="-1">åˆ›å»ºWasmEdge VMå®ä¾‹ <a class="header-anchor" href="#åˆ›å»ºwasmedge-vmå®ä¾‹" aria-label="Permalink to &quot;åˆ›å»ºWasmEdge VMå®ä¾‹&quot;">â€‹</a></h4><p>åœ¨ WasmEdge Runtime ä¸­ï¼ŒVm å®ä¾‹é€šè¿‡ <code>wasi</code> æ¥å£è¿è¡Œ wasm åº”ç”¨ç¨‹åºã€‚ å› æ­¤ï¼Œå½“æˆ‘ä»¬åˆ›å»º Vm å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬å°†å¯ç”¨ <code>wasi</code> é€‰é¡¹çš„ <code>Config</code> å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ã€‚ ç”±äºå¯ç”¨äº† <code>wasi</code> é€‰é¡¹ï¼Œåœ¨åˆ›å»ºæ–°çš„ Vm å®ä¾‹æ—¶è¿˜ä¼šåˆ›å»ºä¸€ä¸ªåä¸º<code>wasi_snapshot_preview1</code>çš„é»˜è®¤ <code>wasi</code> æ¨¡å—ã€‚</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;(), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Box</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">dyn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> std</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wasm_app_file </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">env</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Please specify a wasm file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // create a config with the \`wasi\` option enabled</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ConfigBuilder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CommonConfigOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">with_host_registration_config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HostRegistrationConfigOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wasi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    assert!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wasi_enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // create a VM with the config</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VmBuilder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">with_config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(config)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="åˆå§‹åŒ–é»˜è®¤wasiæ¨¡å—" tabindex="-1">åˆå§‹åŒ–é»˜è®¤wasiæ¨¡å— <a class="header-anchor" href="#åˆå§‹åŒ–é»˜è®¤wasiæ¨¡å—" aria-label="Permalink to &quot;åˆå§‹åŒ–é»˜è®¤wasiæ¨¡å—&quot;">â€‹</a></h4><div class="warning custom-block"><p class="custom-block-title">æ³¨æ„ğŸ“¢ï¼š</p><p>è¦ä½¿ç”¨é»˜è®¤ <code>wasi</code> æ¨¡å—ä¸­çš„å¯¼å‡ºå‡½æ•°ï¼Œéœ€è¦ä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„å¿…è¦å‚æ•°æ¥åˆå§‹åŒ–é»˜è®¤ <code>wasi</code> æ¨¡å—ã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»…å°†ä¸‰ä¸ªé»˜è®¤å€¼ <code>None</code> ä¼ é€’ç»™åˆå§‹åŒ–æ–¹æ³•ã€‚</p></div><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;(), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Box</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">dyn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> std</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // get the default wasi module in Vm, and then</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  	// initialize it with the default arguments</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wasi_module_mut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Not found wasi module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">initialize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="æ³¨å†Œå¹¶è¿è¡Œwasmç¨‹åºwasm-app-wasm" tabindex="-1">æ³¨å†Œå¹¶è¿è¡Œwasmç¨‹åº<code>wasm-app.wasm</code> <a class="header-anchor" href="#æ³¨å†Œå¹¶è¿è¡Œwasmç¨‹åºwasm-app-wasm" aria-label="Permalink to &quot;æ³¨å†Œå¹¶è¿è¡Œwasmç¨‹åº\`wasm-app.wasm\`&quot;">â€‹</a></h4><p>åœ¨å‰é¢çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å·²ç»è®¾ç½®äº†ä¸€ä¸ª WasmEdge Vm å®ä¾‹ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°† wasm åº”ç”¨ç¨‹åºæ³¨å†Œåˆ° Vm å®ä¾‹ä¸­å¹¶è¿è¡Œå®ƒã€‚ <code>wasmedge-sdk</code> crate åœ¨ Vm å¯¹è±¡ä¸­å®šä¹‰äº†ä¸‰ä¸ª API ç”¨äºæ³¨å†Œ wasm æ¨¡å—ï¼š</p><ul><li><code>register_module_from_file</code> å°†ç»™å®š wasm æ–‡ä»¶ä¸­çš„ wasm æ¨¡å—æ³¨å†Œåˆ° Vm å®ä¾‹ä¸­ã€‚</li><li><code>register_module_from_bytes</code> å°†ç»™å®šå†…å­˜ä¸­ wasm å­—èŠ‚ä¸­çš„ wasm æ¨¡å—æ³¨å†Œåˆ° Vm å®ä¾‹ä¸­ã€‚</li><li><code>register_module</code> å°†ç¼–è¯‘åçš„ wasm æ¨¡å—æ³¨å†Œåˆ° Vm å®ä¾‹ä¸­ã€‚</li></ul><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>register_module_from_file</code> API å°† <code>wasm-app.wasm</code> æ–‡ä»¶ç›´æ¥æ³¨å†Œåˆ° Vm å®ä¾‹ä¸­ï¼š</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;(), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Box</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">dyn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> std</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // register the \`wasm-app.wasm\` file as a wasm module named &quot;wasm-app&quot; into vm</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">register_module_from_file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wasm-app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wasm_app_file)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run_func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wasm-app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;_start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">params!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>wasm-app</code> wasm æ¨¡å—ä¸­çš„ <code>_start</code><sup>[5]</sup> wasm å‡½æ•°æ¥è¿è¡Œ wasm åº”ç”¨ç¨‹åºã€‚</p><blockquote><p>[5] wasm åº”ç”¨ç¨‹åºä¸­çš„ <code>main</code> å‡½æ•°å¯¼å‡ºä¸ºåä¸º <code>_start</code> çš„ <code>wasm</code> å‡½æ•°ã€‚</p></blockquote><h3 id="æ­¥éª¤å››-è¿è¡Œrun-wasm-appè°ƒç”¨wasm-app" tabindex="-1">æ­¥éª¤å››ï¼šè¿è¡Œ<code>run-wasm-app</code>è°ƒç”¨<code>wasm-app</code> <a class="header-anchor" href="#æ­¥éª¤å››-è¿è¡Œrun-wasm-appè°ƒç”¨wasm-app" aria-label="Permalink to &quot;æ­¥éª¤å››ï¼šè¿è¡Œ\`run-wasm-app\`è°ƒç”¨\`wasm-app\`&quot;">â€‹</a></h3><p>åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰€æœ‰çš„ç¼–ç ä»»åŠ¡ã€‚ æˆ‘ä»¬å¯ä»¥å¯¼èˆªåˆ°ç»ˆç«¯ç¨‹åºä¸­çš„<code>run-wasm-app-from-host/run-wasm-app</code>ç›®å½•ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cargo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run-wasm-app</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./target/wasm32-wasi/release/wasm-app.wasm</span></span></code></pre></div><p>å¦‚æœå‘½ä»¤æˆåŠŸè¿è¡Œï¼Œåˆ™å±å¹•ä¸Šä¼šæ‰“å°ä»¥ä¸‹æ¶ˆæ¯ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Greetings</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wasm-app!</span></span></code></pre></div><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://webassembly.org/" target="_blank" rel="noreferrer">WebAssembly åº”ç”¨ç¨‹åº</a> <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p></li></ol></section>`,53),t=[p];function l(e,k,d,r,g,o){return a(),i("div",null,t)}const c=s(h,[["render",l]]);export{F as __pageData,c as default};
