<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubevela系列四：插件指南-轻松扩展你的平台专属能力 | 皮特ᴾᵗ的博客技术站</title>
    <meta name="description" content="热衷于云原生技术，一直为实现自我价值而执着！">
    <meta name="generator" content="VitePress v1.0.0-rc.40">
    <link rel="preload stylesheet" href="/tech-blog/assets/style.CzvnUS5M.css" as="style">
    
    <script type="module" src="/tech-blog/assets/app.D9nM2Xk_.js"></script>
    <link rel="preload" href="/tech-blog/assets/inter-roman-latin.Bu8hRsVA.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/tech-blog/assets/chunks/framework.CrmOCDlt.js">
    <link rel="modulepreload" href="/tech-blog/assets/chunks/theme.ys9JNCdx.js">
    <link rel="modulepreload" href="/tech-blog/assets/posts_kubevela_addon-build-instruction.md.DkTNRWkI.lean.js">
    <link rel="icon" href="/tech-blog/favicon.ico">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <script>import("/tech-blog/pagefind/pagefind.js").then(i=>{window.__pagefind__=i,i.init()}).catch(()=>{});</script>
  </head>
  <body><!--v-if--><!--teleport anchor-->
    <div id="app"><div class="Layout" data-v-09f3288b data-v-21075639><!--[--><!--[--><!--]--><!----><!--[--><div style="display:none;" class="theme-blog-popover" data-pagefind-ignore="all" data-v-686e1061><div class="header" data-v-686e1061><div class="title-wrapper" data-v-686e1061><i class="el-icon" style="font-size:20px;" data-v-686e1061><!--[--><svg width="512" height="512" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-686e1061><path fill="currentColor" d="M880 112c-3.8 0-7.7.7-11.6 2.3L292 345.9H128c-8.8 0-16 7.4-16 16.6v299c0 9.2 7.2 16.6 16 16.6h101.6c-3.7 11.6-5.6 23.9-5.6 36.4c0 65.9 53.8 119.5 120 119.5c55.4 0 102.1-37.6 115.9-88.4l408.6 164.2c3.9 1.5 7.8 2.3 11.6 2.3c16.9 0 32-14.2 32-33.2V145.2C912 126.2 897 112 880 112M344 762.3c-26.5 0-48-21.4-48-47.8c0-11.2 3.9-21.9 11-30.4l84.9 34.1c-2 24.6-22.7 44.1-47.9 44.1" data-v-686e1061></path></svg><!--]--></i><span class="title" data-v-686e1061></span></div><i class="el-icon close-icon" style="font-size:20px;" data-v-686e1061><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-686e1061><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336z"></path></svg><!--]--></i></div><!----><div class="footer content" data-v-686e1061><!--[--><!--]--></div></div><div style="display:none;" class="theme-blog-popover-close" data-v-686e1061><i class="el-icon" style="" data-v-686e1061><!--[--><svg width="512" height="512" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-686e1061><path fill="currentColor" d="M880 112c-3.8 0-7.7.7-11.6 2.3L292 345.9H128c-8.8 0-16 7.4-16 16.6v299c0 9.2 7.2 16.6 16 16.6h101.6c-3.7 11.6-5.6 23.9-5.6 36.4c0 65.9 53.8 119.5 120 119.5c55.4 0 102.1-37.6 115.9-88.4l408.6 164.2c3.9 1.5 7.8 2.3 11.6 2.3c16.9 0 32-14.2 32-33.2V145.2C912 126.2 897 112 880 112M344 762.3c-26.5 0-48-21.4-48-47.8c0-11.2 3.9-21.9 11-30.4l84.9 34.1c-2 24.6-22.7 44.1-47.9 44.1" data-v-686e1061></path></svg><!--]--></i></div><!--]--><!--]--><!--[--><span tabindex="-1" data-v-1e759561></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-1e759561> Skip to content </a><!--]--><!----><header class="VPNav" data-v-21075639 data-v-0c54f761><div class="VPNavBar" data-v-0c54f761 data-v-f94fb682><div class="wrapper" data-v-f94fb682><div class="container" data-v-f94fb682><div class="title" data-v-f94fb682><div class="VPNavBarTitle" data-v-f94fb682 data-v-f60f3c36><a class="title" href="/tech-blog/" data-v-f60f3c36><!--[--><!--]--><!--[--><img class="VPImage logo" src="/tech-blog/selfie.jpeg" alt data-v-47f05eb2><!--]--><!--[-->皮特ᴾᵗ的博客技术站<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-f94fb682><div class="content-body" data-v-f94fb682><!--[--><!--]--><div class="blog-search search" data-pagefind-ignore="all" data-v-f94fb682 style="--98c67658:1;" data-v-da895e55><div class="nav-search-btn-wait" data-v-da895e55><svg width="14" height="14" viewBox="0 0 20 20" data-v-da895e55><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" data-v-da895e55></path></svg><span class="search-tip" data-v-da895e55>Search</span><span class="metaKey" data-v-da895e55> K </span></div><!--teleport start--><!--teleport end--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-f94fb682 data-v-b31b871d><span id="main-nav-aria-label" class="visually-hidden" data-v-b31b871d>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tech-blog/" tabindex="0" data-v-b31b871d data-v-d8664203><!--[--><span data-v-d8664203>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tech-blog/aboutme.html" tabindex="0" data-v-b31b871d data-v-d8664203><!--[--><span data-v-d8664203>关于我</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-f94fb682 data-v-ac37ec1e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-ac37ec1e data-v-59697b90 data-v-857b25b1><span class="check" data-v-857b25b1><span class="icon" data-v-857b25b1><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-59697b90><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-59697b90><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-f94fb682 data-v-8220d49d data-v-0a5b7081><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hyperter96/tech-blog" aria-label="github" target="_blank" rel="noopener" data-v-0a5b7081 data-v-7d37ff8d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-f94fb682 data-v-1c208a81 data-v-d2970a7c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d2970a7c><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-d2970a7c><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-d2970a7c><div class="VPMenu" data-v-d2970a7c data-v-8dc6b217><!----><!--[--><!--[--><!----><div class="group" data-v-1c208a81><div class="item appearance" data-v-1c208a81><p class="label" data-v-1c208a81>Appearance</p><div class="appearance-action" data-v-1c208a81><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-1c208a81 data-v-59697b90 data-v-857b25b1><span class="check" data-v-857b25b1><span class="icon" data-v-857b25b1><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-59697b90><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-59697b90><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-1c208a81><div class="item social-links" data-v-1c208a81><div class="VPSocialLinks social-links-list" data-v-1c208a81 data-v-0a5b7081><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hyperter96/tech-blog" aria-label="github" target="_blank" rel="noopener" data-v-0a5b7081 data-v-7d37ff8d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-f94fb682 data-v-7e15cad8><span class="container" data-v-7e15cad8><span class="top" data-v-7e15cad8></span><span class="middle" data-v-7e15cad8></span><span class="bottom" data-v-7e15cad8></span></span></button></div></div></div></div><div class="divider" data-v-f94fb682><div class="divider-line" data-v-f94fb682></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-21075639 data-v-ea773f8a><div class="container" data-v-ea773f8a><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-ea773f8a data-v-e8fc447c><button data-v-e8fc447c>回到顶部</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-pagefind-body data-v-21075639 data-v-3e9b78e1><div class="VPDoc has-aside" data-v-3e9b78e1 data-v-ba7be00d><!--[--><!--]--><div class="container" data-v-ba7be00d><div class="aside" data-v-ba7be00d><div class="aside-curtain" data-v-ba7be00d></div><div class="aside-container" data-v-ba7be00d><div class="aside-content" data-v-ba7be00d><div class="VPDocAside" data-v-ba7be00d data-v-f55aa0d9><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-f55aa0d9 data-v-b387d0a5><div class="content" data-v-b387d0a5><div class="outline-marker" data-v-b387d0a5></div><div class="outline-title" role="heading" aria-level="2" data-v-b387d0a5>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-b387d0a5><span class="visually-hidden" id="doc-outline-aria-label" data-v-b387d0a5> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-b387d0a5 data-v-0dd42dc0><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-f55aa0d9></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-ba7be00d><div class="content-container" data-v-ba7be00d><!--[--><!--[--><!--[--><!--[--><!--]--><!----><!--]--><!--]--><!--]--><main class="main" data-v-ba7be00d><div style="position:relative;" class="vp-doc _tech-blog_posts_kubevela_addon-build-instruction" data-v-ba7be00d><div><h1 id="kubevela系列四-插件指南-轻松扩展你的平台专属能力" tabindex="-1">Kubevela系列四：插件指南-轻松扩展你的平台专属能力 <a class="header-anchor" href="#kubevela系列四-插件指南-轻松扩展你的平台专属能力" aria-label="Permalink to &quot;Kubevela系列四：插件指南-轻松扩展你的平台专属能力&quot;">​</a></h1><p>KubeVela 插件（addon）可以方便地扩展 KubeVela 的能力。正如我们所知，KubeVela 是一个微内核高度可扩展的平台，用户可以通过 <a href="https://kubevela.net/zh/docs/platform-engineers/oam/x-definition" target="_blank" rel="noreferrer">模块定义（Definition）</a>扩展 KubeVela 的系统能力，而 KubeVela 插件正是方便将这些<strong>自定义扩展</strong>及其<strong>依赖</strong>打包并分发的核心功能。不仅如此，KubeVela 社区的插件中心也在逐渐壮大，如今已经有超过 50 款插件，涵盖可观测性、微服务、FinOps、云资源、安全等大量场景功能。</p><p>这篇博客将会全方位介绍 KubeVela 插件的核心机制，教你如何编写一个自定义插件。在最后，我们将展示最终用户使用插件的体验，以及插件将如何融入到 KubeVela 平台，为用户提供一致的体验。</p><h2 id="为什么要使用-kubevela-插件" tabindex="-1">为什么要使用 KubeVela 插件 <a class="header-anchor" href="#为什么要使用-kubevela-插件" aria-label="Permalink to &quot;为什么要使用 KubeVela 插件&quot;">​</a></h2><p>用户使用插件的一个典型方法是通过 KubeVela 团队维护的 <a href="https://github.com/kubevela/catalog" target="_blank" rel="noreferrer">插件中心（addon catalog）</a> ，它包含了 KubeVela 团队与社区开发者精心编写的系统扩展功能，并以插件的形式发布于插件中心，这样你可以一键下载并安装这些插件。例如安装 FluxCD 可以快速给你的 KubeVela Application 提供部署 Helm Chart 的能力。</p><p>相较于使用 KubeVela 的插件功能，如果你自己的内部平台想要集成一个云原生的功能，你大概会这么做：</p><ol><li>通过 Helm Chart 或者下载 yaml 文件手动安装 FluxCD 或类似的 CRD Operator。</li><li>编写系统集成的代码，让用户界面可以通过统一的方式使用 FluxCD 等 CRD 的功能，在 KubeVela 系统中就是通过编写模块定义（OAM Definition）完成。</li></ol><p>实际上，在 KubeVela 1.1 版本之前，我们也是通过类似的方式完成的。这会带来如下问题：</p><ol><li><strong>操作繁琐</strong>：用户需要手动查阅文档如何安装 FluxCD 并处理可能发生的错误</li><li><strong>资源分散</strong>：用户需要下载不同的文件，既需要安装 Helm 安装 FluxCD 还需要下载模块定义等系统扩展的集成配置</li><li><strong>难以分发复用</strong>：用户需要手动下载模块定义就注定了这些资源难以以一个统一的方式分发给用户，也无法形成社区生态让不同的用户可以享受社区便利</li><li><strong>缺少多集群支持</strong>：KubeVela 将多集群交付作为一等公民，而这样的手动安装系统扩展的方式显然难以维护多集群的环境</li><li><strong>无版本管理</strong>：用户需要手动管理模块定义和 Controller 之间的版本</li></ol><p>而 KubeVela 插件就是为了逐一解决这些问题而诞生的。</p><h2 id="kubevela-插件是如何工作的" tabindex="-1">KubeVela 插件是如何工作的 <a class="header-anchor" href="#kubevela-插件是如何工作的" aria-label="Permalink to &quot;KubeVela 插件是如何工作的&quot;">​</a></h2><p>KubeVela 的插件主要包含两部分：</p><ul><li>一部分是安装能力的提供者，通常是一个 CRD Operator/Controller。这个<strong>安装过程实质上就是运行一个 OAM 应用</strong>，addon 交付中所使用的功能与普通应用能力完全等价。</li><li>另一部分就是扩展能力跟 KubeVela 体系的粘合层，也就是模块定义和其他的一些集成配置。OAM 模块定义为用户提供了插件扩展出的组件、运维特征以及工作流步骤等功能，也帮助 CRD Operator 提供用户友好的抽象，使得最终用户无需理解复杂的 CRD 参数，只需要根据最佳实践提供必要的参数。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/addon-mechanism.jpg" alt="" loading="lazy"></p><p>插件的工作机制如上图所示，KubeVela 的应用具备多集群交付的能力，所以也能帮助插件中的 CRD Operator 部署到这些集群中。模块定义文件仅需要在控制面被 KubeVela 使用，所以无需部署到被管控的集群中。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>一旦插件被安装，就会创建一个 KubeVela 应用，包含所有的相关资源和配置，这些配置都会设置 KubeVela 应用对外作为 OwnerReference（父节点）。当我们想要卸载一个插件时，只需要删除这个应用，Kubernetes 提供的资源回收机制会自动将标记了 OwnerReference 的资源一并删除。</p></div><p>例如一个 Redis 插件，它能让用户在自己的应用中使用 Redis 集群类型的组件（Component），这样可以快速创建 Redis 集群。那么这个插件至少会包括一个 Redis Operator 来提供创建 Redis 集群的能力（通过 Application 描述），还有一个组件的模块定义 （ComponentDefinition） 来提供 Redis 集群的组件类型。</p><p>所有整个插件的安装过程会将 Redis Operator 放在一个 KubeVela 应用中下发到多集群，而组件定义和 UI 扩展等配置文件则只部署到控制面集群并设置应用对象为 OwnerReference。</p><h2 id="创建自己的插件" tabindex="-1">创建自己的插件 <a class="header-anchor" href="#创建自己的插件" aria-label="Permalink to &quot;创建自己的插件&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>为保证以下内容功能全部可用，请确保你的 KubeVela 版本 为 v1.5+。</p></div><p>我们将以 Redis 插件为例，讲解如何从头创建一个 KubeVela 插件的实际过程。本次完整的 Redis 插件代码见 <a href="https://github.com/kubevela/catalog/tree/master/experimental/addons/redis-operator" target="_blank" rel="noreferrer">catalog/redis-operator</a>。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>在这里我们会尽可能全面的介绍制作插件中涉及的核心知识，但是作为一个介绍性博客，我们会尽量避免讨论过深的细节以免篇幅过于膨胀，了解完整的功能及细节可以参考<a href="https://kubevela.net/zh/docs/platform-engineers/addon/intro" target="_blank" rel="noreferrer">自定义插件文档</a>。</p></div><p><strong>首先我们需要思考我们要创建的插件有什么作用？</strong> 例如我们假设 Redis 插件可以提供 <code>redis-failover</code> 类型的 Component，这样用户只需在 Application 中定义一个 <code>redis-failover</code> Component 即可快速创建 Redis 集群。</p><p><strong>然后考虑如何达到这个目的？</strong> 要提供 <code>redis-failover</code> 类型的 Component 我们需要定义一个 ComponentDefinition ；要提供创建 Redis 集群的能力支持，我们可以使用 <a href="https://github.com/spotahome/redis-operator" target="_blank" rel="noreferrer">Redis Operator</a> 。</p><p>那至此我们的大目标就明确了：</p><ul><li>编写插件的应用描述文件（OAM Application），这将会用于安装 Redis Operator （完整代码可以到插件中心的<a href="https://github.com/kubevela/catalog/blob/master/experimental/addons/redis-operator/template.cue" target="_blank" rel="noreferrer"><code>template.cue</code></a> 及 <a href="https://github.com/kubevela/catalog/tree/master/experimental/addons/redis-operator/resources" target="_blank" rel="noreferrer"><code>resources/</code></a> 目录查看。）</li><li>编写 <code>redis-failover</code> 类型的 <a href="https://kubevela.net/zh/docs/platform-engineers/components/custom-component" target="_blank" rel="noreferrer">ComponentDefinition</a> （完整代码请查看 <a href="https://github.com/kubevela/catalog/tree/master/experimental/addons/redis-operator/definitions" target="_blank" rel="noreferrer"><code>definitions/</code> 目录</a>）</li></ul><p>不过在开始编写之前，我们首先需要了解一个 KubeVela 插件的目录结构。后续我们会在编写的过程中详细说明每个文件的作用，在这里只需大致了解有哪些文件即可。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>命令行工具 <code>vela addon init</code> 可以帮助你创建目录结构的初始化脚手架。</p></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-operator/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> definitions           </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   └── redis-failover.cue </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> resources              </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ├── crd.yaml           </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ├── redis-operator.cue</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">│</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   └── topology.cue       </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metadata.yaml         </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parameter.cue         </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> README.md             </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> template.cue</span></span></code></pre></div><p>让我们逐一来解释它们：</p><ol><li><code>redis-operator/</code> 是目录名，同时也是插件名称，请保持一致。</li><li><code>definitions/</code> 用于存放模块定义, 例如 TraitDefinition 和 ComponentDefinition。</li><li><code>redis-failover.cue</code> 定义我们编写的 redis-failover 组件类型，包含了用户如何使用这个组件的参数以及这个组件与底层资源交互的细节。</li><li><code>resources/</code> 用于存放资源文件, 之后会在 <code>template.cue</code> 中使用他们共同组成一个 KubeVela 应用来部署插件。</li><li><code>crd.yaml</code> 是 Redis Operator 的 Kubernetes 自定义资源定义，在 <code>resources/</code> 文件夹中的 YAML 文件会被直接部署到集群中。</li><li><code>redis-operator.cue</code> 一个 web-service 类型的 Component ，用于安装 Redis Operator。</li><li><code>topology.cue</code> 是可选的，帮助 KubeVela 建立应用所纳管资源的拓扑关系。</li><li><code>metadata.yaml</code> 是插件的元数据，包含插件名称、版本、维护人等，为插件中心提供了概览信息。</li><li><code>parameter.cue</code> 插件参数定义，用户可以利用这些参数在插件安装时做轻量级自定义。</li><li><code>README.md</code> 提供给最终用户阅读，包含插件使用指南等。</li><li><code>template.cue</code> 定义插件最终部署时的完整应用形态，包含一个 OAM 应用模板以及对其他资源对象的引用。</li></ol><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>在插件中制作中我们会广泛使用 CUE 语言来编排配置，如果对 CUE 不熟悉，可以花 10 分钟快速查阅<a href="https://kubevela.net/zh/docs/platform-engineers/cue/basic" target="_blank" rel="noreferrer">入门指南</a>有一个基本了解。</p></div><h3 id="parameter-cue" tabindex="-1"><code>parameter.cue</code> <a class="header-anchor" href="#parameter-cue" aria-label="Permalink to &quot;`parameter.cue`&quot;">​</a></h3><div class="language-cue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cue</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">parameter: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	//+usage=Redis Operator image.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	image: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;quay.io/spotahome/redis-operator:v1.1.0&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 其余省略</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>在 <code>parameter.cue</code> 中定义的参数都是用户可以自定义的（类似于 Helm Values），后续在 template.cue 或者 resources 中可以通过 <code>parameter.&lt;parameter-name&gt;</code> 访问参数。在我们的例子中，用户可以自定义 <code>image</code> ，这样后续我们创建 Redis Operator (<code>redis-operator.cue</code>) 的时候可以通过 <code>parameter.image</code> 使用用户指定的容器镜像。</p><p>参数不仅可以给用户预留安装时的自定义输入，还可以作为安装时的条件进行部分安装。比如 <code>fluxcd</code> 插件有一个参数叫 <a href="https://github.com/kubevela/catalog/blob/master/addons/fluxcd/parameter.cue" target="_blank" rel="noreferrer"><code>onlyHelmComponents</code></a>，它的作用就是可以帮助用户只部署用于安装 Helm Chart 的组件能力，而其他控制器就可以不安装。如果你对于实现细节感兴趣，可以参考fluxcd 插件的 <a href="https://github.com/kubevela/catalog/blob/master/addons/fluxcd/template.cue#L25" target="_blank" rel="noreferrer">这部分配置</a>.</p><p>在设计提供什么参数供用户自定义插件安装时，我们也应该遵循一下这些最佳实践来为用户提供更好的使用体验。</p><div class="tip custom-block"><p class="custom-block-title">最佳实践</p><ul><li>不要在 parameter.cue 中提供大量的细节参数，将大量细节抽象出少量参数供用户调节是一个更好的做法</li><li>为参数提供默认值（如样例中的 image 参数）或将参数标记为可选（如样例的 clusters 参数），确保用户仅使用默认值可以得到一个可用的配置</li><li>为参数提供使用说明（通过注释标记实现，见样例）</li><li>尽量保持插件不同版本间的参数一致，防止因为升级导致不兼容</li></ul></div><h3 id="template-cue-和-resources-目录" tabindex="-1"><code>template.cue</code> 和 <code>resources/</code> 目录 <a class="header-anchor" href="#template-cue-和-resources-目录" aria-label="Permalink to &quot;`template.cue` 和 `resources/` 目录&quot;">​</a></h3><p>这是存放我们应用描述文件的地方，即一个 OAM Application 。这描述了实际的插件安装过程。我们主要会在这里包含 Redis Operator ，给集群提供管理 Redis 集群的能力。</p><p><code>template.cue</code> 和 <code>resources/</code> 目录本质上是相同的，都是构成 KubeVela 应用的组成部分，且都是在同一个 package 下的 CUE 文件。</p><p>那为什么需要 resources 目录呢？除去历史原因，这主要是为了可读性的考虑，在 Application 中包含大量资源的时候 template.cue 可能变得很长，这时我们可以把资源放置在 resource 中增加可读性。一般来说，我们将 Application 的框架放在 template.cue 中，将 Application 内部的 Components、Traits 等信息放在 resource 目录中。</p><h4 id="template-cue" tabindex="-1">template.cue <a class="header-anchor" href="#template-cue" aria-label="Permalink to &quot;template.cue&quot;">​</a></h4><p><code>template.cue</code> 定义了应用的框架，绝大多数内容都是固定写法，具体的作用可以参考代码块中的注释。</p><div class="language-cue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cue</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// template.cue 应用描述文件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// package 名称需要与 resources 目录中 cue 的 package 一致，方便引用 resources 目录中的内容</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Application 模板中多数字段均为固定写法，你需要注意的只有 spec.components</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 这是一个经典的 OAM Application</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	apiVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;core.oam.dev/v1beta1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	kind:       </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Application&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 不需要 metadata</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	spec: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		components: [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			// 创建 Redis Operator</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			redisOperator </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 定义于 resources/redis-operator.cue 中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		policies: [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// 这里会指定安装插件的 namespace ，是否安装至子集群等</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// 多为固定写法，无需记忆，可查阅本次样例的完整代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// https://github.com/kubevela/catalog/blob/master/experimental/addons/redis-operator/template.cue</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// 文档可参照 https://kubevela.net/zh/docs/end-user/policies/references</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 定义资源关联规则，用于将资源粘合在一起。后续会着重介绍</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Documentation: https://kubevela.net/zh/docs/reference/topology-rule</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">outputs: topology: resourceTopology </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 定义于 resources/topology.cue 中</span></span></code></pre></div><p>在插件安装时，系统主要关注两个关键字：</p><ul><li>一是 <code>output</code> 字段，定义了插件对应的应用，在应用内部 <code>spec.components</code> 定义了部署的组件，在我们的例子中引用了存放在 <code>resources/</code> 目录中的 <code>redisOperator</code> 组件。output 中的 Application 对象不是严格的 Kubernetes 对象，其中 metadata 里的内容（主要是插件名称）会被插件安装的过程自动注入。</li><li>另一个是 <code>outputs</code> 字段，定义了除了常规应用之外的配置，任何你想要跟插件一同部署的额外 Kubernetes 对象都可以定义在这里。请注意 outputs 中的这些对象必须遵循 Kubernetes API。</li></ul><h4 id="resources-资源文件" tabindex="-1"><code>resources/</code> 资源文件 <a class="header-anchor" href="#resources-资源文件" aria-label="Permalink to &quot;`resources/` 资源文件&quot;">​</a></h4><p>我们这里使用一个 <code>webservice</code> 类型的 Component 来安装 Redis Operator。当然，如果你可以接受依赖 FluxCD 的话，你也可以使用 <code>helm</code> 类型的 Component 直接安装一个 Helm Chart（因为 <code>helm</code> 类型的 Component 主要由 FluxCD 插件提供）。不过编写 addon 的一个原则是尽量减少外部依赖，所以我们这里使用 KubeVela 内置的 <code>webservice</code> 类型，而不是 <code>helm</code>。</p><div class="language-cue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cue</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// resources/redis-operator.cue</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// package 名称与 template.cue 一致，方便在 template.cue 中引用以下的 redisOperator</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">redisOperator: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 这是 OAM Application 中的 Component ，它将会创建一个 Redis Operator</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// https://kubevela.net/zh/docs/end-user/components/references</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;redis-operator&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;webservice&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	properties: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// Redis Operator 镜像名称，parameter.image 即在 parameter.cue 中用户可自定义的参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		image:           parameter.image</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		imagePullPolicy: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;IfNotPresent&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	traits: [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// 略</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>你可以阅读代码块中的注释了解字段的具体作用。</p><h4 id="kubevela-提供的资源粘合能力" tabindex="-1">KubeVela 提供的资源粘合能力 <a class="header-anchor" href="#kubevela-提供的资源粘合能力" aria-label="Permalink to &quot;KubeVela 提供的资源粘合能力&quot;">​</a></h4><p>值得注意的一个功能是 <a href="https://kubevela.net/zh/docs/reference/topology-rule" target="_blank" rel="noreferrer"><em>资源关联规则 (Resource Topology)</em></a> 。虽然它不是必须的，但是它能帮助 KubeVela 建立应用所纳管资源的拓扑关系。这就是 KubeVela 如何将各种各样的资源粘合成 Application 的。这在我们使用 Kubernetes 自定义资源（CR）的时候特别有用。</p><div class="language-cue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cue</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// resources/topology.cue</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;encoding/json&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resourceTopology: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	apiVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;v1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	kind:       </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ConfigMap&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	metadata: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		name:      </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;redis-operator-topology&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		namespace: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vela-system&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		labels: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">			&quot;rules.oam.dev/resources&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:       </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">			&quot;rules.oam.dev/resource-format&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;json&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	data: rules: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Marshal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		parentResourceType: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			group: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;databases.spotahome.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			kind:  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;RedisFailover&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// RedisFailover CR 会创建以下三类资源</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		childrenResourceType: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				apiVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;apps/v1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				kind:  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;StatefulSet&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			},</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			// KubeVela 内置 Deployment 等资源的拓扑，因此无需继续向下编写</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				apiVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;apps/v1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				kind:  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Deployment&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				apiVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;v1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				kind:  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Service&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>在本例中，<code>redis-failover</code> 类型的 Component 会创建一个 CR ，名为 RedisFailover 。但是在没有资源关联规则的情况下，假设在你的 Application 中使用了 RedisFailover ，虽然我们知道 RedisFailover 管控了数个 Redis Deployment ，但是 KubeVela 并不知道 RedisFailover 之下有 Deployment 。这时我们可以通过 <em>资源关联规则</em> 将我们对于 RedisFailover 的了解<em>告诉</em> KubeVela，这样 KubeVela 可以帮助我们建立起整个应用下面纳管资源的拓扑层级关系。此时你将获得 KubeVela 提供的许多有用功能，效果见 <a href="#运行插件">运行插件</a>。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>资源的拓扑关联功能给我们带来了许多有用的功能，最重要的是为 KubeVela 最终用户使用扩展能力提供了统一体验：</p><ul><li>VelaUX 资源拓扑视图，从应用到底层资源 Pod 的关联关系一应俱全，包括多集群</li><li>统一的 <code>vela exec</code> 命令可以在不同应用组件类型关联的底层容器中执行命令，包括多集群</li><li>统一的 <code>vela port-forward</code> 转发不同类型应用组件关联的底层容器端口，包括多集群</li><li>统一的 <code>vela log</code> 查看不同类型应用组件关联的底层容器日志，包括多集群</li><li>统一的 <code>vela status --pod/--endpoint</code> 查看不同类型应用组件关联的底层容器日志，获得可供访问的地址等，包括多集群</li></ul></div><h3 id="definitions-目录" tabindex="-1"><code>definitions/</code> 目录 <a class="header-anchor" href="#definitions-目录" aria-label="Permalink to &quot;`definitions/` 目录&quot;">​</a></h3><p>Definitions 目录存放 KubeVela <a href="https://kubevela.io/docs/getting-started/definition" target="_blank" rel="noreferrer">模块定义（Definition）</a>，包括组件定义（ComponentDefinition）、策略定义（TraitDefinition）等。**这是插件中最重要的部分，因为它包含了最终用户安装这个插件以后可以获得哪些功能。**有了这里定义的组件、运维特征、工作流等类型，最终用户就可以在应用中使用他们了。</p><p>在插件中编写模块定义跟常规的编写流程一致，这是一个很大的话题，在这里我们就不详细展开了。你可以通过阅读模块定义对应的文档了解其中的细节：</p><ul><li><a href="https://kubevela.io/docs/platform-engineers/components/custom-component" target="_blank" rel="noreferrer">自定义组件 Component Definition</a></li><li><a href="https://kubevela.io/docs/platform-engineers/traits/customize-trait" target="_blank" rel="noreferrer">自定义运维特征 Trait Definition</a></li><li><a href="https://kubevela.io/docs/platform-engineers/policy/custom-policy" target="_blank" rel="noreferrer">自定义策略 Policy Definition</a></li><li><a href="https://kubevela.io/docs/platform-engineers/workflow/workflow" target="_blank" rel="noreferrer">自定义工作流步骤 Workflow Step Definition</a>。</li></ul><p>在本例中，我们编写 Redis 组件类型主要参照 <a href="https://kubevela.net/zh/docs/platform-engineers/components/custom-component" target="_blank" rel="noreferrer">自定义组件</a> 与 <a href="https://github.com/spotahome/redis-operator/blob/master/README.md" target="_blank" rel="noreferrer">Redis Operator 使用文档</a> ，我们将组件类型命名为 <code>redis-failover</code>，它会创建一个 RedisFailover 的 CR ，这样刚刚添加的 Redis Operator 就可以帮助创建 Redis 集群，见<a href="https://github.com/kubevela/catalog/blob/master/experimental/addons/redis-operator/definitions/redis-failover.cue" target="_blank" rel="noreferrer">完整代码</a>。</p><h3 id="metadata-yaml" tabindex="-1"><code>metadata.yaml</code> <a class="header-anchor" href="#metadata-yaml" aria-label="Permalink to &quot;`metadata.yaml`&quot;">​</a></h3><p>这里包含了插件的元数据，即插件的名称、版本、系统要求等，可以参考<a href="https://kubevela.net/zh/docs/platform-engineers/addon/intro#%E6%8F%92%E4%BB%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%96%87%E4%BB%B6" target="_blank" rel="noreferrer">文档</a>。需要注意的是，本次介绍的为 KubeVela v1.5 之后的新写法，因此需要避免使用某些不兼容的元数据字段，以下样例中包含了所有的可用元数据。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>例如传统的 <code>deployTo.runtimeCluster</code> （安装至子集群）等元数据在新写法中已有代替（使用 topology Policy），应当使用新写法。可见完整代码中的 <a href="https://github.com/kubevela/catalog/blob/958a770a9adb3268e56ca4ec2ce99d2763617b15/experimental/addons/redis-operator/template.cue#L28" target="_blank" rel="noreferrer"><code>template.cue</code></a></p></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 插件名称，与目录名一致</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">redis-operator</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 插件描述</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Redis Operator creates/configures/manages high availability redis with sentinel automatic failover atop Kubernetes.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 展示用标签</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">redis</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 插件版本</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0.1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 展示用图标</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">icon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://xxx.com</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 插件所包含项目的官网地址</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://github.com/spotahome/redis-operator</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可能依赖的其他插件，例如 fluxcd</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: []</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 系统版本要求</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">system</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  vela</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&gt;=v1.5.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  kubernetes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&gt;=1.19&quot;</span></span></code></pre></div><h2 id="运行插件" tabindex="-1">运行插件 <a class="header-anchor" href="#运行插件" aria-label="Permalink to &quot;运行插件&quot;">​</a></h2><p>至此我们已经将插件的主要部分编写完成，下载 <a href="https://github.com/kubevela/catalog/tree/master/experimental/addons/redis-operator" target="_blank" rel="noreferrer">完整代码</a> 补全部分细节后，即可尝试运行。</p><p>下载得到 redis-operator 目录后，我们可以通过 <code>vela addon enable redis-operator</code> 安装本地的 <code>redis-operator</code> 插件，这种本地安装插件的方式也可以方便你再制作时做一些调试。</p><p>安装完成后就可以参考插件的 <a href="https://github.com/kubevela/catalog/tree/master/experimental/addons/redis-operator/README.md" target="_blank" rel="noreferrer">README</a> 试用我们的 Redis 插件了！</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>这里也体现出插件的 README 的重要性，其中需要包括插件的作用、详细使用指南等，确保用户可以快速上手。</p></div><p>在用户使用你编写的插件时，只需如下 <strong>4</strong> 行 yaml 即可在 Application 中创建包含 3 个 Node 的高可用 Redis 集群！相比于手动安装 Redis Operator 并创建 CR ，甚至逐一手动配置 Redis 集群，插件的方式极大地方便了用户。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">core.oam.dev/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Application</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">redis-operator-sample</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  components</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # This component is provided by redis-operator addon.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # In this example, 2 redis instance and 2 sentinel instance</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # will be created.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">redis-failover</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ha-redis</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # You can increase/decrease this later to add/remove instances.</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span></code></pre></div><p>只需 apply 仅仅数行的 yaml 文件，我们就轻松创建了如下图所示的整个复杂的资源。并且由于我们编写了 <em>资源关联规则 (Resource Topology)</em> ，用户可以通过 VelaUX 轻松获得刚刚创建的 Redis 集群的资源拓扑状态，了解 Application 底层资源的运行状况，不再受限于 Application Component 级别的可观测性。如图我们能直接观测到整个 Application 的拓扑，直至每个 Redis Pod ，可见图中部分 Pod 仍在准备中：</p><p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/redis-operator-sample-topology-graph.png" alt="redis-operator-sample-topology-graph" loading="lazy"></p><p>在执行 <code>vela exec/log/port-forward</code> 等命令时也可以精确地看到 Application 底层包含的资源（即支撑 Redis 集群的 3 个 Redis Pod 和 3 个 Sentinel Pod）。</p><p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/redis-operator-sample-pod-topology.png" alt="redis-operator-sample-pod-topology" loading="lazy"></p><p>::: 如果你在使用单集群，乍一看你可能不会觉得 exec 进一个 Pod 是很特殊的功能。但是一旦考虑到多集群，能够在横跨多个集群的资源中跟单集群一样以统一的方式进行选择查看能够极大的节省时间。 :::</p><p>使用 <code>vela status</code> 命令能获取这个 Application 的运行状态，有了资源关联规则后可以更进一步，直接通过 vela 寻找出 Redis Sentinel 的 Endpoint 来访问 Redis 集群：</p><p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/redis-operator-sample-endpoint.png" alt="redis-operator-sample-endpoint" loading="lazy"></p><h2 id="结语" tabindex="-1">结语 <a class="header-anchor" href="#结语" aria-label="Permalink to &quot;结语&quot;">​</a></h2><p>通过本文，相信你已经了解插件的作用及制作插件的要点。通过插件体系，我们将获得如下优势：</p><ol><li>将平台的能力打包成一个易于安装、便于分发复用、且可以形成社区生态的插件市场。</li><li>充分复用 CUE 和 KubeVela 应用通过的强大能力，将基础设施资源灵活定义并进行多集群分发。</li><li>无论扩展的资源类型是什么，均可以接入应用体系，为最终用户提供一致的体验。</li></ol><p>最后，如果你成功制作了属于自己的插件，KubeVela 社区非常欢迎开发者贡献插件至 <a href="https://github.com/kubevela/catalog" target="_blank" rel="noreferrer">插件中心</a> ，这样你的插件还能够被其他 KubeVela 社区用户发现并使用！</p></div></div></main><footer class="VPDocFooter" data-v-ba7be00d data-v-cafbcad1><!--[--><!--]--><div class="edit-info" data-v-cafbcad1><!----><div class="last-updated" data-v-cafbcad1><p class="VPLastUpdated" data-v-cafbcad1 data-v-d1fb68b6>上次更新于: <time datetime="2024-03-10T06:18:55.000Z" data-v-d1fb68b6></time></p></div></div><nav class="prev-next" data-v-cafbcad1><div class="pager" data-v-cafbcad1><a class="VPLink link pager-link prev" href="/tech-blog/posts/kubevela/application-controller-source-code-analysis-2.html" data-v-cafbcad1><!--[--><span class="desc" data-v-cafbcad1>Previous page</span><span class="title" data-v-cafbcad1>Kubevela系列三：Application Controller 源码分析(下)</span><!--]--></a></div><div class="pager" data-v-cafbcad1><!----></div></nav></footer><!--[--><!--[--><!--[--><!--[--><!--]--><!----><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"posts_programming_go_goroutine.md\":\"BnifUwbu\",\"index.md\":\"CzwxGmWk\",\"posts_programming_go_array-and-slices.md\":\"BxOX12QY\",\"posts_kubevela_addon-build-instruction.md\":\"DkTNRWkI\",\"posts_cilium_bgp-exercise-bird-cilium.md\":\"DDUqKEve\",\"posts_kubevirt_quick-deploy-centos7.md\":\"CyhbLU-3\",\"posts_linux_centos7-upgrade-to-stream9.md\":\"BeUMAZgr\",\"aboutme.md\":\"3joocluK\",\"posts_troubleshooting_k8s-pod-abnormal-analysis.md\":\"DkdlUe9t\",\"posts_cilium_exercise-cluster-mesh.md\":\"BirtMCJv\",\"posts_kubevela_get-to-know-kubevela.md\":\"DTXtInd3\",\"posts_kubevela_application-controller-source-code-analysis-1.md\":\"BCej8v8I\",\"posts_kubevirt_hotplug-interface.md\":\"Cu0v1lBL\",\"posts_kubevela_application-controller-source-code-analysis-2.md\":\"DOGPvlNC\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-cn\",\"dir\":\"ltr\",\"title\":\"皮特ᴾᵗ的博客技术站\",\"description\":\"热衷于云原生技术，一直为实现自我价值而执着！\",\"base\":\"/tech-blog/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"blog\":{\"pagesData\":[{\"route\":\"/aboutme\",\"meta\":{\"sidebar\":false,\"title\":\"关于自己\",\"date\":\"2021-11-12 16:00:00\",\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/hyperter96.github.io/img/lighthouse.jpg\",\"tags\":[\"其它\"],\"tag\":[\"其它\"],\"description\":\"---\\n96年出生，标准的理工男一枚,毕业于(加拿大滑铁卢大学),热爱开源与知识分享~\\n除了技术，本人也是对心理学有浓厚的兴趣，热衷于研究mbti，希望可以多一点了解自己还有身边的人，理解为人相处之道\"}},{\"route\":\"/posts/cilium/bgp-exercise-bird-cilium\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/cilium-bgp-demo.svg\",\"date\":\"2024-02-04 16:00:00\",\"tag\":[\"Cilium\",\"网络\",\"cni\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Cilium系列二：Cilium在集群网格Cluster Mesh中的实践\",\"link\":\"/posts/cilium/exercise-cluster-mesh\"},\"title\":\"Cilium系列一：使用bird和cilium部署BGP模式的k8s集群\",\"description\":\"这是使用 Cilium BGP 控制平面 (BGP CP) 向外部 BGP 路由器通告路由以及在两个集群之间路由的演示。 每个集群执行以下操作：\\n1. 运行 2 个作为部署进行管理的 nginx po\"}},{\"route\":\"/posts/cilium/exercise-cluster-mesh\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/cluster-mesh.png\",\"date\":\"2024-02-06 16:00:00\",\"tag\":[\"Cilium\",\"网络\",\"cni\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Cilium系列一：使用bird和cilium部署BGP模式的k8s集群\",\"link\":\"/posts/cilium/bgp-exercise-bird-cilium\"},\"title\":\"Cilium系列二：Cilium在集群网格Cluster Mesh中的实践\",\"description\":\"Cilium Cluster Mesh 允许您连接多个集群的网络，只要所有集群都运行 Cilium 作为其 CNI，每个集群中的 pod 都可以发现和访问网格中所有其他集群中的服务。这允许有效地将多个\"}},{\"route\":\"/posts/kubevela/addon-build-instruction\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background4.jpeg\",\"date\":\"2023-10-17 16:00:00\",\"author\":\"姜洪烨\",\"tag\":[\"Kubevela\",\"应用交付\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevela系列三：Application Controller 源码分析(下)\",\"link\":\"/posts/kubevela/application-controller-source-code-analysis-2\"},\"title\":\"Kubevela系列四：插件指南-轻松扩展你的平台专属能力\",\"description\":\"KubeVela 插件（addon）可以方便地扩展 KubeVela 的能力。正如我们所知，KubeVela 是一个微内核高度可扩展的平台，用户可以通过 模块定义（Definition）扩展 Kube\"}},{\"route\":\"/posts/kubevela/application-controller-source-code-analysis-1\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/k8s-1.jpeg\",\"date\":\"2023-09-21 16:00:00\",\"author\":\"意琦行\",\"tag\":[\"Kubevela\",\"应用交付\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevela系列一：初识 KubeVela，基于 OAM 模型的应用交付平台\",\"link\":\"/posts/kubevela/get-to-know-kubevela\"},\"next\":{\"text\":\"Kubevela系列三：Application Controller 源码分析(下)\",\"link\":\"/posts/kubevela/application-controller-source-code-analysis-2\"},\"title\":\"Kubevela系列二：Application Controller 源码分析(上)\",\"description\":\"本文主要分析 KubeVela 中的 App Controller 部分源码，分享 app 对象 apply 到集群之后 KubeVela 的运作流程，从而更好的理解 KubeVela。\\n本文旨在通过\"}},{\"route\":\"/posts/kubevela/application-controller-source-code-analysis-2\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/k8s-2.jpeg\",\"date\":\"2023-09-22 16:00:00\",\"author\":\"意琦行\",\"tag\":[\"Kubevela\",\"应用交付\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevela系列二：Application Controller 源码分析(上)\",\"link\":\"/posts/kubevela/application-controller-source-code-analysis-1\"},\"next\":{\"text\":\"Kubevela系列四：插件指南-轻松扩展你的平台专属能力\",\"link\":\"/posts/kubevela/addon-build-instruction\"},\"title\":\"Kubevela系列三：Application Controller 源码分析(下)\",\"description\":\"本文主要分析 KubeVela 中的 App Controller 部分源码，分享 app 对象 apply 到集群之后 KubeVela 的运作流程，从而更好的理解 KubeVela。\\n本文旨在通过\"}},{\"route\":\"/posts/kubevela/get-to-know-kubevela\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/kubevela-cover1-application.png\",\"date\":\"2023-09-08 16:00:00\",\"author\":\"意琦行\",\"tag\":[\"Kubevela\",\"应用交付\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Kubevela系列二：Application Controller 源码分析(上)\",\"link\":\"/posts/kubevela/application-controller-source-code-analysis-1\"},\"title\":\"Kubevela系列一：初识 KubeVela，基于 OAM 模型的应用交付平台\",\"description\":\"本文主要介绍了 KubeVela 是什么，解决了什么问题，以及如何解决的。\\n Kubevela介绍\\n Kubevela是什么\\n:::info 以下是 KubeVela 官网的描述：\\nKubeVela \"}},{\"route\":\"/posts/kubevirt/hotplug-interface\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background2.jpg\",\"date\":\"2023-10-02 16:00:00\",\"tag\":[\"Kubevirt\",\"虚拟机\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevirt系列一：虚拟机CentOS 7部署实践\",\"link\":\"/posts/kubevirt/quick-deploy-centos7\"},\"title\":\"Kubevirt系列二：虚拟机网卡热插拔\",\"description\":\" 设计动机\\n向正在运行的虚拟机热插拔/热拔出（添加/删除）NIC 是可用于多个平台的行业标准，允许动态连接 L2 网络。 当工作负载 (VM) 在连接/删除网络时无法容忍重新启动时，或者例如在网络之前\"}},{\"route\":\"/posts/kubevirt/quick-deploy-centos7\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/aliyun-image-source.png\",\"date\":\"2023-09-30 16:00:00\",\"tag\":[\"Kubevirt\",\"虚拟机\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Kubevirt系列二：虚拟机网卡热插拔\",\"link\":\"/posts/kubevirt/hotplug-interface\"},\"title\":\"Kubevirt系列一：虚拟机CentOS 7部署实践\",\"description\":\"俗话说，实践是检验真理的唯一标准，不妨让我们尝试用kubeVirt部署一台属于自己的虚拟机吧~\\n 准备环境\\n首先，我们需要安装`libvirt`和`qemu`，\\n```shell\\nyum instal\"}},{\"route\":\"/posts/linux/centos7-upgrade-to-stream9\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/algorithm-1.jpeg\",\"date\":\"2024-01-31 16:00:00\",\"tag\":[\"虚拟机\",\"linux\"],\"title\":\"CentOS 7 升级至 CentOS Stream 9 操作教程\",\"description\":\"本操作教程仓库地址：https://github.com/hyperter96/OhMyStream9，所有Shell脚本在`scripts`目录下。\\n CentOS 7 升级至 CentOS 8\\n:\"}},{\"route\":\"/posts/troubleshooting/k8s-pod-abnormal-analysis\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/hyperter96.github.io/img/k8s-2.jpg\",\"categories\":[\"kubernetes\"],\"date\":\"2023-05-06 03:45:56\",\"tags\":[\"kubernetes\",\"故障分析\"],\"title\":\"K8S故障分析系列一：基于真实场景解读K8S_Pod的各种异常\",\"tag\":[\"kubernetes\",\"故障分析\"],\"description\":\" Pod 生命周期\\n在整个生命周期中，Pod 会出现 5 种阶段（Phase）。\\n- Pending：Pod 被 K8s 创建出来后，起始于 Pending 阶段。在 Pending 阶段，Pod 将\"}},{\"route\":\"/posts/programming/go/array-and-slices\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover1-slices.jpeg\",\"date\":\"2022-07-01 16:00:00\",\"tag\":[\"Go\",\"编程基础\"],\"sticky\":1,\"next\":{\"text\":\"Go 基础知识系列二: 协程\",\"link\":\"/posts/programming/go/goroutine\"},\"title\":\"Go 基础知识系列一: 数组与切片\",\"description\":\"这篇文章总结了 Go 的知识体系数组与切片，包括其中的底层实现等等。\\n:::warning 注意\\n说起 Golang， 大家都会第一时间想到高并发和 Golang 作为主流的后端开发语言的优势，本文主\"}},{\"route\":\"/posts/programming/go/goroutine\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover2-goroutine.jpeg\",\"date\":\"2022-07-02 16:00:00\",\"tag\":[\"Go\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Go 基础知识系列一: 数组与切片\",\"link\":\"/posts/programming/go/array-and-slices\"},\"title\":\"Go 基础知识系列二: 协程\",\"description\":\"这篇文章总结了 Go 的知识体系：协程，包括其中的底层实现等等。\\n 协程(coroutine)\\n在讲 goroutine 之前让我们先了解一下协程 (coroutine)，和线程类似，共享堆，不共享栈\"}}],\"footer\":{\"copyright\":\"MIT License | 皮特ᴾᵗ\"},\"themeColor\":\"el-yellow\",\"author\":\"皮特ᴾᵗ\",\"friend\":[{\"nickname\":\"皮特ᴾᵗ\",\"des\":\"你的指尖用于改变世界的力量\",\"avatar\":\"https://cdn.jsdelivr.net/gh/hyperter96/hyperter96.github.io/img/selfie.jpeg\",\"url\":\"https://hyperter96.github.io/tech-blog/\"},{\"nickname\":\"洋洋得意\",\"des\":\"每一帧都是热爱\",\"avatar\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/yyliao.jpg\",\"url\":\"https://www.douyin.com/user/MS4wLjABAAAA3944Q_PGRxLuxLSdOlxOoDzJFnDXlpgyr-CO2aJ7tV8?vid=7336569870861045055\"},{\"nickname\":\"意琦行\",\"des\":\"指月小筑(探索云原生)\",\"avatar\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/yiqixing.jpg\",\"url\":\"https://www.lixueduan.com/\"}],\"comment\":{\"repo\":\"hyperter96/tech-blog\",\"repoId\":\"R_kgDOLckbDg\",\"category\":\"General\",\"categoryId\":\"DIC_kwDOLckbDs4CdyEa\",\"label\":\"评论\",\"icon\":\"<svg enable-background=\\\"new 0 0 512 512\\\" height=\\\"512px\\\" id=\\\"Layer_1\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 512 512\\\" width=\\\"512px\\\" xml:space=\\\"preserve\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\"><path d=\\\"M170.476,166.19h155.097c4.285,0,7.76-3.469,7.76-7.754s-3.475-7.765-7.76-7.765H170.476c-4.285,0-7.754,3.48-7.754,7.765  S166.191,166.19,170.476,166.19z\\\"/><path d=\\\"M348.088,203.362H202.74c-4.284,0-7.759,3.469-7.759,7.754s3.475,7.765,7.759,7.765h145.348c4.284,0,7.754-3.48,7.754-7.765  S352.372,203.362,348.088,203.362z\\\"/><path d=\\\"M306.695,256.052H170.476c-4.285,0-7.754,3.469-7.754,7.754c0,4.284,3.469,7.754,7.754,7.754h136.219  c4.279,0,7.754-3.47,7.754-7.754C314.448,259.521,310.974,256.052,306.695,256.052z\\\"/><path d=\\\"M396.776,86.288H115.225c-29.992,0-54.403,22.562-54.403,50.308v154.83c0,27.735,24.411,50.297,54.403,50.297h166.034  l119.812,83.989v-84.135c27.996-2.038,50.108-23.753,50.108-50.151v-154.83C451.179,108.85,426.768,86.288,396.776,86.288z   M427.906,291.426c0,14.902-13.972,27.025-31.131,27.025h-18.978v62.523l-89.193-62.523h-173.38  c-17.164,0-31.131-12.123-31.131-27.025v-154.83c0-14.913,13.967-27.035,31.131-27.035h281.551  c17.159,0,31.131,12.123,31.131,27.035V291.426z\\\"/></svg>\",\"mobileMinify\":false,\"inputPosition\":\"bottom\",\"lang\":\"zh-CN\",\"mapping\":\"pathname\"},\"hotArticle\":{\"title\":\"🔥 精选文章\",\"nextText\":\"换一组\",\"pageSize\":3,\"empty\":\"暂无精选内容\"}},\"sidebar\":[{\"text\":\"\",\"items\":[]}],\"outline\":{\"level\":[2,3],\"label\":\"目录\"},\"returnToTopLabel\":\"回到顶部\",\"sidebarMenuLabel\":\"相关文章\",\"lastUpdatedText\":\"上次更新于\",\"logo\":\"/selfie.jpeg\",\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"关于我\",\"link\":\"/aboutme.html\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/hyperter96/tech-blog\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>