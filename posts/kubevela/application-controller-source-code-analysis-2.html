<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubevelaç³»åˆ—ä¸‰ï¼šApplication Controller æºç åˆ†æ(ä¸‹) | çš®ç‰¹á´¾áµ—çš„åšå®¢å……ç”µæ ˆ</title>
    <meta name="description" content="çƒ­è¡·äºé‡å­è®¡ç®—ã€AIä»¥åŠäº‘åŸç”ŸæŠ€æœ¯ï¼Œä¸€ç›´ä¸ºå®ç°è‡ªæˆ‘ä»·å€¼è€Œæ‰§ç€ï¼">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.2W2a8fBD.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.BQPrYGQ9.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.B28k8k1F.js">
    <link rel="modulepreload" href="/assets/chunks/theme.BP4SYbL7.js">
    <link rel="modulepreload" href="/assets/chunks/katex-Y6PQNQVE.BlOHncb1.js">
    <link rel="modulepreload" href="/assets/chunks/dagre-J34DD3ED.veUk_MTK.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-DIAGRT4E.UTeBicsd.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-VGGTOZ6L.BsG-pUf5.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-EH5MJO4F.CQMxX_87.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-SKNSGYS7.DgmzcEgS.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-5VSVYTVS.eEMefde9.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-4Y6AHTKP.Bk9Gy1dW.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-DEBX63JL.oyN5rUt9.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-WBTZPRPP.Cae-QCKo.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-PSUSI454.B1UaydZY.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-6S5PV5XW.Cs0QRJtj.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-4Z2JIRXO.l3IyzurX.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-DNBKKQ4H.DVViflrP.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-JKF7Y4IR.DVViflrP.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-KPJC5377.DSFNGpJG.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-2U4TK54H.C6LVz4zp.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-JXBOM4D5.t7tpZFrE.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-DILY5V7H.Bq9f6JUT.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-LOGZOIWP.DQS0G6nj.js">
    <link rel="modulepreload" href="/assets/chunks/kanban-definition-J3VSJMBN.tjXBWkot.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-HUG4X7QO.DCSI20KB.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-627GWW2N.BYM9C77i.js">
    <link rel="modulepreload" href="/assets/chunks/blockDiagram-AVZU24AE.DYlPmkrW.js">
    <link rel="modulepreload" href="/assets/chunks/architectureDiagram-JEHL5QAV.JoG4jejG.js">
    <link rel="modulepreload" href="/assets/posts_kubevela_application-controller-source-code-analysis-2.md.Bo_TIZCE.lean.js">
    <link rel="icon" href="/favicon.ico">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <script type="text/javascript">(function(){document.documentElement.setAttribute("theme","vp-green")})();</script>
    <script>import("/pagefind/pagefind.js").then(i=>{window.__pagefind__=i,i.init()}).catch(()=>{});</script>
  </head>
  <body>
    <div id="app"><div class="Layout blog-theme-layout" data-v-d9f31b9a data-v-3d9e4baf><!--[--><!--[--><!--]--><!----><!--]--><!--[--><div style="display:none;" class="theme-blog-popover" data-pagefind-ignore="all" data-v-9f912836><!----><div class="header" data-v-9f912836><div class="title-wrapper" data-v-9f912836><i class="announcement-icon" style="font-size:20px;" data-v-9f912836 data-v-d58ce524><!--[--><svg t="1716085184855" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4274" width="200" height="200" data-v-9f912836><path d="M660.48 872.448q6.144 0-3.584 15.36t-29.696 33.792-47.104 33.792-57.856 15.36q-27.648 0-53.248-15.36t-45.056-33.792-29.696-33.792-6.144-15.36l272.384 0zM914.432 785.408q7.168 9.216 6.656 17.92t-4.608 14.848-10.24 9.728-12.288 3.584l-747.52 0q-14.336 0-20.992-11.776t4.608-29.184q17.408-30.72 40.96-68.608t44.544-81.408 36.352-92.16 15.36-101.888q0-51.2 14.336-92.16t37.376-71.68 53.248-52.224 62.976-32.768q-16.384-26.624-16.384-55.296 0-41.984 28.672-70.656t70.656-28.672 70.656 28.672 28.672 70.656q0 14.336-4.096 28.16t-11.264 25.088q34.816 11.264 66.048 32.768t54.272 53.248 36.864 72.704 13.824 91.136q0 51.2 15.36 100.864t36.864 94.208 45.568 81.408 43.52 63.488zM478.208 142.336q0 16.384 11.264 28.16t27.648 11.776l2.048 0q16.384-1.024 27.648-12.288t11.264-27.648q0-17.408-11.264-28.672t-28.672-11.264-28.672 11.264-11.264 28.672z" p-id="4275" data-v-9f912836></path></svg><!--]--></i><span class="title" data-v-9f912836>å…¬å‘Š</span></div><i class="announcement-icon close-icon" style="font-size:20px;" data-v-9f912836 data-v-d58ce524><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-9f912836><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336z" data-v-9f912836></path></svg><!--]--></i></div><div class="body content" data-v-9f912836><!--[--><p style="" data-v-9f912836>ğŸ‘‡å¾®ä¿¡æ‰«ç æ·»åŠ å¥½å‹ğŸ‘‡</p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/qrcode3.png" style="" data-v-9f912836><button class="announcement-button announcement-button-primary" style="" data-v-9f912836 data-v-81af507f><span data-v-81af507f><!--[-->äº‘åŸç”Ÿæ–‡æ¡£<!--]--></span></button><button class="announcement-button announcement-button-success" style="" data-v-9f912836 data-v-81af507f><span data-v-81af507f><!--[-->ç”Ÿæ´»åšå®¢<!--]--></span></button><!--]--><!----></div><div class="footer content" data-v-9f912836><!--[--><!--]--></div></div><div style="" class="theme-blog-popover-close" data-v-9f912836><i class="announcement-icon" style="" data-v-9f912836 data-v-d58ce524><!--[--><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4274" width="200" height="200" data-v-9f912836><path d="M660.48 872.448q6.144 0-3.584 15.36t-29.696 33.792-47.104 33.792-57.856 15.36q-27.648 0-53.248-15.36t-45.056-33.792-29.696-33.792-6.144-15.36l272.384 0zM914.432 785.408q7.168 9.216 6.656 17.92t-4.608 14.848-10.24 9.728-12.288 3.584l-747.52 0q-14.336 0-20.992-11.776t4.608-29.184q17.408-30.72 40.96-68.608t44.544-81.408 36.352-92.16 15.36-101.888q0-51.2 14.336-92.16t37.376-71.68 53.248-52.224 62.976-32.768q-16.384-26.624-16.384-55.296 0-41.984 28.672-70.656t70.656-28.672 70.656 28.672 28.672 70.656q0 14.336-4.096 28.16t-11.264 25.088q34.816 11.264 66.048 32.768t54.272 53.248 36.864 72.704 13.824 91.136q0 51.2 15.36 100.864t36.864 94.208 45.568 81.408 43.52 63.488zM478.208 142.336q0 16.384 11.264 28.16t27.648 11.776l2.048 0q16.384-1.024 27.648-12.288t11.264-27.648q0-17.408-11.264-28.672t-28.672-11.264-28.672 11.264-11.264 28.672z" p-id="4275" data-v-9f912836></path></svg><!--]--></i></div><!--]--><!--[--><span tabindex="-1" data-v-ca33ecbe></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-ca33ecbe>Skip to content</a><!--]--><!----><header class="VPNav" data-v-3d9e4baf data-v-a6e667fb><div class="VPNavBar top" data-v-a6e667fb data-v-709f7523><div class="wrapper" data-v-709f7523><div class="container" data-v-709f7523><div class="title" data-v-709f7523><div class="VPNavBarTitle" data-v-709f7523 data-v-58b8f68d><a class="title" href="/" data-v-58b8f68d><!--[--><!--]--><!--[--><img class="VPImage logo" src="/favicon.ico" alt data-v-9f3ac265><!--]--><span data-v-58b8f68d>çš®ç‰¹á´¾áµ—çš„åšå®¢å……ç”µæ ˆ</span><!--[--><!--]--></a></div></div><div class="content" data-v-709f7523><div class="content-body" data-v-709f7523><!--[--><!--]--><div class="blog-search search" data-pagefind-ignore="all" data-v-709f7523 data-v-e9bcb78e><div class="nav-search-btn-wait" data-v-e9bcb78e><span data-v-e9bcb78e><svg width="14" height="14" viewBox="0 0 20 20" data-v-e9bcb78e><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" data-v-e9bcb78e></path></svg></span><span class="search-tip" data-v-e9bcb78e>Search</span><span class="metaKey" data-v-e9bcb78e> K </span></div><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-709f7523 data-v-e88b5f0b><span id="main-nav-aria-label" class="visually-hidden" data-v-e88b5f0b> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-e88b5f0b data-v-83bfb994><!--[--><span data-v-83bfb994>é¦–é¡µ</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e88b5f0b data-v-b52ba62d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b52ba62d><span class="text" data-v-b52ba62d><!----><span data-v-b52ba62d>é¢è¯•</span><span class="vpi-chevron-down text-icon" data-v-b52ba62d></span></span></button><div class="menu" data-v-b52ba62d><div class="VPMenu" data-v-b52ba62d data-v-703dfd39><div class="items" data-v-703dfd39><!--[--><!--[--><div class="VPMenuLink" data-v-703dfd39 data-v-12ac0c1c><a class="VPLink link" href="/posts/interview/tcp.html" data-v-12ac0c1c><!--[--><span data-v-12ac0c1c>TCPç¯‡</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e88b5f0b data-v-b52ba62d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b52ba62d><span class="text" data-v-b52ba62d><!----><span data-v-b52ba62d>è¶£å‘³</span><span class="vpi-chevron-down text-icon" data-v-b52ba62d></span></span></button><div class="menu" data-v-b52ba62d><div class="VPMenu" data-v-b52ba62d data-v-703dfd39><div class="items" data-v-703dfd39><!--[--><!--[--><div class="VPMenuLink" data-v-703dfd39 data-v-12ac0c1c><a class="VPLink link" href="/fun/catch-the-cat.html" data-v-12ac0c1c><!--[--><span data-v-12ac0c1c>é€®ä½é‚£åªçŒ«ï¼</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/aboutme.html" tabindex="0" data-v-e88b5f0b data-v-83bfb994><!--[--><span data-v-83bfb994>å…³äºæˆ‘</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-709f7523 data-v-f99db97a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-f99db97a data-v-39a65046 data-v-2b8d5f92><span class="check" data-v-2b8d5f92><span class="icon" data-v-2b8d5f92><!--[--><span class="vpi-sun sun" data-v-39a65046></span><span class="vpi-moon moon" data-v-39a65046></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-709f7523 data-v-110edee0 data-v-2000751e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hyperter96/tech-blog" aria-label="github" target="_blank" rel="noopener" data-v-2000751e data-v-918621c1><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-709f7523 data-v-3cff016c data-v-b52ba62d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b52ba62d><span class="vpi-more-horizontal icon" data-v-b52ba62d></span></button><div class="menu" data-v-b52ba62d><div class="VPMenu" data-v-b52ba62d data-v-703dfd39><!----><!--[--><!--[--><!----><div class="group" data-v-3cff016c><div class="item appearance" data-v-3cff016c><p class="label" data-v-3cff016c>Appearance</p><div class="appearance-action" data-v-3cff016c><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-3cff016c data-v-39a65046 data-v-2b8d5f92><span class="check" data-v-2b8d5f92><span class="icon" data-v-2b8d5f92><!--[--><span class="vpi-sun sun" data-v-39a65046></span><span class="vpi-moon moon" data-v-39a65046></span><!--]--></span></span></button></div></div></div><div class="group" data-v-3cff016c><div class="item social-links" data-v-3cff016c><div class="VPSocialLinks social-links-list" data-v-3cff016c data-v-2000751e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hyperter96/tech-blog" aria-label="github" target="_blank" rel="noopener" data-v-2000751e data-v-918621c1><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--[--><!--[--><!--[--><div class="VPFlyout VPNolebaseEnhancedReadabilitiesMenu VPNolebaseEnhancedReadabilitiesMenuFlyout" aria-label="é˜…è¯»å¢å¼ºæ’ä»¶" role="menuitem" data-v-202de4de><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-202de4de><span class="text" data-v-202de4de><span class="i-icon-park-outline:book-open option-icon" data-v-202de4de></span><!----><span class="vpi-chevron-down text-icon" data-v-202de4de></span></span></button><div class="menu" data-v-202de4de><div class="VPMenu" data-v-b9f48d30 data-v-202de4de><!----><!--[--><!--]--></div></div></div><!--]--><!--]--><!--]--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-709f7523 data-v-f8c4d78a><span class="container" data-v-f8c4d78a><span class="top" data-v-f8c4d78a></span><span class="middle" data-v-f8c4d78a></span><span class="bottom" data-v-f8c4d78a></span></span></button></div></div></div></div><div class="divider" data-v-709f7523><div class="divider-line" data-v-709f7523></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-3d9e4baf data-v-0a035857><div class="container" data-v-0a035857><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-0a035857 data-v-015e6a78><button data-v-015e6a78>å›åˆ°é¡¶éƒ¨</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-3d9e4baf data-v-60002510><div class="VPDoc has-aside" data-v-60002510 data-v-73d3112f><!--[--><!--]--><div class="container" data-v-73d3112f><div class="aside" data-v-73d3112f><div class="aside-curtain" data-v-73d3112f></div><div class="aside-container" data-v-73d3112f><div class="aside-content" data-v-73d3112f><div class="VPDocAside" data-v-73d3112f data-v-7195f826><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-7195f826 data-v-66e81e07><div class="content" data-v-66e81e07><div class="outline-marker" data-v-66e81e07></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-66e81e07>ç›®å½•</div><ul class="VPDocOutlineItem root" data-v-66e81e07 data-v-3d7ba898><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-7195f826></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-73d3112f><div class="content-container" data-v-73d3112f><!--[--><!--[--><!--[--><!--[--><!--]--><!----><!--]--><!--]--><!--]--><main class="main" data-v-73d3112f><div style="position:relative;" class="vp-doc _posts_kubevela_application-controller-source-code-analysis-2" data-v-73d3112f><div data-pagefind-body="true"><h1 id="kubevelaç³»åˆ—ä¸‰-application-controller-æºç åˆ†æ-ä¸‹" tabindex="-1">Kubevelaç³»åˆ—ä¸‰ï¼šApplication Controller æºç åˆ†æ(ä¸‹) <a class="header-anchor" href="#kubevelaç³»åˆ—ä¸‰-application-controller-æºç åˆ†æ-ä¸‹" aria-label="Permalink to &quot;Kubevelaç³»åˆ—ä¸‰ï¼šApplication Controller æºç åˆ†æ(ä¸‹)&quot;">â€‹</a></h1><p>æœ¬æ–‡ä¸»è¦åˆ†æ KubeVela ä¸­çš„ App Controller éƒ¨åˆ†æºç ï¼Œåˆ†äº« app å¯¹è±¡ apply åˆ°é›†ç¾¤ä¹‹å KubeVela çš„è¿ä½œæµç¨‹ï¼Œä»è€Œæ›´å¥½çš„ç†è§£ KubeVelaã€‚</p><p>æœ¬æ–‡æ—¨åœ¨é€šè¿‡åˆ†ææºç ï¼Œè§£å†³ä¸€ä¸ªå¤§é—®é¢˜å’Œå‡ ä¸ªå°é—®é¢˜ã€‚</p><div class="important custom-block github-alert"><p class="custom-block-title">æé—®</p><p>KubeVela ä¸­çš„ <code>Application</code> å¯¹è±¡æ˜¯æ€ä¹ˆå·¥ä½œçš„?</p><p>å‡ ä¸ªå°é—®é¢˜ï¼š</p><ul><li>App ä¸­çš„ <code>components</code> æ˜¯æ€ä¹ˆè½¬æ¢ä¸º <code>k8s object</code> çš„</li><li>App ä¸­çš„ <code>policy</code> åˆ†åˆ«æ˜¯æ€ä¹ˆå·¥ä½œçš„</li><li>App ä¸­çš„ <code>workflow</code> æ˜¯æ€ä¹ˆè¿è¡Œçš„</li></ul></div><h2 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€" aria-label="Permalink to &quot;å‰è¨€&quot;">â€‹</a></h2><p>çœ‹è¿™éƒ¨å†…å®¹ä¹‹å‰ï¼Œéœ€è¦å¯¹ KubeVela æœ‰ä¸€ä¸ªå¤§è‡´çš„è®¤è¯†ï¼Œæ¯”å¦‚</p><ul><li>çŸ¥é“ <code>Application</code> å¯¹è±¡ ç”± <code>Componentã€Traitã€Policyã€Workflow</code> ç­‰ç»„æˆ</li><li>çŸ¥é“ KubeVela ä¸­çš„ <code>Component</code> æ³¨å†Œæœºåˆ¶</li></ul><p>å†æ¬¡å»ºè®®çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="./get-to-know-kubevela.html">Kubevelaç³»åˆ—ä¸€ï¼šåˆè¯† KubeVelaï¼ŒåŸºäº OAM æ¨¡å‹çš„åº”ç”¨äº¤ä»˜å¹³å°</a></p><p>å…·ä½“ä»£ç åœ¨<code>pkg/controller/core.oam.dev/v1beta1/application/application_controller.go</code> æ–‡ä»¶é‡Œã€‚</p><p>æ•´ä½“åˆ†ä¸º 3 ä¸ªå¤§é€»è¾‘ï¼š</p><ul><li>1ï¼‰è§£æå¾—åˆ° <code>appFile</code></li><li>2ï¼‰æ„å»º <code>applicationStep</code></li><li>3ï¼‰å°†èµ„æºéƒ¨ç½²åˆ° k8s é›†ç¾¤</li></ul><p>ä¸‹ç¯‡é‡Œä¸»è¦åˆ†æç¬¬äºŒå’Œç¬¬ä¸‰éƒ¨åˆ†ï¼šå¦‚ä½•è§£æ <code>Application</code> å¯¹è±¡ï¼Œå¾—åˆ° <code>appFile</code> å¯¹è±¡ã€‚</p><h2 id="ç”Ÿæˆåº”ç”¨æ­¥éª¤-generateapplicationsteps" tabindex="-1">ç”Ÿæˆåº”ç”¨æ­¥éª¤ï¼šGenerateApplicationSteps <a class="header-anchor" href="#ç”Ÿæˆåº”ç”¨æ­¥éª¤-generateapplicationsteps" aria-label="Permalink to &quot;ç”Ÿæˆåº”ç”¨æ­¥éª¤ï¼šGenerateApplicationSteps&quot;">â€‹</a></h2><p>è¿™é‡Œå°±è¿›å…¥äº†ç¬¬äºŒä¸ªå¤§çš„é€»è¾‘ï¼Œæ ¹æ® <code>appFile</code> ç”Ÿæˆ <code>ApplicationStep</code>ï¼Œè¿™é‡Œçš„ <code>Step</code> å’Œå‰é¢æåˆ°çš„ <code>WorkflowStep</code> æœ‰æ‰€åŒºåˆ«ï¼Œè¿™é‡Œçš„ <code>ApplicationStep</code> æ˜¯çœŸæ­£ç”¨äºæ‰§è¡Œçš„ã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>ç›¸å½“äº <code>WorkflowStep</code> å®šä¹‰äº†éœ€è¦æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œ<code>ApplicationStep</code> åˆ™æ˜¯çœŸæ­£çš„æ‰§è¡Œå¯¹è±¡ã€‚</p></div><h3 id="è·å–-workflowinstance-runners" tabindex="-1">è·å– <code>workflowInstance</code> &amp; <code>Runners</code> <a class="header-anchor" href="#è·å–-workflowinstance-runners" aria-label="Permalink to &quot;è·å– `workflowInstance` &amp; `Runners`&quot;">â€‹</a></h3><p>æ‹¿åˆ° <code>appFile</code> ä¹‹åä¸‹ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„é€»è¾‘å°±æ˜¯<code>GenerateApplicationSteps</code>:</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">workflowInstance, runners, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> handler.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GenerateApplicationSteps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(logCtx, app, appParser, appFile)</span></span></code></pre></div><p>è¿™ä¸ªæ–¹æ³•è¿˜æ˜¯æŒºå¤æ‚çš„ï¼Œæœ€ç»ˆå¾—åˆ°äº†ä¸€ä¸ª <code>instance</code>å’Œä¸€ä¸ª <code>runner</code>ï¼Œå…¶ä¸­ <code>runner</code> æ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œ</p><p>è¿™é‡Œé¢å®é™…å°±æ˜¯æ³¨å†Œäº†ä¸€äº› <code>func</code>ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><div class="language-tip vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tip</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>æ ¸å¿ƒä¸ºé‡Œé¢çš„ `xxx.Install` æ–¹æ³•ï¼Œåç»­ç”¨åˆ°æ—¶å†å…·ä½“åˆ†æï¼Œè¿™é‡Œå…ˆç•¥è¿‡</span></span></code></pre></div><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AppHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GenerateApplicationSteps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> monitorContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1beta1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Application</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    appParser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Parser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    af</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Appfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wfTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WorkflowInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wfTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TaskRunner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    handlerProviders </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> providers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewProviders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kube.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(handlerProviders, h.Client, appLabels, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Handlers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       Apply:  h.Dispatch,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       Delete: h.Delete,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    configprovider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(handlerProviders, h.Client, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">applyOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplyOption</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resources {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SetLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(util.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MergeMapOverrideWithDst</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), appLabels))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.resourceKeeper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, resources, applyOptions)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    oamProvider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(handlerProviders, app, af, h.Client, h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">applyComponentFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       appParser, appRev, af), h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">renderComponentFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appParser, appRev, af))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pCtx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> velaprocess.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateContextDataFromApp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(app, appRev.Name))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    renderer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">comp</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> common</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplicationComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> appParser.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ParseComponentFromRevisionAndClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, comp, appRev)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    multiclusterProvider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(handlerProviders, h.Client, app, af,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">applyComponentFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appParser, appRev, af),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkComponentHealth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appParser, appRev, af),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       renderer)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    terraformProvider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(handlerProviders, app, renderer)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(handlerProviders, h.Client, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // çœç•¥...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°æœ‰å„ç§ <code>Install</code>ï¼Œè¿™é‡Œæ³¨å†Œä¸Šä¹‹åï¼Œåé¢çš„é€»è¾‘é‡Œå°±ä¼šç”¨åˆ°è¿™äº›ä¸œè¥¿ï¼Œå› æ­¤æš‚æ—¶ä¸å±•å¼€åˆ†æäº†ï¼Œç­‰ç”¨åˆ°äº†å†ç»†è¯´ã€‚</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬è·å–åˆ°äº†ä¸€ä¸ª <code>workflowInstance</code> å’Œ <code>runners</code> å¯¹è±¡ã€‚</p><h3 id="executerunners" tabindex="-1">ExecuteRunners <a class="header-anchor" href="#executerunners" aria-label="Permalink to &quot;ExecuteRunners&quot;">â€‹</a></h3><p>æ ¸å¿ƒå°±ä¸‹é¢ä¸¤å¥ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">workflowExecutor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> executor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(workflowInstance, r.Client, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">workflowState, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> workflowExecutor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ExecuteRunners</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authCtx, runners)</span></span></code></pre></div><p>ä½¿ç”¨å‰é¢çš„ <code>workflowInstance</code> æ„å»ºäº† <code>workflowExecutor</code>ï¼Œç„¶åé€šè¿‡ <code>workflowExecutor</code> è¿è¡Œäº†å‰é¢æ‹¿åˆ°çš„ <code>runners</code> å¯¹è±¡ã€‚è¿™é‡Œçš„ <code>ExecuteRunners</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ€ç»ˆå®ç°åœ¨<a href="http://github.com/kubevela/workflow/pkg/executor/workflow.go#L102" target="_blank" rel="noreferrer">è¿™é‡Œ</a>ï¼Œç²¾ç®€åçš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">workflowExecutor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ExecuteRunners</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> monitorContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">taskRunners</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">types</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TaskRunner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WorkflowRunPhase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // new ä¸€ä¸ªç”¨äºæ‰§è¡Œ Workflow çš„ engine</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> newEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, wfCtx, w, status, taskRunners)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ ¸å¿ƒæ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, taskRunners, dagMode)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;run steps&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       StepStatusCache.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Store</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cacheKey, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(status.Steps))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v1alpha1.WorkflowStateExecuting, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkWorkflowPhase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>ç»§ç»­è¿½è¸ªè¿™ä¸ª <code>Run</code> æ–¹æ³•ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">engine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> monitorContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">taskRunners</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">types</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TaskRunner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dag {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runAsDAG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, taskRunners, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, taskRunners, dag)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkFailedAfterRetries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setNextExecuteTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>è¿™é‡Œä¼šæ ¹æ®æ˜¯å¦æ˜¯ DAG èµ°ä¸åŒçš„ <code>case</code>ï¼Œé»˜è®¤æ˜¯ <code>false</code>ï¼Œæ‰€ä»¥èµ° <code>e.steps</code>:</p><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>è¿™ä¸ª DAG çš„å€¼åº”è¯¥æ˜¯æ¥æºäº <code>Application</code> ä¸­çš„ <code>workflow.mode</code> å­—æ®µï¼Œé»˜è®¤ä¸º <code>StepByStep</code>ï¼Œå› æ­¤ è¿™ä¸ª dag å°±æ˜¯ <code>false</code></p></div><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">engine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> monitorContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">taskRunners</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">types</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TaskRunner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index, runner </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> taskRunners {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateRunOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findDependPhase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(taskRunners, index, dag))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // æ ¸å¿ƒæ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       status, operation, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> runner.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wfCtx, options)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">finishStep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(operation)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // çœç•¥...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å°±æ˜¯ <code>for</code> å¾ªç¯é‡Œé¢æ‰§è¡Œ <code>runner.Run</code> æ–¹æ³•ï¼Œç„¶åç”±äºè¿™é‡Œçš„ <code>runners</code> æ˜¯ä¸Šä¸€æ­¥<code>GenerateApplicationSteps</code> ä¸­è¿”å›çš„ï¼Œå› æ­¤ç°åœ¨åœ¨å›è¿‡å¤´å»çœ‹ä¸€ä¸‹è¿™äº› <code>runners</code> æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œç›´æ¥æŠŠç›¸å…³ä»£ç è´´è¿‡æ¥ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">runners, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> generator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GenerateRunners</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, instance, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wfTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StepGeneratorOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Providers:       handlerProviders,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PackageDiscover: h.pd,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ProcessCtx:      pCtx,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TemplateLoader:  template.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewWorkflowStepTemplateRevisionLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appRev, h.Client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RESTMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Client:          h.Client,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    StepConvertor: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">step</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> workflowv1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WorkflowStep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">workflowv1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WorkflowStep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       wfTypes.WorkflowStepTypeApplyComponent: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lstep</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> workflowv1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WorkflowStep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">workflowv1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WorkflowStep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          copierStep </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lstep.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DeepCopy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> convertStepProperties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(copierStep, app); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lstep, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;convert [apply-component]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          copierStep.Type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wfTypes.WorkflowStepTypeBuiltinApplyComponent</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">copierStep, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>ç„¶å <code>GenerateRunners</code> æ–¹æ³•å†…éƒ¨æ¯”è¾ƒå¤æ‚ï¼Œè¿ç»­è·³äº†å¥½å‡ ä¸ªæ¥å£æ‰èµ°åˆ°æœ€ç»ˆçš„å®ç°,å…·ä½“ä»£ç åœ¨ è¿™é‡Œ,æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TaskLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">makeTaskGenerator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">templ</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">types</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TaskGenerator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">wfStep</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> v1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WorkflowStep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">genOpt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">types</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TaskGeneratorOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">types</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TaskRunner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // çœç•¥å…¶ä»–é€»è¾‘...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       tRunner </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">taskRunner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       tRunner.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wfStep.Name</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // æ ¸å¿ƒéƒ¨åˆ†ï¼Œè®¾ç½® run æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       tRunner.run </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> wfContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">types</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TaskRunOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">stepStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> v1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StepStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">operations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">types</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Operation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rErr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           // çœç•¥å…¶ä»–é€»è¾‘...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doSteps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tracer, ctx, taskv); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             tracer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;do steps&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err, types.StatusReasonExecute)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">operation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">operation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tRunner, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>é‡Œé¢çš„æ ¸å¿ƒæ–¹æ³•å°±æ˜¯åˆ›å»ºäº† <code>runner</code>ï¼Œç„¶åä¸º <code>run</code> æ–¹æ³•èµ‹å€¼äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å‰é¢çœ‹åˆ°çš„ <code>taskrunner.run</code> æ–¹æ³•å®é™…å°±æ˜¯åœ¨æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚</p><p>ç„¶åè¿™ä¸ª <code>run</code> æ–¹æ³•é‡Œé¢æ¯”è¾ƒé‡è¦çš„å°±æ˜¯è¿™å¥ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doSteps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tracer, ctx, taskv); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;do steps&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err, types.StatusReasonExecute)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">operation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>è¿™é‡Œé¢å°±æ˜¯åœ¨çœŸçš„æ‰§è¡Œ <code>Workflow</code> äº†</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">executor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doSteps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> monitorContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">wfCtx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> wfContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">v</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // çœç•¥å…¶ä»–é€»è¾‘...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StepByFields</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fieldName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // çœç•¥å…¶ä»–é€»è¾‘...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       do </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OpTpy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(in)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> do </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> do </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;steps&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doSteps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, wfCtx, in); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          provider </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> opProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(in)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, wfCtx, provider, do, in); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithMessagef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;run step(provider=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,do=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, provider, do)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.suspend </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.terminated </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.wait {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>ç„¶åè¿™é‡Œæ ¹æ® <code>operation type</code> ä¹Ÿåˆ†äº† 3 ä¸ª <code>case</code>ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">do </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OpTpy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(in)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> do </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> do </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;steps&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doSteps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, wfCtx, in); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    provider </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> opProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(in)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, wfCtx, provider, do, in); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithMessagef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;run step(provider=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,do=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, provider, do)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>ä¸€èˆ¬æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šçš„ <code>Workflow</code> éƒ½æ˜¯ <code>deploy</code>ï¼Œå› æ­¤ä¼šè¿›å…¥åˆ°æœ€åçš„ <code>else</code> è¿™ä¸ª <code>case</code>ï¼Œé‚£ä¹ˆç»§ç»­è¿½è¸ª <code>ecec.Handle</code> æ–¹æ³•ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">executor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> monitorContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">wfCtx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> wfContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">provider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">do</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">v</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ ¹æ® provider å’Œ do çš„ç±»å‹æ‰¾åˆ°å¯¹åº”çš„handler</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    h, exist </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exec.handlers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(provider, do)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">exist {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Errorf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;handler not found&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æœ€åå°±æ˜¯æ‰§è¡Œè¿™ä¸ª handler</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> h</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, wfCtx, v, exec)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>è¿™é‡Œé¢çš„ <code>handler</code> å®é™…ä¸Šå°±æ˜¯å‰é¢ <code>GenerateApplicationSteps</code> çš„æ—¶å€™ä¸æ˜¯å¾ˆå¤š <code>Install</code> æ–¹æ³•å—ï¼Œå°±æ˜¯åœ¨æ³¨å†Œ <code>hanlder</code>,å°±åƒè¿™æ ·ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// pkg/controller/core.oam.dev/v1beta1/application/generator.go#L114</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    multiclusterProvider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(handlerProviders, h.Client, app, af,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">applyComponentFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appParser, appRev, af),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkComponentHealth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appParser, appRev, af),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       renderer)</span></span></code></pre></div><p>ç»§ç»­è¿½è¸ª <code>Install</code> ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> wfTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Providers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">c</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1beta1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Application</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">af</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Appfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">apply</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> oamProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComponentApply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">healthCheck</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> oamProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComponentHealthCheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">renderer</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> oamProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WorkloadRenderer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{Client: c, app: app, af: af, apply: apply, healthCheck: healthCheck, renderer: renderer}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ProviderName, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wfTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       &quot;make-placement-decisions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:              prd.MakePlacementDecisions,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       &quot;patch-application&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:                     prd.PatchApplication,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       &quot;list-clusters&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:                         prd.ListClusters,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       &quot;get-placements-from-topology-policies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: prd.GetPlacementsFromTopologyPolicies,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       &quot;deploy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:                                prd.Deploy,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°å°±æ˜¯è°ƒç”¨äº† <code>Register</code> æ–¹æ³•ï¼ŒæŠŠè¿™äº› <code>hander</code> ç»™æ³¨å†Œè¿›æ¥äº†ã€‚</p><div class="warning custom-block"><p class="custom-block-title">æ³¨æ„</p><p>è¿™ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„å†™æ³•ï¼Œæ–¹æ³•çš„æ³¨å†Œå’Œè°ƒç”¨åˆ†å‘ï¼Œé€šè¿‡æ³¨å†Œçš„æ–¹å¼æ¥è§£è€¦ã€‚</p></div><p>é‚£ä¹ˆæˆ‘ä»¬è¿™é‡Œæ˜¯ <code>deploy</code> å¯¹åº”çš„å°±æ˜¯ <code>prd.Deploy</code> è¿™ä¸ªæ–¹æ³•ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// pkg/workflow/providers/multicluster/multicluster.go#L153</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Deploy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> monitorContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> wfContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">v</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">act</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> wfTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    param </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DeployParameter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CueValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Decode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">param); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> param.Parallelism </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Errorf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;parallelism cannot be smaller than 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    executor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NewDeployWorkflowStepExecutor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p.Client, p.af, p.apply, p.healthCheck, p.renderer, param)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    healthy, reason, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> executor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Deploy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">healthy {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       act.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wait</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(reason)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>ç›´æ¥è¿›å…¥ <code>executor.Deploy</code> æ–¹æ³•ã€‚</p><p>è¿™é‡Œå…ˆå°ç»“ä¸€ä¸‹ï¼Œè¿™éƒ¨åˆ†ä¸»è¦æ ¹æ® <code>WorkflowStep</code> ç”Ÿæˆ <code>ApplicationStep</code>ï¼Œç„¶åæ„å»º <code>workflow</code> engine æ¥æ‰§è¡Œå…·ä½“æ­¥éª¤ã€‚</p><p>ç„¶åå…·ä½“æ‰§è¡Œçš„æ–¹æ³•æ˜¯åœ¨<code>GenerateApplicationSteps</code> æ–¹æ³•é‡Œæ³¨å†Œä¸Šå»çš„ï¼Œæ ¹æ®åå­—é€‰æ‹©æ‰§è¡Œä¸åŒçš„æ–¹æ³•ã€‚</p><p>ä¸‹é¢å°±é€‰æ‹©æœ€æ ¸å¿ƒçš„ <code>Deploy</code> æ–¹æ³•æ¥åˆ†æï¼Œå…¶ä»–çš„æ­¥éª¤æ ¹æ®å„ç§å®ç°å°±æœ‰æ‰€ä¸åŒäº†ï¼Œå¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥å»<code>GenerateApplicationSteps</code>æ–¹æ³•é‡Œç¿»ä¸€ä¸‹ã€‚</p><h2 id="éƒ¨ç½²é€»è¾‘-deploy" tabindex="-1">éƒ¨ç½²é€»è¾‘ï¼š<code>Deploy</code> <a class="header-anchor" href="#éƒ¨ç½²é€»è¾‘-deploy" aria-label="Permalink to &quot;éƒ¨ç½²é€»è¾‘ï¼š`Deploy`&quot;">â€‹</a></h2><p>è¿™éƒ¨åˆ†å¼€å§‹å°±æ˜¯å…·ä½“çš„éƒ¨ç½²é€»è¾‘ï¼Œå‰é¢åœ¨è§£æ <code>appFile</code> çš„æ—¶å€™æˆ‘ä»¬çš„ <code>component</code> å·²ç»è§£æå®Œæˆäº†ï¼Œä» <code>XDefine</code> é‡Œæ‹¿åˆ° CUE æ¨¡æ¿ï¼Œä» app å¯¹è±¡çš„ <code>component</code> é‡Œæ‹¿åˆ°å¯¹åº”å‚æ•°ï¼Œç„¶åå°†äºŒè€…åˆå¹¶ç”Ÿæˆæœ€ç»ˆçš„ <code>k8s object</code> å¯¹è±¡ã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>å¦‚æœå¯¹è¿™éƒ¨åˆ†é€»è¾‘ä¸æ¸…æ¥šï¼Œå¯ä»¥å›è¿‡å¤´å»çœ‹ä¸€ä¸‹ä¸Šç¯‡ç¬¬ä¸€éƒ¨åˆ† è§£æ <code>appFile</code></p></div><p>è¿™é‡Œå°±ä¼šå°†å‰é¢å¾—åˆ°çš„ <code>k8s object</code> å¯¹è±¡éƒ¨ç½²åˆ°é›†ç¾¤é‡Œå»ã€‚è¿™é‡Œéœ€è¦ä¸¤éƒ¨åˆ†å‚æ•°ï¼š</p><ul><li>1ï¼‰éƒ¨ç½²åˆ°å“ªä¸ªé›†ç¾¤é‚£ä¸ªå‘½åç©ºé—´</li><li>2ï¼‰éƒ¨ç½²ä»€ä¹ˆå†…å®¹</li></ul><p>ä¸‹é¢çš„ä»£ç ä¼šå‘Šè¯‰æˆ‘ä»¬ç­”æ¡ˆï¼Œ<code>Deploy</code> å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">executor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deployWorkflowStepExecutor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Deploy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    policies, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> selectPolicies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(executor.af.Policies, executor.parameter.Policies)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    policies </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(policies, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillInlinePolicyNames</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(executor.parameter.InlinePolicies)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // é¦–å…ˆæ˜¯ loadComponentsï¼Œè¿™é‡Œçš„ render æ–¹æ³•æ˜¯é€šè¿‡å¤–éƒ¨ä¼ è¿›å»çš„ï¼Œå®é™…ä¸Šå°±æ˜¯å‰é¢åˆ†æè¿‡çš„æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    components, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> loadComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, executor.renderer, executor.cli, executor.af, executor.af.Components, executor.parameter.IgnoreTerraformComponent)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è¿™é‡Œå°±æ˜¯åœ¨å¤„ç† topology ç±»å‹çš„ policyï¼Œè§£æå‡º component éœ€è¦è¢«åˆ†å‘åˆ°å“ªäº›é›†ç¾¤å»</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    placements, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pkgpolicy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetPlacementsFromTopologyPolicies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, executor.cli, executor.af.Namespace, policies, resourcekeeper.AllowCrossNamespaceResource)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è¿™é‡Œå°±æ˜¯åœ¨å¤„ç† override policyï¼Œå¯¹ä¸åŒé›†ç¾¤å†…å®¹åˆ†åˆ«å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    components, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> overrideConfiguration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(policies, components)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è¿™é‡Œåœ¨å¤„ç† replication ç±»å‹çš„ policyï¼Œä»–æ˜¯æŠŠä¸€ä¸ªåº”ç”¨å¤šä¸ªå‰¯æœ¬æ•°åˆ†åˆ°ä¸åŒé›†ç¾¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    components, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pkgpolicy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ReplicateComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(policies, components)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ ¸å¿ƒï¼Œapply åˆ° k8s é›†ç¾¤</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> applyComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, executor.apply, executor.healthCheck, components, placements, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(executor.parameter.Parallelism))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p><ul><li>1ï¼‰åŠ è½½ <code>component</code></li><li>2ï¼‰åˆ†åˆ«å¤„ç†ä¸åŒç±»å‹çš„ <code>policy</code><ul><li><code>Topology</code></li><li><code>Override</code></li><li><code>Replication</code></li></ul></li><li>3ï¼‰<code>applyComponents</code></li></ul><div class="warning custom-block"><p class="custom-block-title">æ³¨æ„ğŸ“¢ï¼š</p><p>è¿™é‡Œæ˜¯ <code>deployWorkflowStepExecutor</code> ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰§è¡Œçš„æ­¥éª¤å¯¹åº”çš„æ˜¯ <code>Application</code> å¯¹è±¡é‡Œé¢ <code>spec.workflow.steps</code> ä¸­çš„æŸä¸€ä¸ªæ­¥éª¤ ï¼Œå› æ­¤å¦‚æœæœ‰å¤šä¸ª <code>step</code> åˆ™ä¼šåˆ†åˆ«èµ°å¤šæ¬¡æµç¨‹ï¼Œè€Œä¸”æ˜¯äº’ä¸å¹²æ‰°çš„</p></div><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>æ‰€ä»¥æ¯ä¸ª step å…³è”äº†å“ªäº›ç­–ç•¥æ˜¯å½±å“æœ€å¤§çš„</p></div><p>æ¯”å¦‚ <code>step1</code> å…³è”äº† <code>topology1</code> å’Œ <code>override1</code> è¿™ä¸¤ä¸ªç­–ç•¥ï¼š</p><ul><li>1ï¼‰ <code>topology</code> ç­–ç•¥æŒ‡å®šè¦éƒ¨ç½²åˆ° <code>cluster1</code> çš„ <code>default</code> å‘½åç©ºé—´</li><li>2ï¼‰<code>override</code> ç­–ç•¥å¯¹é»˜è®¤å‚æ•°åšäº†ä¸€äº›è‡ªå®šä¹‰</li></ul><p>ç­‰è¯¥ <code>step</code> æ‰§è¡Œä¹‹åï¼Œæ•ˆæœå°±æ˜¯éƒ¨ç½²åˆ° <code>cluster1</code> çš„ <code>default</code> å‘½åç©ºé—´çš„åº”ç”¨æ˜¯æœ‰è‡ªå®šä¹‰æ•ˆæœçš„</p><p><code>step2</code> åªå…³è”äº† <code>topology2</code>ï¼šè¦éƒ¨ç½²åˆ° <code>cluster2</code> çš„ <code>default</code> å‘½åç©ºé—´ï¼Œç”±äºæ²¡æœ‰ <code>override</code> ç­–ç•¥ï¼Œå› æ­¤éƒ¨ç½²åˆ° <code>cluster2</code>çš„<code>default</code> å‘½åç©ºé—´çš„åº”ç”¨å°±æ˜¯é»˜è®¤å€¼ã€‚</p><h3 id="topology-ç­–ç•¥-getplacementsfromtopologypolicies" tabindex="-1"><code>topology</code> ç­–ç•¥ï¼š<code>GetPlacementsFromTopologyPolicies</code> <a class="header-anchor" href="#topology-ç­–ç•¥-getplacementsfromtopologypolicies" aria-label="Permalink to &quot;`topology` ç­–ç•¥ï¼š`GetPlacementsFromTopologyPolicies`&quot;">â€‹</a></h3><p>è¿™éƒ¨åˆ†ä¸»è¦æ˜¯æ ¹æ® <code>topology</code> ç±»å‹çš„ <code>policy</code> æ‹¿åˆ°å…·ä½“è¦éƒ¨ç½²çš„é›†ç¾¤çš„å‘½åç©ºé—´ã€‚</p><details class="details custom-block"><summary><code>GetPlacementsFromTopologyPolicies</code>å‡½æ•°</summary><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GetPlacementsFromTopologyPolicies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cli</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">appNs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">policies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1beta1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AppPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">allowCrossNamespace</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ([]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PlacementDecision</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    placements </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PlacementDecision</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    placementMap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}{}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    addCluster </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cluster</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ns</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">validateCluster</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> validateCluster {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> multicluster.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewClusterClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cli).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, cluster); e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wrapf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;failed to get cluster </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cluster)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allowCrossNamespace </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ns </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> appNs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ns </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Errorf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cannot cross namespace&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       placement </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> v1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PlacementDecision</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{Cluster: cluster, Namespace: ns}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> placement.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, found </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> placementMap[name]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">found {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          placementMap[name] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}{}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          placements </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(placements, placement)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    hasTopologyPolicy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, policy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> policies {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // åªå¤„ç† topology ç±»å‹çš„é¢ policy</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> policy.Type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v1alpha1.TopologyPolicyType {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> policy.Properties </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Errorf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;topology policy </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> must not have empty properties&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, policy.Name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          hasTopologyPolicy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          clusterLabelSelector </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GetClusterLabelSelectorInTopology</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(topologySpec)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // æ ¸å¿ƒé€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> topologySpec.Clusters </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             // å¦‚æœpolicy é‡Œé¢æŒ‡å®šäº†è¦åˆ†å‘åˆ°å“ªäº›é›†ç¾¤å°±ç›´æ¥ä½¿ç”¨ï¼Œè°ƒç”¨ addCluster æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             // å°†å…¶åŠ å…¥åˆ° placements æ•°ç»„é‡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, cluster </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> topologySpec.Clusters {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addCluster</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cluster, topologySpec.Namespace, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                   return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clusterLabelSelector </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             // å¦‚æœæ˜¯é€šè¿‡ labelSelector æ–¹å¼æ¥é€‰æ‹©é›†ç¾¤ï¼Œé‚£å°±å…ˆæŠŠé›†ç¾¤æŸ¥è¯¢å‡ºæ¥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             // ç„¶åè°ƒç”¨ addCluster æ–¹æ³•æ·»åŠ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             clusterList, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> multicluster.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewClusterClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cli).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MatchingLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(clusterLabelSelector))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, cluster </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clusterList.Items {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addCluster</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cluster.Name, topologySpec.Namespace, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                   return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addCluster</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pkgmulticluster.Local, topologySpec.Namespace, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å…œåº•ç­–ç•¥ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š topology ç±»å‹çš„ policy é‚£å°±éƒ¨ç½²åˆ° hub é›†ç¾¤</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hasTopologyPolicy {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       placements </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PlacementDecision</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{Cluster: multicluster.ClusterLocalName}}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> placements, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></details><p>è¡¥ä¸Šä¸€ä¸ª <code>placement</code> çš„å®šä¹‰ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PlacementDecision</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Cluster   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `json:&quot;cluster&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Namespace </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `json:&quot;namespace&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œ<code>topology</code> ç±»å‹çš„ <code>policy</code> é‡Œé¢æœ‰ä¸¤ç§æ–¹å¼æŒ‡å®šé›†ç¾¤ï¼Œä¸€ä¸ªæ˜¯ç›´æ¥æŒ‡å®šé›†ç¾¤åï¼Œå¦ä¸€ä¸ªæ˜¯æŒ‡å®š <code>label</code>ï¼Œç„¶åè¿™é‡Œå°±æ ¹æ® <code>label</code> æŸ¥è¯¢åˆ°å¯¹åº”çš„é›†ç¾¤ã€‚</p><p>è‡³äºå‘½åç©ºé—´æš‚æ—¶åªæä¾›äº†ç›´æ¥æŒ‡å®šåå­—çš„æ–¹å¼ï¼Œå› ä¸ºåªèƒ½æŒ‡å®šä¸€ä¸ªå‘½åç©ºé—´ï¼Œå› æ­¤å¯¹äºå¤šä¸ªé›†ç¾¤ä¹Ÿåªèƒ½éƒ¨ç½²åˆ°åŒä¸€ä¸ªå‘½åç©ºé—´ã€‚</p><p>ç°åœ¨ <code>topology</code> ç±»å‹çš„ <code>policy</code> æ˜¯æ€ä¹ˆç”Ÿæ•ˆçš„åº”è¯¥å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼Œ</p><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>å°±æ˜¯æ ¹æ® <code>topology</code> ç­–ç•¥é‡Œçš„é…ç½®æ‹¿åˆ°éœ€è¦éƒ¨ç½²çš„é›†ç¾¤,å¦‚æœæ²¡æœ‰å°±é»˜è®¤éƒ¨ç½²åˆ° <code>local</code> é›†ç¾¤çš„ <code>default</code> å‘½åç©ºé—´ã€‚</p><p>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæœ‰æ—¶å€™æ²¡æœ‰æŒ‡å®š <code>Policy</code> åº”ç”¨ä¹Ÿèƒ½éƒ¨ç½²èµ·æ¥ã€‚</p></div><h3 id="è¦†ç›–ç­–ç•¥-overrideconfiguration" tabindex="-1">è¦†ç›–ç­–ç•¥ï¼š<code>overrideConfiguration</code> <a class="header-anchor" href="#è¦†ç›–ç­–ç•¥-overrideconfiguration" aria-label="Permalink to &quot;è¦†ç›–ç­–ç•¥ï¼š`overrideConfiguration`&quot;">â€‹</a></h3><p>å†çœ‹ä¸€ä¸‹è¦†ç›–ç­–ç•¥ï¼Œä»£ç æ¯”è¾ƒç®€å•ï¼Œæ‹¿åˆ° <code>override</code> ç±»å‹çš„ç­–ç•¥ï¼Œç„¶åè§£æ <code>properties</code> ä¸­çš„é…ç½®å¹¶è¦†ç›–åˆ° <code>component</code> ä¸Šã€‚</p><p>è¿™é‡Œæ˜¯ç”¨çš„ <code>for</code> å¾ªç¯ï¼Œå› æ­¤æŒ‡å®šäº†å¤šä¸ª <code>override</code> ç­–ç•¥åˆ™æ˜¯éƒ½ä¼šç”Ÿæ•ˆï¼Œå¦‚æœéƒ½ä¿®æ”¹åŒä¸€ä¸ªå€¼åˆ™æ˜¯åé¢çš„ç­–ç•¥ä¼šè¦†ç›–å‰é¢çš„ç­–ç•¥ã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>å¤šä¸ªç­–ç•¥ï¼ŒæŒ‰é¡ºåºä¾æ¬¡è¦†ç›–ï¼Œåè€…è¦†ç›–å‰è€…ã€‚</p></div><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> overrideConfiguration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">policies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1beta1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AppPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">components</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">common</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplicationComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ([]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">common</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplicationComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, policy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> policies {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> policy.Type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v1alpha1.OverridePolicyType {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> policy.Properties </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Errorf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;override policy </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> must not have empty properties&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, policy.Name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          overrideSpec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OverridePolicySpec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StrictUnmarshal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(policy.Properties.Raw, overrideSpec); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wrapf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;failed to parse override policy </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, policy.Name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          components, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> envbinding.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PatchComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(components, overrideSpec.Components, overrideSpec.Selector)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wrapf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;failed to apply override policy </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, policy.Name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> components, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å…³äºè¿™ä¸ª <code>override</code> ç­–ç•¥å…·ä½“æ˜¯æ€å’ŒæŸä¸ªç»„ä»¶å…³è”çš„ï¼Œæœ‰å¿…è¦æä¸€ä¸‹ï¼Œ å› ä¸ºæ¯”è¾ƒå®¹æ˜“ç†è§£é”™ã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>å…·ä½“çš„ç»„ä»¶å®šä¹‰ï¼š<a href="https://github.com/kubevela/kubevela/blob/26faaaf4f921d274ec745ee1f9ddfc2589987dc5/vela-templates/definitions/internal/policy/override.cue" target="_blank" rel="noreferrer"><code>override.cue</code></a></p></div><p>å†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-cue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;override&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        annotations: {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        description: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Describe the configuration to override when deploying resources, it only works with specified `deploy` step in workflow.&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        labels: {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        attributes: {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;policy&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">template: {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        #PatchParams: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // +usage=Specify the name of the patch component, if empty, all components will be merged</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                name?: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // +usage=Specify the type of the patch component.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                type?: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // +usage=Specify the properties to override.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                properties?: {...}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // +usage=Specify the traits to override.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                traits?: [...{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        // +usage=Specify the type of the trait to be patched.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        type: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        // +usage=Specify the properties to override.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        properties?: {...}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        // +usage=Specify if the trait should be remove, default false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        disable: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bool</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        parameter: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // +usage=Specify the overridden component configuration.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                components: [...#PatchParams]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // +usage=Specify a list of component names to use, if empty, all components will be selected.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                selector?: [...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>æœ‰ <code>components</code> å’Œ <code>selector</code> ä¸¤ä¸ªå‚æ•°ï¼Œå…·ä½“ä»£ç è§ï¼š<code>pkg/policy/envbinding/patch.go#L135</code></p><ul><li><code>components</code>ï¼šè¿™éƒ¨åˆ†ç”¨äºæŒ‡å®šä¿®æ”¹æŸä¸ªç»„ä»¶å†…çš„æŸäº›å‚æ•°ï¼Œé€šè¿‡ <code>name + type</code> æ¥å®šä½åˆ°å”¯ä¸€ç»„ä»¶ï¼Œå¯ä»¥ä¿®æ”¹å¤šä¸ªç»„ä»¶å‚æ•°ã€‚ <ul><li>ç”±äºç»„ä»¶çš„ <code>name</code> ä¸æ˜¯å¿…å¡«çš„ï¼Œå› æ­¤æ²¡æœ‰æŒ‡å®š <code>name</code> æ—¶ä¼šæŒ‰ç…§ <code>type</code> åŒ¹é… <code>component</code>ï¼Œå¦‚æœåŒç±»å‹æœ‰å¤šä¸ª <code>component</code> éƒ½ä¼šè¢«è¦†ç›–</li></ul></li><li><code>selector</code>ï¼šç›´æ¥ä¿®æ”¹è¦éƒ¨ç½²çš„ <code>component</code> åˆ—è¡¨ï¼Œä¸Šä¸€æ­¥ <code>components</code> é‡Œåªèƒ½åšå‚æ•°å·®å¼‚åŒ–ï¼Œå¦‚æœç›´æ¥ä¸æƒ³éƒ¨ç½²æŸäº›ç»„ä»¶å°±å¯ä»¥ä½¿ç”¨ <code>selector</code> å‚æ•°æ¥å®ç°ã€‚æœªåœ¨ <code>selector</code> åˆ—è¡¨ä¸­çš„ <code>component</code> ä¼šè¢«è¿‡æ»¤æ‰ï¼Œä¸ä¼šçœŸæ­£è¢«éƒ¨ç½²ã€‚ <ul><li>ä¸å¡«(å‚æ•°ä¸º <code>nil</code> )é»˜è®¤ä¼šéƒ¨ç½²æ‰€æœ‰ <code>component</code></li><li>å¦‚æœæ˜¯ç©ºæ•°ç»„åˆ™æ‰€æœ‰ <code>component</code> éƒ½ä¼šè¢«è¿‡æ»¤æ‰</li></ul></li></ul><p><code>Components</code> åŒ¹é…è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>æ²¡æœ‰ <code>name</code> å°±æŒ‰ç…§ <code>type</code> åŒ¹é…</li><li>æœ‰å°±åŒæ—¶æŒ‰ <code>name + type</code> åŒ¹é…</li></ul><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, comp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> patchComponents {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> comp.Name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // when no component name specified in the patch</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 1. if no type name specified in the patch, it will merge all components</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 2. if type name specified, it will merge components with the specified type</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> compName, baseComp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> compMaps {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> comp.Type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> comp.Type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> baseComp.Type {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             compMaps[compName], err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MergeComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(baseComp, comp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DeepCopy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                errs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(errs, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wrapf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;failed to merge component </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, compName))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // when component name (pattern) specified in the patch, it will find the component with the matched name</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 1. if the component type is not specified in the patch, the matched component will be merged with the patch</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 2. if the matched component uses the same type, the matched component will be merged with the patch</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 3. if the matched component uses a different type, the matched component will be overridden by the patch</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 4. if no component matches, and the component name is a valid kubernetes name, a new component will be added</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       addComponent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> regexp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MustCompile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[a-z]([a-z-]{0,61}[a-z])?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MatchString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(comp.Name)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> re, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> regexp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Compile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(strings.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ReplaceAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(comp.Name, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> compName, baseComp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> compMaps {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> re.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MatchString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(compName) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                addComponent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> baseComp.Type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> comp.Type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> comp.Type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                   compMaps[compName] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> comp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ToApplicationComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                   compMaps[compName], err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MergeComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(baseComp, comp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DeepCopy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                   if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      errs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(errs, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wrapf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;failed to merge component </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, comp.Name))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                   }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> addComponent {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          compMaps[comp.Name] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> comp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ToApplicationComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          compOrders </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(compOrders, comp.Name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>selector</code> é€»è¾‘ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸åœ¨é‡Œé¢çš„ç»„ä»¶å°±ç›´æ¥è¿‡æ»¤æ‰ã€‚</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// if selector is enabled, filter</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">compOrders </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FilterComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(compOrders, selector)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// fill in new application</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newComponents </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">common</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplicationComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, compName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> compOrders {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    newComponents </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(newComponents, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">compMaps[compName])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å°ç»“ä¸€ä¸‹ï¼Œ<code>override policy</code> æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ul><li>1ï¼‰ä¿®æ”¹æŸä¸ªç»„ä»¶çš„å‚æ•°ï¼Œå®ç°å·®å¼‚åŒ–éƒ¨ç½²ï¼Œæ¯”å¦‚å¯ä»¥è°ƒæ•´å‰¯æœ¬æ•°æˆ–è€…é•œåƒç­‰ä¿¡æ¯</li><li>2ï¼‰ç›´æ¥æŒ‡å®šä¸éƒ¨ç½²æŸä¸ªç­–ç•¥ï¼Œè¿›ä¸€æ­¥å®ç°å·®å¼‚åŒ–éƒ¨ç½²ï¼Œæ¯”å¦‚æŸäº›ç»„ä»¶å¯èƒ½ä¸ç”¨éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒï¼Œå°±å¯ä»¥åœ¨è¿™é‡Œè¿‡æ»¤æ‰ã€‚</li></ul><h3 id="éƒ¨ç½²åˆ°é›†ç¾¤-applycomponents" tabindex="-1">éƒ¨ç½²åˆ°é›†ç¾¤ï¼š<code>applyComponents</code> <a class="header-anchor" href="#éƒ¨ç½²åˆ°é›†ç¾¤-applycomponents" aria-label="Permalink to &quot;éƒ¨ç½²åˆ°é›†ç¾¤ï¼š`applyComponents`&quot;">â€‹</a></h3><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»æ‹¿åˆ°æœ‰è¦éƒ¨ç½²çš„é›†ç¾¤å’Œå‘½åç©ºé—´ï¼Œä»¥åŠè¦éƒ¨ç½²çš„å†…å®¹ï¼Œè¿™é‡Œå°±å¼€å§‹çœŸæ­£çš„ apply æ“ä½œäº†ã€‚</p><div class="warning custom-block"><p class="custom-block-title">æ³¨æ„ğŸ“¢ï¼š</p><p>è¿™é‡Œçš„ apply å¯ä»¥çœ‹åš <code>kubectl apply</code>ä¸­çš„ applyã€‚</p></div><p>å·²ç»æ¥è¿‘çœŸç›¸äº†ï¼Œå†åŠ æŠŠåŠ²ï¼Œè¿½è¸ªä¸€ä¸‹ <code>applyComponents</code>:</p><p>è¿™ä¸ªæ–¹æ³•ä¹Ÿå¾ˆå¤æ‚ï¼Œæˆ‘ä»¬åªçœ‹é‡ç‚¹ï¼Œå°±æ˜¯ apply æ–¹æ³•</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> applyComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">apply</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> oamProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComponentApply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">healthCheck</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> oamProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComponentHealthCheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">components</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">common</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplicationComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">placements</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1alpha1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PlacementDecision</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">parallelism</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // çœç•¥...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _, _, healthy, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, task.component, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, task.placement.Cluster, task.placement.Namespace)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">applyTaskResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{healthy: healthy, err: err, task: task}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // çœç•¥...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>ç„¶åè¿™ä¸ª apply æ–¹æ³•å®é™…æ˜¯å¤–éƒ¨ä¼ è¿›æ¥çš„ï¼Œæ˜¯è¿™æ ·è°ƒç”¨çš„ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">applyComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, executor.apply, executor.healthCheck, components, placements, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(executor.parameter.Parallelism))</span></span></code></pre></div><p>åˆç†æ¨æµ‹ï¼Œè¿™ä¸ªå¯èƒ½æ˜¯ä¹‹å‰ <code>Install</code> çš„æ—¶å€™èµ‹å€¼çš„ï¼Œç¿»å›å»çœ‹ä¸€ä¸‹ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Install register handlers to provider discover.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> wfTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Providers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">c</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1beta1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Application</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">af</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Appfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">apply</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> oamProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComponentApply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">healthCheck</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> oamProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComponentHealthCheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">renderer</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> oamProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WorkloadRenderer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{Client: c, app: app, af: af, apply: apply, healthCheck: healthCheck, renderer: renderer}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ProviderName, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wfTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       &quot;make-placement-decisions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:              prd.MakePlacementDecisions,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       &quot;patch-application&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:                     prd.PatchApplication,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       &quot;list-clusters&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:                         prd.ListClusters,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       &quot;get-placements-from-topology-policies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: prd.GetPlacementsFromTopologyPolicies,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       &quot;deploy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:                                prd.Deploy,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæ­£å¥½æœ‰ä¸€ä¸ª apply å‚æ•°ä¼ è¿›æ¥:</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">prd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">provider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{Client: c, app: app, af: af, apply: apply, healthCheck: healthCheck, renderer: renderer}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ProviderName, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wfTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span></code></pre></div><p>å›åˆ°å¤–é¢ï¼Œè¿™ä¸ª apply å¯¹åº”çš„å°±æ˜¯ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">multiclusterProvider.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(handlerProviders, h.Client, app, af,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">applyComponentFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appParser, appRev, af),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkComponentHealth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appParser, appRev, af),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    renderer)</span></span></code></pre></div><p><code>applyComponentFunc</code> å¦‚ä¸‹ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// pkg/controller/core.oam.dev/v1beta1/application/generator.go#L361</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AppHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">applyComponentFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">appParser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Parser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">appRev</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v1beta1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplicationRevision</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">af</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Appfile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oamProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComponentApply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">baseCtx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">comp</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> common</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplicationComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">patcher</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">clusterName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">overrideNamespace</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // çœç•¥å…¶ä»–é€»è¾‘...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utilfeature.DefaultMutableFeatureGate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(features.MultiStageComponentApply) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          manifestDispatchers, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateDispatcher</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appRev, readyWorkload, readyTraits, overrideNamespace)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generateDispatcher&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, dispatcher </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> manifestDispatchers {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isHealth, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dispatcher.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, wl, appRev, clusterName); </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isHealth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          dispatchResources </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> readyTraits</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wl.SkipApplyWorkload {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             dispatchResources </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{readyWorkload}, readyTraits</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, clusterName, common.WorkflowResourceCreator, dispatchResources</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Dispatch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          _, _, _, isHealth, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collectHealthStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, wl, appRev, overrideNamespace, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CollectHealthStatus&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisableResourceApplyDoubleCheck {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> readyWorkload, readyTraits, isHealth, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       workload, traits, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getComponentResources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(auth.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ContextWithUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, h.app), manifest, wl.SkipApplyWorkload, h.Client)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> workload, traits, isHealth, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>è¿™é‡Œæ ¹æ®æ˜¯å¦å¼€å¯äº† <code>features.MultiStageComponentApply</code> ç‰¹æ€§åˆ†ä¸ºä¸¤ä¸ªåˆ†æ”¯</p><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p><code>MultiStageComponentApply</code>: å¯ç”¨å¤šé˜¶æ®µç»„ä»¶èµ„æºéƒ¨ç½²èƒ½åŠ›ã€‚å½“å¯ç”¨æ—¶ï¼Œç»„ä»¶å†…çš„èµ„æºä¸‹å‘å¯åˆ†ä¸åŒæ‰¹æ¬¡ä¸‹å‘ã€‚</p></div><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utilfeature.DefaultMutableFeatureGate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(features.MultiStageComponentApply) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    manifestDispatchers, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateDispatcher</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appRev, readyWorkload, readyTraits, overrideNamespace)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generateDispatcher&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, dispatcher </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> manifestDispatchers {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isHealth, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dispatcher.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, wl, appRev, clusterName); </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isHealth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, clusterName, common.WorkflowResourceCreator, dispatchResources</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Dispatch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre></div><p>è¿™ä¸ªç‰¹æ€§é»˜è®¤ä¸º <code>false</code>ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥è¿›å…¥ä¸‹é¢çš„ <code>h.Dispatch</code> æ–¹æ³•ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Dispatch apply manifests into k8s.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AppHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cluster</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">owner</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">manifests</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ...*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    manifests </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> multicluster.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ResourcesWithClusterName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cluster, manifests</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ ¸å¿ƒé€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.resourceKeeper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, manifests, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, mf </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> manifests {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // è®°å½• apply è¿‡çš„èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addAppliedResource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ref)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>é‡Œé¢åˆè°ƒç”¨äº†ä¸€ä¸ª <code>Dispatch</code> æ–¹æ³•ï¼Œç»§ç»­è¿½è¸ªï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resourceKeeper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">manifests</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">applyOpts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplyOption</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ...</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DispatchOption</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utilfeature.DefaultMutableFeatureGate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(features.ApplyOnce) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       (h.applyOncePolicy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.applyOncePolicy.Enable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.applyOncePolicy.Rules </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(options, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MetaOnlyOption</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ClearNamespaceForClusterScopedResources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(manifests)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 0. check admission</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AdmissionCheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, manifests); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. pre-dispatch check</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    opts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplyOption</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{apply.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MustBeControlledByApp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(h.app), apply.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NotUpdateRenderHashEqual</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(applyOpts) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       opts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(opts, applyOpts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utilfeature.DefaultMutableFeatureGate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(features.PreDispatchDryRun) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          velaslices.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(manifests, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">manifest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> manifest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DeepCopy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() }),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplyOption</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{apply.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DryRunAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()}, opts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Errorf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pre-dispatch dryrun failed: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. record manifests in resourcetracker</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, manifests, options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. apply manifests</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, manifests, opts); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>é‡Œé¢åšäº†ä¸€äº›æ£€æŸ¥ï¼Œç„¶ååšäº†è®°å½•ï¼Œæœ€ç»ˆ apply çš„å®ç°åœ¨ <code>h.dispatch(ctx, manifests, opts)</code> é‡Œé¢ï¼š</p><p>ä¸€è·¯å¾€ä¸‹è·³ï¼Œæœ€ç»ˆè¿›å…¥ apply æ–¹æ³•ï¼š</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resourceKeeper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">manifests</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">applyOpts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplyOption</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    errs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> velaslices.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ParMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(manifests, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">manifest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Unstructured</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.applicator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(applyCtx, manifest, ao</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }, velaslices.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Parallelism</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MaxDispatchConcurrent))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> velaerrors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AggregateErrors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(errs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>æ ¸å¿ƒå°±åœ¨ <code>h.applicator.Apply(applyCtx, manifest, ao...)</code></p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">APIApplicator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Apply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">desired</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> client</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ao</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ...</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApplyOption</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // å¦‚æœå·²ç»å­˜åœ¨å°±è¿”å›ï¼Œæ²¡æœ‰å°±åˆ›å»º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    existing, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createOrGetExisting</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, applyAct, a.c, desired, ao</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> existing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç„¶ååˆ¤æ–­æ˜¯å¦éœ€è¦ recreate</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    shouldRecreate, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> needRecreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(strategy.RecreateFields, existing, desired)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Errorf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;failed to evaluate recreateFields: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shouldRecreate {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // éœ€è¦çš„è¯å°± delete ç„¶ååœ¨ create</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> existing.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetDeletionTimestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// check if recreation needed</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a.c.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, existing); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">             return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cannot delete object&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a.c.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, desired), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cannot recreate object&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æœ€ååœ¨æœ‰æ›´æ–°çš„è¯å°±ï¼ŒåŒºåˆ†æ˜¯ update è¿˜æ˜¯ patch è°ƒç”¨ä¸åŒçš„æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> strategy.Op {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v1alpha1.ResourceUpdateStrategyReplace:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wrapf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a.c.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, desired, options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cannot update object&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v1alpha1.ResourceUpdateStrategyPatch:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       fallthrough</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wrapf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a.c.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Patch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, desired, patch), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cannot patch object&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå°±çœŸæ­£çš„åœ¨è°ƒç”¨ <code>k8s api</code> æ¥å®ç°éƒ¨ç½²æ“ä½œäº†ã€‚</p><p>OKï¼Œè‡³æ­¤ï¼Œæˆ‘ä»¬æ¸²æŸ“å‡ºæ¥çš„ <code>k8s object</code> ç»ˆäºæ˜¯ apply åˆ°é›†ç¾¤é‡Œäº†ã€‚</p><p>æ•´ä¸ªæµç¨‹è¿˜æ˜¯æœ‰è¿™ä¹ˆå¤æ‚..</p><p>è¿™é‡Œåˆ†æçš„æ—¶å€™è¿˜æ˜¯åªçœ‹äº†æ ¸å¿ƒé€»è¾‘ï¼ŒåŠ ä¸Šå…¶ä»–éæ ¸å¿ƒé€»è¾‘çš„è¯ï¼Œç®€ç›´ä¸æ•¢æƒ³ã€‚</p><h2 id="faq" tabindex="-1">FAQ <a class="header-anchor" href="#faq" aria-label="Permalink to &quot;FAQ&quot;">â€‹</a></h2><p>è¿™é‡Œè®°å½•äº†ä¸€ä¸‹ï¼Œè‡ªå·±çš„ä¸€äº›ç–‘é—®ï¼Œå®é™…ä¸Šåˆ†æå®Œæºç åå¤§éƒ¨åˆ†éƒ½è¢«è§£å¼€äº†ã€‚</p><div class="important custom-block github-alert"><p class="custom-block-title">æé—®</p><p>é—®é¢˜ä¸€ï¼šå¤šä¸ª <code>override policy</code> ä¼šæ€ä¹ˆæ‰§è¡Œï¼Ÿ</p><p>æ ¹æ®è¦†ç›–ç­–ç•¥ï¼š<code>overrideConfiguration</code>ç« èŠ‚å¯çŸ¥ï¼Œå¤šä¸ª <code>override</code> ä¼šæŒ‰å…ˆåé¡ºåºè¿›è¡Œè¦†ç›–ï¼Œä»¥åç”Ÿæ•ˆçš„ä¸ºå‡†ã€‚</p><p>é—®é¢˜äºŒï¼šä¸ºä»€ä¹ˆ <code>Application</code> ä¸­ä¸æŒ‡å®š <code>Workflow</code> ä¹Ÿèƒ½æ‰§è¡Œï¼Ÿ</p><p>å› ä¸ºåœ¨ Application Controller é€»è¾‘ä¸­æ£€æµ‹åˆ°æœªæŒ‡å®šä»»ä½• <code>Workflow</code> æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆç”¨äºéƒ¨ç½²çš„ <code>Workflow</code>ã€‚</p><ul><li><p>æƒ…å†µä¸€ï¼šæŒ‡å®šäº† <code>topology policy</code> åªæ˜¯æ²¡æœ‰æŒ‡å®š <code>Workflow</code></p><p>æ ¹æ®ç¬¬ä¸€éƒ¨åˆ†<code>DeployWorkflowStepGenerator</code>å¯çŸ¥ï¼Œä¼šæ ¹æ® <code>topology policy</code> ç”Ÿæˆé»˜è®¤ <code>Workflow</code>ã€‚</p></li><li><p>æƒ…å†µäºŒï¼šè¿ <code>topology policy</code> éƒ½æ²¡æœ‰æŒ‡å®š</p><p>ç¬¬ä¸€éƒ¨åˆ†<code>ApplyComponentWorkflowStepGenerator</code>ä¼šé»˜è®¤ä¼šæ¯ä¸ª <code>component</code> ç”Ÿæˆä¸€ä¸ª <code>step</code> ç”¨äºéƒ¨ç½²ã€‚</p><p>ç¬¬ä¸‰éƒ¨åˆ†è·å–ç›®æ ‡é›†ç¾¤å’Œå‘½åç©ºé—´ï¼š<code>GetPlacementsFromTopologyPolicies</code>åœ¨æ²¡æœ‰æŒ‡å®šéƒ¨ç½²ä½ç½®æ—¶ä¼šé»˜è®¤éƒ¨ç½²åˆ° <code>local</code> é›†ç¾¤çš„ <code>default</code> å‘½åç©ºé—´ã€‚</p></li></ul><p>å› æ­¤ï¼šæœªæŒ‡å®š <code>topology policy</code> å’Œ <code>Workflow</code> çš„ <code>Application</code> ä¹Ÿä¼šè¢«éƒ¨ç½²åˆ° <code>local</code> é›†ç¾¤çš„ <code>default</code> å‘½åç©ºé—´ã€‚</p></div><div class="warning custom-block"><p class="custom-block-title">æ³¨æ„ğŸ“¢ï¼š</p><p>ä½†æ˜¯å¦‚æœæ‰‹åŠ¨æŒ‡å®šäº†ä¸€ä¸ª <code>WorkflowStep</code> å°±ä¼šå¯¼è‡´ä¸Šè¿°é€»è¾‘å¤±æ•ˆï¼Œæœ€ç»ˆ <code>Application</code> å¯¹è±¡å¯èƒ½æ— æ³•è¢«éƒ¨ç½²å‡ºæ¥ã€‚</p></div><p>å› æ­¤è¦ä¹ˆä¸å†™ <code>Workflow</code>ï¼Œè¦ä¹ˆå°±ä¿è¯ <code>Workflow</code> æ˜¯å¯¹çš„ã€‚</p><h2 id="å°ç»“" tabindex="-1">å°ç»“ <a class="header-anchor" href="#å°ç»“" aria-label="Permalink to &quot;å°ç»“&quot;">â€‹</a></h2><p>æµç¨‹å’Œä¹‹å‰è¯´çš„å·®ä¸å¤šï¼Œå¤§è‡´åˆ†ä¸ºè¿™å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>1ï¼‰é¦–å…ˆè§£æ app å¯¹è±¡ï¼Œè§£æä¸º å†…éƒ¨çš„ <code>appfile</code><ul><li>App å¯¹è±¡æ˜¯ä¸ªç”¨æˆ·çœ‹çš„ï¼ŒKubeVela å†…éƒ¨ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå«åš <code>appfile</code> çš„ç»“æ„ä½“</li><li>è¿™é‡Œå°±ä¼šåˆ†ç¦» app é‡Œçš„ <code>componentã€policyã€workflow</code> ç­‰ç»“æ„</li></ul></li><li>2ï¼‰æŸ¥è¯¢ CRD æ‹¿åˆ°å¯¹åº”æ’ä»¶é‡Œçš„ <code>spec.cue.template</code><ul><li>å› ä¸º KubeVela é‡Œé¢çš„æ’ä»¶ä¹Ÿæ˜¯é€šè¿‡ CRD å½¢å¼æ³¨å†Œçš„ï¼Œå› æ­¤è¿™é‡Œç›´æ¥é€šè¿‡æŸ¥è¯¢ CRD æ‹¿åˆ°æ’ä»¶å¯¹è±¡</li><li>CRD çš„åå­—å°±æ˜¯æŸ¥è¯¢çš„ç±»å‹</li></ul></li><li>3ï¼‰å°† CUE æ¨¡æ¿å’Œç»„ä»¶é‡Œçš„å‚æ•°åˆå¹¶ç”Ÿæˆ <code>k8s object</code><ul><li>è¿™éƒ¨åˆ†å°±æ˜¯è°ƒç”¨çš„ CUE çš„åŒ…äº†</li></ul></li><li>4ï¼‰ç”Ÿæˆ <code>Workflow</code> å¹¶æ‰§è¡Œï¼Œ<code>Workflow</code> é‡Œæœ‰ä¸€ä¸ª apply ç±»å‹çš„ <code>handler</code>ï¼Œå°±æ˜¯æŠŠ <code>k8s object</code> åº”ç”¨åˆ°å¯¹åº”é›†ç¾¤é‡Œ <ul><li>æ¯ä¸ªæ­¥éª¤æ˜¯å•ç‹¬æ‰§è¡Œçš„ï¼Œäº’ä¸å¹²æ‰°ã€‚</li><li>æ¯ä¸ªæ­¥éª¤æ‰§è¡Œéƒ½ä¼šæ ¹æ®å…³è”çš„ç­–ç•¥è®¡ç®—ç›®æ ‡é›†ç¾¤ã€ç»„ä»¶å‚æ•°è¦†ç›–ç­‰æ•°æ®</li></ul></li></ul><p>æ¯”è¾ƒé‡è¦çš„å°±æ˜¯ä¸¤éƒ¨åˆ†å§ï¼š</p><ul><li>1ï¼‰app å¯¹è±¡åœ¨ KubeVela å†…éƒ¨æ˜¯æ€ä¹ˆè§£ææˆ <code>appFile</code> ç„¶åæ¸²æŸ“æˆ <code>k8s object</code> çš„</li><li>2ï¼‰<code>ExecuteRunners</code> éƒ¨åˆ†ï¼Œ<code>Workflow</code> æ˜¯ä»€ä¹ˆç”Ÿæˆçš„ï¼Œå„ç§ç±»å‹çš„ <code>policy</code> æ˜¯æ€ä¹ˆå¤„ç†çš„</li></ul></div></div></main><footer class="VPDocFooter" data-v-73d3112f data-v-f5aa77c9><!--[--><!--]--><div class="edit-info" data-v-f5aa77c9><div class="edit-link" data-v-f5aa77c9><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/hyperter96/tech-blog/tree/main/docs/posts/kubevela/application-controller-source-code-analysis-2.md" target="_blank" rel="noreferrer" data-v-f5aa77c9><!--[--><span class="vpi-square-pen edit-link-icon" data-v-f5aa77c9></span> å» GitHub ä¸Šç¼–è¾‘å†…å®¹<!--]--></a></div><div class="last-updated" data-v-f5aa77c9><p class="VPLastUpdated" data-v-f5aa77c9 data-v-b5c6977b>ä¸Šæ¬¡æ›´æ–°äº: <time datetime="2025-02-19T00:15:19.000Z" data-v-b5c6977b></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-f5aa77c9><span class="visually-hidden" id="doc-footer-aria-label" data-v-f5aa77c9>Pager</span><div class="pager" data-v-f5aa77c9><a class="VPLink link pager-link prev" href="/posts/kubevela/application-controller-source-code-analysis-1.html" data-v-f5aa77c9><!--[--><span class="desc" data-v-f5aa77c9>Previous page</span><span class="title" data-v-f5aa77c9>Kubevelaç³»åˆ—äºŒï¼šApplication Controller æºç åˆ†æ(ä¸Š)</span><!--]--></a></div><div class="pager" data-v-f5aa77c9><a class="VPLink link pager-link next" href="/posts/kubevela/addon-build-instruction.html" data-v-f5aa77c9><!--[--><span class="desc" data-v-f5aa77c9>Next page</span><span class="title" data-v-f5aa77c9>Kubevelaç³»åˆ—å››ï¼šæ’ä»¶æŒ‡å—-è½»æ¾æ‰©å±•ä½ çš„å¹³å°ä¸“å±èƒ½åŠ›</span><!--]--></a></div></nav></footer><!--[--><!--[--><!--[--><!--[--><!--]--><!----><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"aboutme.md\":\"DQLiUrq5\",\"fun_catch-the-cat.md\":\"lZHAUMT9\",\"index.md\":\"D4YpTdVP\",\"posts_ai_cognition-design.md\":\"CKvHY1P5\",\"posts_ai_cyber-fortune-telling-design.md\":\"C62-fGo9\",\"posts_ai_llm-for-aml.md\":\"C2221Akb\",\"posts_ai_lora-parameter.md\":\"1LPDUxPV\",\"posts_ai_reinforcement-lora-ft.md\":\"CT1vPEry\",\"posts_cilium_bgp-exercise-bird-cilium.md\":\"D-Mne_sa\",\"posts_cilium_cilium-gateway-api.md\":\"DS7nGxED\",\"posts_cilium_cilium-intro.md\":\"CQNtE2gH\",\"posts_cilium_exercise-cluster-mesh.md\":\"HYN6sLUn\",\"posts_cilium_install-cluster-with-kubeovn.md\":\"CxAp1ySz\",\"posts_cybersecurity_aml_analysis-network-traffic-characteristics.md\":\"Bt-OPvGL\",\"posts_cybersecurity_aml_keda-rule-infra.md\":\"CG6NamTy\",\"posts_cybersecurity_aml_rule-based.md\":\"CG2x4xTD\",\"posts_dragonfly_dragonfly-intro.md\":\"BYrGOBtI\",\"posts_dragonfly_exercise-dragonfly-with-nydus.md\":\"DdDzPeP0\",\"posts_interview_tcp-åŸºç¡€è®¤è¯†.md\":\"B2D7cPui\",\"posts_interview_tcp.md\":\"CT9UZRe0\",\"posts_jaeger_exercise-jaeger-in-prod.md\":\"DZ0Kvwt6\",\"posts_jaeger_jaeger-in-gin-and-grpc.md\":\"B_ltGUi1\",\"posts_kubeovn_kubeovn-intro.md\":\"BvEtU1Yu\",\"posts_kubeovn_vpc-nat-gateway-config.md\":\"CEoEhaXi\",\"posts_kubevela_addon-build-instruction.md\":\"RXLXE9W8\",\"posts_kubevela_application-controller-source-code-analysis-1.md\":\"JdDLbm-8\",\"posts_kubevela_application-controller-source-code-analysis-2.md\":\"Bo_TIZCE\",\"posts_kubevela_get-to-know-kubevela.md\":\"CPx1HoGP\",\"posts_kubevela_kubevela-integrate-multicluster-with-ocm.md\":\"x8Z6I1s2\",\"posts_kubevirt_hotplug-interface.md\":\"CuYqMXMT\",\"posts_kubevirt_quick-deploy-centos7.md\":\"-je1fimF\",\"posts_learning-path.md\":\"COXbGj-N\",\"posts_linux_centos7-upgrade-to-stream9.md\":\"BrXoXzVj\",\"posts_linux_install-vm-centos-stream9.md\":\"D5DFdIDR\",\"posts_mysql_mysql-index.md\":\"C4L2flkf\",\"posts_mysql_mysql-infra.md\":\"DaqMFmuM\",\"posts_programming_go_array-and-slices.md\":\"B2rHRzNh\",\"posts_programming_go_channel.md\":\"DjNhx-UG\",\"posts_programming_go_client-go_api-machinery.md\":\"Bl-9EHZ-\",\"posts_programming_go_client-go_client-go-pkg-part1.md\":\"DIymuv5s\",\"posts_programming_go_client-go_client-go-pkg-part2.md\":\"DeJ8Iucv\",\"posts_programming_go_client-go_clientset.md\":\"B61u0S2z\",\"posts_programming_go_client-go_informer-exercise.md\":\"ClfymAAi\",\"posts_programming_go_client-go_informer.md\":\"CvBbDGKC\",\"posts_programming_go_client-go_intro.md\":\"XPgMAAHi\",\"posts_programming_go_defer.md\":\"B2qglO16\",\"posts_programming_go_goroutine.md\":\"DyHaZUa2\",\"posts_programming_go_interface.md\":\"DHDQ-IdM\",\"posts_programming_go_mutex.md\":\"BUq9QBMD\",\"posts_programming_go_waitgroup.md\":\"Bcbk3HbI\",\"posts_programming_rust_borrowing.md\":\"vg_eqiAI\",\"posts_programming_rust_disable-warning.md\":\"BxxCzPik\",\"posts_programming_rust_fundamental-type.md\":\"C90Kx4x4\",\"posts_programming_rust_get-to-know-cargo.md\":\"tQIsFRlW\",\"posts_programming_rust_ownership.md\":\"Bi_2Hcue\",\"posts_programming_rust_rust-function.md\":\"DjwdX78s\",\"posts_programming_rust_statement-expr-print.md\":\"uERWo5Mv\",\"posts_programming_rust_types-system.md\":\"BVl4gY5_\",\"posts_programming_rust_variable-bindings.md\":\"CLoXhO4Q\",\"posts_programming_webassembly_run-wasm-app-from-host.md\":\"V8jiuD3p\",\"posts_programming_webassembly_webassembly-full-stack-app.md\":\"DUPmaxvd\",\"posts_quantum_ph219-lecture1.md\":\"SsQb8dKV\",\"posts_troubleshooting_k8s-pod-abnormal-analysis.md\":\"B8jBESTZ\",\"posts_velero_intro-and-practice.md\":\"CkM5-OQH\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"çš®ç‰¹á´¾áµ—çš„åšå®¢å……ç”µæ ˆ\",\"description\":\"çƒ­è¡·äºé‡å­è®¡ç®—ã€AIä»¥åŠäº‘åŸç”ŸæŠ€æœ¯ï¼Œä¸€ç›´ä¸ºå®ç°è‡ªæˆ‘ä»·å€¼è€Œæ‰§ç€ï¼\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"blog\":{\"pagesData\":[{\"route\":\"/aboutme\",\"meta\":{\"sidebar\":false,\"title\":\"å…³äºè‡ªå·±\",\"date\":\"2021-11-13 00:00:00\",\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/lighthouse.jpg\",\"tags\":[\"å…¶å®ƒ\"],\"tag\":[\"å…¶å®ƒ\"],\"description\":\"å…³äºæˆ‘\\n---\\n96å¹´å‡ºç”Ÿï¼Œæ ‡å‡†çš„ç†å·¥ç”·ä¸€æš,æ¯•ä¸šäº(åŠ æ‹¿å¤§æ»‘é“å¢å¤§å­¦),çƒ­çˆ±å¼€æºä¸çŸ¥è¯†åˆ†äº«~\\né™¤äº†æŠ€æœ¯ï¼Œæœ¬äººä¹Ÿæ˜¯å¯¹å¿ƒç†å­¦æœ‰æµ“åšçš„å…´è¶£ï¼Œçƒ­è¡·äºç ”ç©¶mbtiï¼Œå¸Œæœ›å¯ä»¥å¤šä¸€ç‚¹äº†è§£è‡ªå·±è¿˜æœ‰èº«è¾¹çš„äººï¼Œç†è§£ä¸ºäºº\"}},{\"route\":\"/fun/catch-the-cat\",\"meta\":{\"date\":\"2021-02-02 03:04:49\",\"draft\":false,\"title\":\"é€®ä½é‚£åªçŒ«ï¼\",\"sidebar\":false,\"tags\":[\"å…¶å®ƒ\"],\"tag\":[\"å…¶å®ƒ\"],\"description\":\"æ¸¸æˆè§„åˆ™\\n1. ç‚¹å‡»å°åœ†ç‚¹ï¼Œå›´ä½å°çŒ«ã€‚\\n2. ä½ ç‚¹å‡»ä¸€æ¬¡ï¼Œå°çŒ«èµ°ä¸€æ¬¡ã€‚\\n3. ç›´åˆ°ä½ æŠŠå°çŒ«å›´ä½ï¼ˆèµ¢ï¼‰ï¼Œæˆ–è€…å°çŒ«èµ°åˆ°è¾¹ç•Œå¹¶é€ƒè·‘ï¼ˆè¾“ï¼‰ã€‚\\n---\\n&lt;div align=\\\"center\\\"\\n    &l\",\"cover\":\"\"}},{\"route\":\"/posts/ai/cognition-design\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background2.jpg\",\"date\":\"2025-02-04 00:00:00\",\"tag\":[\"AI\",\"äººå·¥æ™ºèƒ½\",\"Agentè®¾è®¡\"],\"sticky\":1,\"prev\":{\"link\":\"/posts/ai/reinforcement-lora-ft\",\"text\":\"é€šè¿‡å¼ºåŒ–å­¦ä¹ å®ç°åé¦ˆä¼˜åŒ–å±‚çš„è‡ªåŠ¨ LoRA å¾®è°ƒ\"},\"next\":{\"link\":\"/posts/ai/cyber-fortune-telling-design\",\"text\":\"å…³äºèµ›åšç®—å‘½ç³»ç»Ÿçš„AI agentè®¾è®¡\"},\"title\":\"å…³äºAIæ—¶ä»£è®¤çŸ¥ç³»ç»Ÿçš„AI agentè®¾è®¡\",\"description\":\"å…³äºAIæ—¶ä»£è®¤çŸ¥ç³»ç»Ÿçš„AI agentè®¾è®¡\\nä»¥ä¸‹æ˜¯å…³äºæ„å»ºAIæ—¶ä»£è®¤çŸ¥ç³»ç»Ÿçš„AI Agentçš„æ·±åº¦è®¾è®¡æ¡†æ¶ï¼ŒåŒ…å«è®¤çŸ¥ç§‘å­¦ã€ç³»ç»Ÿæ¶æ„å’Œå‰æ²¿æŠ€æœ¯èåˆçš„æ€è€ƒï¼š\\n---\\n ä¸€ã€è®¤çŸ¥ç³»ç»Ÿå±‚çº§æ¶æ„è®¾è®¡\\n1. æ„ŸçŸ¥\"}},{\"route\":\"/posts/ai/cyber-fortune-telling-design\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background2.jpg\",\"date\":\"2025-02-05 00:00:00\",\"tag\":[\"AI\",\"äººå·¥æ™ºèƒ½\",\"Agentè®¾è®¡\"],\"sticky\":1,\"prev\":{\"link\":\"/posts/ai/cognition-design\",\"text\":\"å…³äºAIæ—¶ä»£è®¤çŸ¥ç³»ç»Ÿçš„AI agentè®¾è®¡\"},\"title\":\"å…³äºèµ›åšç®—å‘½ç³»ç»Ÿçš„AI agentè®¾è®¡\",\"description\":\"å…³äºèµ›åšç®—å‘½ç³»ç»Ÿçš„AI agentè®¾è®¡\\nä»¥ä¸‹æ˜¯å…³äºèµ›åšç®—å‘½ç³»ç»Ÿçš„AI Agentåˆ›æ–°è®¾è®¡æ–¹æ¡ˆï¼Œé‡‡ç”¨æŠ€æœ¯ä¸­ç«‹åŸåˆ™å¹¶ä¸¥æ ¼éµå¾ªä¼¦ç†çº¦æŸï¼š\\n---\\n ä¸€ã€ç³»ç»Ÿæ ¸å¿ƒæ¶æ„è®¾è®¡\\n1. äº¤äº’æ„ŸçŸ¥å±‚ï¼ˆåŸºäºå…ƒå®‡å®™æ¥å£ï¼‰\\n\"}},{\"route\":\"/posts/ai/llm-for-aml\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background2.jpg\",\"date\":\"2025-02-04 00:00:00\",\"tag\":[\"AI\",\"äººå·¥æ™ºèƒ½\",\"AML\",\"åŒºå—é“¾\"],\"sticky\":1,\"title\":\"LLMåœ¨æ´—é’±è§„å¾‹ä¸­çš„å‘ç°å’ŒæŠ€æœ¯å®ç°\",\"description\":\"LLMåœ¨æ´—é’±è§„å¾‹ä¸­çš„å‘ç°å’ŒæŠ€æœ¯å®ç°\\n è§„å¾‹å‘ç°çš„ä¸‰çº§æ¶æ„ä½“ç³»\\n1. æ•°æ®è¡¨å¾å±‚\\n- å¤šç²’åº¦åµŒå…¥æŠ€æœ¯ï¼šé‡‡ç”¨å±‚æ¬¡åŒ–Transformerå°†ç»“æ„åŒ–æ•°æ®è½¬æ¢ä¸º768+ç»´è¯­ä¹‰ç©ºé—´åæ ‡\\n- æ—¶åºå…³ç³»ç¼–ç ï¼šé€šè¿‡æ—¶é—´\"}},{\"route\":\"/posts/ai/lora-parameter\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background2.jpg\",\"date\":\"2025-02-03 00:00:00\",\"tag\":[\"AI\",\"äººå·¥æ™ºèƒ½\",\"å¼ºåŒ–å­¦ä¹ \",\"Fine Tuning\"],\"sticky\":1,\"prev\":{\"link\":\"/posts/ai/reinforcement-lora-ft\",\"text\":\"é€šè¿‡å¼ºåŒ–å­¦ä¹ å®ç°åé¦ˆä¼˜åŒ–å±‚çš„è‡ªåŠ¨ LoRA å¾®è°ƒ\"},\"title\":\"LoRAå¾®è°ƒçš„å‚æ•°å¯¹è®­ç»ƒæ¨¡å‹çš„ä½œç”¨å’Œå½±å“\",\"description\":\"LoRAå¾®è°ƒæ ¸å¿ƒå‚æ•°æ¸…å•\\n|å‚æ•°å|å…¸å‹å€¼èŒƒå›´|ä½œç”¨|å¯¹æ¨¡å‹çš„å½±å“|\\n|------|----------|----|------------|\\n|ç§© (rank, $r$)|`2~64`|æ§åˆ¶ä½ç§©çŸ©\"}},{\"route\":\"/posts/ai/reinforcement-lora-ft\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background2.jpg\",\"date\":\"2025-02-02 00:00:00\",\"tag\":[\"AI\",\"äººå·¥æ™ºèƒ½\",\"å¼ºåŒ–å­¦ä¹ \",\"Fine Tuning\"],\"sticky\":1,\"next\":{\"link\":\"/posts/ai/lora-parameter\",\"text\":\"LoRAå¾®è°ƒçš„å‚æ•°å¯¹è®­ç»ƒæ¨¡å‹çš„ä½œç”¨å’Œå½±å“\"},\"title\":\"é€šè¿‡å¼ºåŒ–å­¦ä¹ å®ç°åé¦ˆä¼˜åŒ–å±‚çš„è‡ªåŠ¨ LoRA å¾®è°ƒ\",\"description\":\"é€šè¿‡å¼ºåŒ–å­¦ä¹ å®ç°åé¦ˆä¼˜åŒ–å±‚çš„è‡ªåŠ¨ LoRA å¾®è°ƒ\\nè¦å®ç°åŸºäºå¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰çš„è‡ªåŠ¨ LoRAï¼ˆLow-Rank Adaptationï¼‰å¾®è°ƒï¼Œéœ€å°†æ¨¡å‹å¾®è°ƒè¿‡ç¨‹è½¬åŒ–ä¸ºç­–ç•¥ä¼˜åŒ–é—®é¢˜ï¼Œé€šè¿‡åŠ¨æ€å¥–åŠ±æœºåˆ¶å¼•å¯¼æ¨¡å‹\"}},{\"route\":\"/posts/cilium/bgp-exercise-bird-cilium\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/cilium-bgp-demo.svg\",\"date\":\"2024-02-05 00:00:00\",\"tag\":[\"Cilium\",\"ç½‘ç»œ\",\"cni\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Ciliumç³»åˆ—ä¸€ï¼šCiliumæ¶æ„ä½“ç³»\",\"link\":\"/posts/cilium/cilium-intro\"},\"next\":{\"text\":\"Ciliumç³»åˆ—ä¸‰ï¼šCiliumåœ¨é›†ç¾¤ç½‘æ ¼Cluster Meshä¸­çš„å®è·µ\",\"link\":\"/posts/cilium/exercise-cluster-mesh\"},\"title\":\"Ciliumç³»åˆ—äºŒï¼šä½¿ç”¨birdå’Œciliuméƒ¨ç½²BGPæ¨¡å¼çš„k8sé›†ç¾¤\",\"description\":\"Ciliumç³»åˆ—äºŒï¼šä½¿ç”¨birdå’Œciliuméƒ¨ç½²BGPæ¨¡å¼çš„k8sé›†ç¾¤\\nè¿™æ˜¯ä½¿ç”¨ Cilium BGP æ§åˆ¶å¹³é¢ (BGP CP) å‘å¤–éƒ¨ BGP è·¯ç”±å™¨é€šå‘Šè·¯ç”±ä»¥åŠåœ¨ä¸¤ä¸ªé›†ç¾¤ä¹‹é—´è·¯ç”±çš„æ¼”ç¤ºã€‚ æ¯ä¸ª\"}},{\"route\":\"/posts/cilium/cilium-gateway-api\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/kubernetes-gateway-api-cilium.jpg\",\"date\":\"2024-02-22 00:00:00\",\"tag\":[\"Cilium\",\"ç½‘ç»œ\",\"cni\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Ciliumç³»åˆ—å››ï¼šCiliumé›†æˆkubeOVNå®‰è£…k8sé›†ç¾¤\",\"link\":\"/posts/cilium/install-cluster-with-kubeOVN\"},\"title\":\"Ciliumç³»åˆ—äº”ï¼šCiliumé›†æˆGateway API\",\"description\":\"Ciliumç³»åˆ—äº”ï¼šCiliumé›†æˆGateway API\\n å‰ç½®æ¡ä»¶\\n- Cilium å¿…é¡»é…ç½®ä¸ºå¯ç”¨ NodePortï¼Œä½¿ç”¨ `nodePort.enabled=true` æˆ–ä½¿ç”¨ `kubePr\"}},{\"route\":\"/posts/cilium/cilium-intro\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cilium.io/static/620dc85c97b669d3417218f1602224df/905a7/intro.webp\",\"date\":\"2024-02-04 00:00:00\",\"tag\":[\"Cilium\",\"ç½‘ç»œ\",\"cni\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Ciliumç³»åˆ—äºŒï¼šä½¿ç”¨birdå’Œciliuméƒ¨ç½²BGPæ¨¡å¼çš„k8sé›†ç¾¤\",\"link\":\"/posts/cilium/bgp-exercise-bird-cilium\"},\"title\":\"Ciliumç³»åˆ—ä¸€ï¼šCiliumæ¶æ„ä½“ç³»\",\"description\":\"Ciliumç³»åˆ—ä¸€ï¼šCiliumæ¶æ„ä½“ç³»\\nCilium æ˜¯ä¸€æ¬¾å¼€æºè½¯ä»¶ï¼Œä¹Ÿæ˜¯ CNCF çš„å­µåŒ–é¡¹ç›®ï¼Œç›®å‰å·²æœ‰å…¬å¸æä¾›å•†ä¸šåŒ–æ”¯æŒï¼Œè¿˜æœ‰åŸºäº Cilium å®ç°çš„æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆã€‚æœ€åˆå®ƒä»…æ˜¯ä½œä¸ºä¸€ä¸ª Ku\"}},{\"route\":\"/posts/cilium/exercise-cluster-mesh\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/cluster-mesh.png\",\"date\":\"2024-02-07 00:00:00\",\"tag\":[\"Cilium\",\"ç½‘ç»œ\",\"cni\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Ciliumç³»åˆ—äºŒï¼šä½¿ç”¨birdå’Œciliuméƒ¨ç½²BGPæ¨¡å¼çš„k8sé›†ç¾¤\",\"link\":\"/posts/cilium/bgp-exercise-bird-cilium\"},\"next\":{\"text\":\"Ciliumç³»åˆ—å››ï¼šCiliumé›†æˆkubeOVNå®‰è£…k8sé›†ç¾¤\",\"link\":\"/posts/cilium/install-cluster-with-kubeOVN\"},\"title\":\"Ciliumç³»åˆ—ä¸‰ï¼šCiliumåœ¨é›†ç¾¤ç½‘æ ¼Cluster Meshä¸­çš„å®è·µ\",\"description\":\"Ciliumç³»åˆ—ä¸‰ï¼šCiliumåœ¨é›†ç¾¤ç½‘æ ¼Cluster Meshä¸­çš„å®è·µ\\nCilium Cluster Mesh å…è®¸æ‚¨è¿æ¥å¤šä¸ªé›†ç¾¤çš„ç½‘ç»œï¼Œåªè¦æ‰€æœ‰é›†ç¾¤éƒ½è¿è¡Œ Cilium ä½œä¸ºå…¶ CNIï¼Œæ¯ä¸ªé›†ç¾¤\"}},{\"route\":\"/posts/cilium/install-cluster-with-kubeOVN\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/cilium-kubeOVN-cover.png\",\"date\":\"2024-02-20 00:00:00\",\"tag\":[\"Cilium\",\"ç½‘ç»œ\",\"cni\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Ciliumç³»åˆ—ä¸‰ï¼šCiliumåœ¨é›†ç¾¤ç½‘æ ¼Cluster Meshä¸­çš„å®è·µ\",\"link\":\"/posts/cilium/exercise-cluster-mesh\"},\"next\":{\"text\":\"Ciliumç³»åˆ—äº”ï¼šCiliumé›†æˆGateway API\",\"link\":\"/posts/cilium/cilium-gateway-api\"},\"title\":\"Ciliumç³»åˆ—å››ï¼šCiliumé›†æˆkubeOVNå®‰è£…k8sé›†ç¾¤\",\"description\":\"Ciliumç³»åˆ—å››ï¼šCiliumé›†æˆkubeOVNå®‰è£…k8sé›†ç¾¤\\n å‰ææ¡ä»¶\\n- helm\\n- sealosäºŒè¿›åˆ¶cli\\n- kubeOVNçš„å®‰è£…è„šæœ¬`install.sh`\\nèŠ‚ç‚¹è§„åˆ’å¦‚ä¸‹ï¼š\\n|è§’è‰²|\"}},{\"route\":\"/posts/cyberSecurity/aml/analysis-network-traffic-characteristics\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/algorithm-1.jpeg\",\"date\":\"2024-12-22 00:00:00\",\"sticky\":1,\"tags\":[\"ç½‘ç»œå®‰å…¨\",\"AML\"],\"prev\":{\"text\":\"åŸºäºKEDAäº‹ä»¶é©±åŠ¨çš„AMLè§„åˆ™å¼•æ“æ¶æ„è®¾è®¡\",\"link\":\"/posts/cyberSecurity/keda-rule-infra\"},\"title\":\"åŸºäº Weight of Evidence (WOE) å’Œ Information Value (IV) çš„ç½‘ç»œæµé‡ç‰¹å¾åˆ†æ\",\"tag\":[\"ç½‘ç»œå®‰å…¨\",\"AML\"],\"description\":\"åŸºäº Weight of Evidence (WOE) å’Œ Information Value (IV) çš„ç½‘ç»œæµé‡ç‰¹å¾åˆ†æ\\nåŸºäº Weight of Evidence (WOE) å’Œ Informa\"}},{\"route\":\"/posts/cyberSecurity/aml/keda-rule-infra\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/algorithm-1.jpeg\",\"date\":\"2024-12-19 00:00:00\",\"sticky\":1,\"tags\":[\"ç½‘ç»œå®‰å…¨\",\"AML\"],\"prev\":{\"text\":\"AMLè§„åˆ™æ¢ç´¢\",\"link\":\"/posts/cyberSecurity/rule-based\"},\"next\":{\"text\":\"åŸºäºWOEå’ŒIVçš„ç½‘ç»œæµé‡ç‰¹å¾åˆ†æ\",\"link\":\"/posts/cyberSecurity/analysis-network-traffic-characteristics\"},\"title\":\"åŸºäºKEDAäº‹ä»¶é©±åŠ¨çš„AMLè§„åˆ™å¼•æ“æ¶æ„è®¾è®¡\",\"tag\":[\"ç½‘ç»œå®‰å…¨\",\"AML\"],\"description\":\"åŸºäºKEDAäº‹ä»¶é©±åŠ¨çš„AMLè§„åˆ™å¼•æ“æ¶æ„è®¾è®¡\\n KEDAäº‹ä»¶é©±åŠ¨æœºåˆ¶\\nä½¿ç”¨ KEDA (Kubernetes Event-driven Autoscaling) äº‹ä»¶é©±åŠ¨æœºåˆ¶æ¥è§¦å‘ AML (Anti\"}},{\"route\":\"/posts/cyberSecurity/aml/rule-based\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/algorithm-1.jpeg\",\"date\":\"2024-12-17 00:00:00\",\"sticky\":1,\"tags\":[\"ç½‘ç»œå®‰å…¨\",\"AML\"],\"next\":{\"text\":\"AMLè§„åˆ™å¼•æ“æ¶æ„è®¾è®¡\",\"link\":\"/posts/cyberSecurity/keda-rule-infra\"},\"title\":\"AMLè§„åˆ™æ¢ç´¢\",\"tag\":[\"ç½‘ç»œå®‰å…¨\",\"AML\"],\"description\":\"AMLè§„åˆ™æ¢ç´¢\\nAMLè§„åˆ™å¼•æ“é€šè¿‡å®šä¹‰å„ç§â€œè§„åˆ™â€æ¥ç›‘æ§äº¤æ˜“ï¼Œè¯†åˆ«å¯ç–‘æ´»åŠ¨ï¼Œå¹¶è§¦å‘ç›¸åº”çš„è­¦æŠ¥æˆ–è°ƒæŸ¥ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®çš„AMLè§„åˆ™è®¾è®¡å’Œç­–ç•¥ï¼Œå¯ç”¨äºæ£€æµ‹å¸¸è§çš„æ´—é’±æ‰‹æ®µï¼š\\n äº¤æ˜“é‡‘é¢å’Œé¢‘ç‡è§„åˆ™\\n å¤§é¢äº¤æ˜“è§„\"}},{\"route\":\"/posts/dragonfly/dragonfly-intro\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/dragonfly_cover.jpg\",\"date\":\"2024-01-07 00:00:00\",\"tag\":[\"P2P\",\"Dragonfly\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Dragonflyç³»åˆ—äºŒï¼šDragonfly å’Œ Nydus Mirror æ¨¡å¼é›†æˆå®è·µ\",\"link\":\"/posts/dragonfly/exercise-dragonfly-with-nydus\"},\"title\":\"Dragonflyç³»åˆ—ä¸€ï¼šDragonflyæ¶æ„ä½“ç³»\",\"description\":\"Dragonflyç³»åˆ—ä¸€ï¼šDragonflyæ¶æ„ä½“ç³»\\nDragonflyæ˜¯ä¸€ä¸ªåŸºäºP2Pçš„å¼€æºæ–‡ä»¶åˆ†å‘å’Œå›¾åƒåŠ é€Ÿç³»ç»Ÿã€‚ å®ƒç”±äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼š (CNCF) ä½œä¸ºå­µåŒ–çº§é¡¹ç›®æ‰˜ç®¡ã€‚ å…¶ç›®æ ‡æ˜¯è§£å†³äº‘åŸç”Ÿæ¶æ„\"}},{\"route\":\"/posts/dragonfly/exercise-dragonfly-with-nydus\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/dragonfly_cover.jpg\",\"date\":\"2024-01-09 00:00:00\",\"tag\":[\"P2P\",\"Dragonfly\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Dragonflyç³»åˆ—ä¸€ï¼šDragonflyæ¶æ„ä½“ç³»\",\"link\":\"/posts/dragonfly/dragonfly-intro\"},\"title\":\"Dragonflyç³»åˆ—äºŒï¼šDragonfly å’Œ Nydus Mirror æ¨¡å¼é›†æˆå®è·µ\",\"description\":\"Dragonflyç³»åˆ—äºŒï¼šDragonfly å’Œ Nydus Mirror æ¨¡å¼é›†æˆå®è·µ\\n`Nydus` ä½œä¸º `Dragonfly` çš„å­é¡¹ç›®ä¼˜åŒ–äº† `OCIv1` é•œåƒæ ¼å¼ï¼Œå¹¶ä»¥æ­¤è®¾è®¡äº†ä¸€ä¸ªé•œåƒæ–‡\"}},{\"route\":\"/posts/interview/tcp-åŸºç¡€è®¤è¯†\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/lazer.png\",\"author\":\"çš®ç‰¹á´¾áµ—\",\"date\":\"2024-02-10 00:00:00\",\"categories\":[\"TCP\",\"é¢è¯•\"],\"prev\":{\"text\":\"é¢è¯•ç³»åˆ—ä¹‹ï¼šTCPç¯‡\",\"link\":\"/posts/interview/tcp\"},\"title\":\"é¢è¯•ç³»åˆ—ä¹‹ï¼šTCPåŸºç¡€è®¤è¯†\",\"tag\":[\"TCP\",\"é¢è¯•\"],\"description\":\"é¢è¯•ç³»åˆ—ä¹‹ï¼šTCPåŸºç¡€è®¤è¯†\\n TCP å¤´æ ¼å¼æœ‰å“ªäº›ï¼Ÿ\\næˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ TCP å¤´çš„æ ¼å¼ï¼Œæ ‡æ³¨é¢œè‰²çš„è¡¨ç¤ºä¸æœ¬æ–‡å…³è”æ¯”è¾ƒå¤§çš„å­—æ®µï¼Œå…¶ä»–å­—æ®µä¸åšè¯¦ç»†é˜è¿°ã€‚\\nåºåˆ—å·ï¼šåœ¨å»ºç«‹è¿æ¥æ—¶ç”±è®¡ç®—æœºç”Ÿæˆçš„éšæœºæ•°ä½œä¸ºå…¶åˆå§‹å€¼\"}},{\"route\":\"/posts/interview/tcp\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/lazer.png\",\"author\":\"çš®ç‰¹á´¾áµ—\",\"date\":\"2024-02-02 09:04:00\",\"categories\":[\"TCP\",\"é¢è¯•\"],\"next\":{\"text\":\"é¢è¯•ç³»åˆ—ä¹‹ï¼šTCPåŸºç¡€è®¤è¯†\",\"link\":\"/posts/interview/tcp-åŸºç¡€è®¤è¯†\"},\"title\":\"é¢è¯•ç³»åˆ—ä¹‹ï¼šTCPç¯‡\",\"tag\":[\"TCP\",\"é¢è¯•\"],\"description\":\"é¢è¯•ç³»åˆ—ä¹‹ï¼šTCPç¯‡\\n æ¡†æ¶å›¾\\n&lt;script setup\\n  import XmindViewer from '../../.vitepress/theme/components/XmindV\"}},{\"route\":\"/posts/jaeger/exercise-jaeger-in-prod\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/Jaeger-cover1.jpg\",\"date\":\"2023-05-11 00:00:00\",\"author\":\"æ„ç¦è¡Œ\",\"tag\":[\"Jaeger\",\"åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Jaegerç³»åˆ—ä¸€ï¼šJaeger åœ¨ gin æ¡†æ¶å’Œ gRPC ä¸­çš„ä½¿ç”¨\",\"link\":\"/posts/jaeger/jaeger-in-gin-and-grpc\"},\"title\":\"Jaegerç³»åˆ—äºŒï¼šJaegerçº¿ä¸Šç¯å¢ƒéƒ¨ç½²\",\"description\":\"Jaegerç³»åˆ—äºŒï¼šJaegerçº¿ä¸Šç¯å¢ƒéƒ¨ç½²\\næœ¬æ–‡ä¸»è¦è®°å½•äº†å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²Jaegerå„ä¸ªç»„ä»¶ï¼ŒåŒ…æ‹¬ `Agent`ã€`Collector`ã€`Query`ã€`Storage` ç­‰ç­‰ã€‚\\n  æ¦‚è¿°\"}},{\"route\":\"/posts/jaeger/jaeger-in-gin-and-grpc\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/Jaeger-cover1.jpg\",\"date\":\"2023-05-04 00:00:00\",\"author\":\"æ„ç¦è¡Œ\",\"tag\":[\"Jaeger\",\"åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Jaegerç³»åˆ—äºŒï¼šJaegerçº¿ä¸Šç¯å¢ƒéƒ¨ç½²\",\"link\":\"/posts/jaeger/exercise-jaeger-in-prod\"},\"title\":\"Jaegerç³»åˆ—ä¸€ï¼šJaeger åœ¨ gin æ¡†æ¶å’Œ gRPC ä¸­çš„ä½¿ç”¨\",\"description\":\"Jaegerç³»åˆ—ä¸€ï¼šJaeger åœ¨ gin æ¡†æ¶å’Œ gRPC ä¸­çš„ä½¿ç”¨\\næœ¬æ–‡é€šè¿‡ç®€å•çš„ä¾‹å­è®°å½•äº†å¦‚ä½•åœ¨ gin æ¡†æ¶å’Œ gRPC ä¸­ä½¿ç”¨ Jaeger è¿›è¡Œé“¾è·¯è¿½è¸ªã€‚\\n `Gin`\\né€šè¿‡ `Midd\"}},{\"route\":\"/posts/kubeOVN/kubeOVN-intro\",\"meta\":{\"sidebar\":false,\"date\":\"2023-12-11 00:00:00\",\"tag\":[\"KubeOVN\",\"ç½‘ç»œ\",\"cni\",\"SDN\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"KubeOVNç³»åˆ—äºŒï¼šé…ç½®VPCç½‘å…³è¿é€šå¤–éƒ¨å…¬ç½‘\",\"link\":\"/posts/kubeOVN/vpc-nat-gateway-config\"},\"title\":\"KubeOVNç³»åˆ—ä¸€ï¼šKubeOVNæ¶æ„ä½“ç³»\",\"description\":\"KubeOVNç³»åˆ—ä¸€ï¼šKubeOVNæ¶æ„ä½“ç³»\\næ€»ä½“æ¥çœ‹ï¼ŒKube-OVN ä½œä¸º Kubernetes å’Œ OVN ä¹‹é—´çš„ä¸€ä¸ªæ¡¥æ¢ï¼Œå°†æˆç†Ÿçš„ SDN å’Œäº‘åŸç”Ÿç›¸ç»“åˆã€‚ è¿™æ„å‘³ç€ Kube-OVN ä¸ä»…é€š\",\"cover\":\"https://kubeovn.github.io/docs/v1.12.x/static/architecture.png\"}},{\"route\":\"/posts/kubeOVN/vpc-nat-gateway-config\",\"meta\":{\"sidebar\":false,\"date\":\"2023-12-13 00:00:00\",\"tag\":[\"KubeOVN\",\"ç½‘ç»œ\",\"cni\",\"SDN\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"KubeOVNç³»åˆ—ä¸€ï¼šKubeOVNæ¶æ„ä½“ç³»\",\"link\":\"/posts/kubeOVN/kubeOVN-intro\"},\"title\":\"KubeOVNç³»åˆ—äºŒï¼šé…ç½®VPCç½‘å…³è¿é€šå¤–éƒ¨å…¬ç½‘\",\"description\":\"KubeOVNç³»åˆ—äºŒï¼šé…ç½®VPCç½‘å…³è¿é€šå¤–éƒ¨å…¬ç½‘\\nKube-OVN æ”¯æŒå¤šç§Ÿæˆ·éš”ç¦»çº§åˆ«çš„ VPC ç½‘ç»œã€‚ä¸åŒ VPC ç½‘ç»œç›¸äº’ç‹¬ç«‹ï¼Œå¯ä»¥åˆ†åˆ«é…ç½® Subnet ç½‘æ®µï¼Œ è·¯ç”±ç­–ç•¥ï¼Œå®‰å…¨ç­–ç•¥ï¼Œå‡ºç½‘ç½‘å…³ï¼ŒE\",\"cover\":\"https://kubeovn.github.io/docs/v1.12.x/static/network-topology.png\"}},{\"route\":\"/posts/kubevela/addon-build-instruction\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background4.jpeg\",\"date\":\"2023-10-18 00:00:00\",\"author\":\"å§œæ´ªçƒ¨\",\"tag\":[\"Kubevela\",\"åº”ç”¨äº¤ä»˜\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevelaç³»åˆ—ä¸‰ï¼šApplication Controller æºç åˆ†æ(ä¸‹)\",\"link\":\"/posts/kubevela/application-controller-source-code-analysis-2\"},\"next\":{\"text\":\"Kubevelaç³»åˆ—äº”ï¼šKubevelaé›†æˆå¤šé›†ç¾¤OCM\",\"link\":\"/posts/kubevela/kubevela-integrate-multicluster-ocm\"},\"title\":\"Kubevelaç³»åˆ—å››ï¼šæ’ä»¶æŒ‡å—-è½»æ¾æ‰©å±•ä½ çš„å¹³å°ä¸“å±èƒ½åŠ›\",\"description\":\"Kubevelaç³»åˆ—å››ï¼šæ’ä»¶æŒ‡å—-è½»æ¾æ‰©å±•ä½ çš„å¹³å°ä¸“å±èƒ½åŠ›\\nKubeVela æ’ä»¶ï¼ˆaddonï¼‰å¯ä»¥æ–¹ä¾¿åœ°æ‰©å±• KubeVela çš„èƒ½åŠ›ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼ŒKubeVela æ˜¯ä¸€ä¸ªå¾®å†…æ ¸é«˜åº¦å¯æ‰©å±•çš„å¹³å°ï¼Œ\"}},{\"route\":\"/posts/kubevela/application-controller-source-code-analysis-1\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/k8s-1.jpeg\",\"date\":\"2023-09-22 00:00:00\",\"author\":\"æ„ç¦è¡Œ\",\"tag\":[\"Kubevela\",\"åº”ç”¨äº¤ä»˜\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevelaç³»åˆ—ä¸€ï¼šåˆè¯† KubeVelaï¼ŒåŸºäº OAM æ¨¡å‹çš„åº”ç”¨äº¤ä»˜å¹³å°\",\"link\":\"/posts/kubevela/get-to-know-kubevela\"},\"next\":{\"text\":\"Kubevelaç³»åˆ—ä¸‰ï¼šApplication Controller æºç åˆ†æ(ä¸‹)\",\"link\":\"/posts/kubevela/application-controller-source-code-analysis-2\"},\"title\":\"Kubevelaç³»åˆ—äºŒï¼šApplication Controller æºç åˆ†æ(ä¸Š)\",\"description\":\"Kubevelaç³»åˆ—äºŒï¼šApplication Controller æºç åˆ†æ(ä¸Š)\\næœ¬æ–‡ä¸»è¦åˆ†æ KubeVela ä¸­çš„ App Controller éƒ¨åˆ†æºç ï¼Œåˆ†äº« app å¯¹è±¡ apply åˆ°é›†\"}},{\"route\":\"/posts/kubevela/application-controller-source-code-analysis-2\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/k8s-2.jpeg\",\"date\":\"2023-09-23 00:00:00\",\"author\":\"æ„ç¦è¡Œ\",\"tag\":[\"Kubevela\",\"åº”ç”¨äº¤ä»˜\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevelaç³»åˆ—äºŒï¼šApplication Controller æºç åˆ†æ(ä¸Š)\",\"link\":\"/posts/kubevela/application-controller-source-code-analysis-1\"},\"next\":{\"text\":\"Kubevelaç³»åˆ—å››ï¼šæ’ä»¶æŒ‡å—-è½»æ¾æ‰©å±•ä½ çš„å¹³å°ä¸“å±èƒ½åŠ›\",\"link\":\"/posts/kubevela/addon-build-instruction\"},\"title\":\"Kubevelaç³»åˆ—ä¸‰ï¼šApplication Controller æºç åˆ†æ(ä¸‹)\",\"description\":\"Kubevelaç³»åˆ—ä¸‰ï¼šApplication Controller æºç åˆ†æ(ä¸‹)\\næœ¬æ–‡ä¸»è¦åˆ†æ KubeVela ä¸­çš„ App Controller éƒ¨åˆ†æºç ï¼Œåˆ†äº« app å¯¹è±¡ apply åˆ°é›†\"}},{\"route\":\"/posts/kubevela/get-to-know-kubevela\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/kubevela-cover1-application.png\",\"date\":\"2023-09-09 00:00:00\",\"author\":\"æ„ç¦è¡Œ\",\"tag\":[\"Kubevela\",\"åº”ç”¨äº¤ä»˜\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Kubevelaç³»åˆ—äºŒï¼šApplication Controller æºç åˆ†æ(ä¸Š)\",\"link\":\"/posts/kubevela/application-controller-source-code-analysis-1\"},\"title\":\"Kubevelaç³»åˆ—ä¸€ï¼šåˆè¯† KubeVelaï¼ŒåŸºäº OAM æ¨¡å‹çš„åº”ç”¨äº¤ä»˜å¹³å°\",\"description\":\"Kubevelaç³»åˆ—ä¸€ï¼šåˆè¯† KubeVelaï¼ŒåŸºäº OAM æ¨¡å‹çš„åº”ç”¨äº¤ä»˜å¹³å°\\næœ¬æ–‡ä¸»è¦ä»‹ç»äº† KubeVela æ˜¯ä»€ä¹ˆï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œä»¥åŠå¦‚ä½•è§£å†³çš„ã€‚\\n Kubevelaä»‹ç»\\n Kubevela\"}},{\"route\":\"/posts/kubevela/kubevela-integrate-multicluster-with-ocm\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background6.jpeg\",\"date\":\"2023-10-20 00:00:00\",\"tag\":[\"Kubevela\",\"åº”ç”¨äº¤ä»˜\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevelaç³»åˆ—å››ï¼šæ’ä»¶æŒ‡å—-è½»æ¾æ‰©å±•ä½ çš„å¹³å°ä¸“å±èƒ½åŠ›\",\"link\":\"/posts/kubevela/addon-build-instruction\"},\"title\":\"Kubevelaç³»åˆ—äº”ï¼šKubevelaé›†æˆå¤šé›†ç¾¤OCM\",\"description\":\"Kubevelaç³»åˆ—äº”ï¼šKubevelaé›†æˆå¤šé›†ç¾¤OCM\\næœ¬ç« èŠ‚å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨ KubeVela åˆ†å‘å¤šé›†ç¾¤åº”ç”¨ã€‚\\n ç®€ä»‹\\nå¦‚ä»Šï¼Œåœ¨è¶Šæ¥è¶Šå¤šçš„åœºæ™¯ä¸‹ï¼Œå¼€å‘è€…å’Œç³»ç»Ÿè¿ç»´äººå‘˜å¼€å§‹å°†åº”ç”¨éƒ¨ç½²åœ¨å¤šä¸ªé›†ç¾¤ä¸­ï¼š\"}},{\"route\":\"/posts/kubevirt/hotplug-interface\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background2.jpg\",\"date\":\"2023-10-03 00:00:00\",\"tag\":[\"Kubevirt\",\"è™šæ‹Ÿæœº\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevirtç³»åˆ—ä¸€ï¼šè™šæ‹ŸæœºCentOS 7éƒ¨ç½²å®è·µ\",\"link\":\"/posts/kubevirt/quick-deploy-centos7\"},\"title\":\"Kubevirtç³»åˆ—äºŒï¼šè™šæ‹Ÿæœºç½‘å¡çƒ­æ’æ‹”\",\"description\":\"Kubevirtç³»åˆ—äºŒï¼šè™šæ‹Ÿæœºç½‘å¡çƒ­æ’æ‹”\\n è®¾è®¡åŠ¨æœº\\nå‘æ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœºçƒ­æ’æ‹”/çƒ­æ‹”å‡ºï¼ˆæ·»åŠ /åˆ é™¤ï¼‰NIC æ˜¯å¯ç”¨äºå¤šä¸ªå¹³å°çš„è¡Œä¸šæ ‡å‡†ï¼Œå…è®¸åŠ¨æ€è¿æ¥ L2 ç½‘ç»œã€‚ å½“å·¥ä½œè´Ÿè½½ (VM) åœ¨è¿æ¥/åˆ é™¤ç½‘\"}},{\"route\":\"/posts/kubevirt/quick-deploy-centos7\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/aliyun-image-source.png\",\"date\":\"2023-10-01 00:00:00\",\"tag\":[\"Kubevirt\",\"è™šæ‹Ÿæœº\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Kubevirtç³»åˆ—äºŒï¼šè™šæ‹Ÿæœºç½‘å¡çƒ­æ’æ‹”\",\"link\":\"/posts/kubevirt/hotplug-interface\"},\"title\":\"Kubevirtç³»åˆ—ä¸€ï¼šè™šæ‹ŸæœºCentOS 7éƒ¨ç½²å®è·µ\",\"description\":\"Kubevirtç³»åˆ—ä¸€ï¼šè™šæ‹ŸæœºCentOS 7éƒ¨ç½²å®è·µ\\nä¿—è¯è¯´ï¼Œå®è·µæ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†ï¼Œä¸å¦¨è®©æˆ‘ä»¬å°è¯•ç”¨kubeVirtéƒ¨ç½²ä¸€å°å±äºè‡ªå·±çš„è™šæ‹Ÿæœºå§~\\n å‡†å¤‡ç¯å¢ƒ\\né¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…`libvirt`\"}},{\"route\":\"/posts/learning-path\",\"meta\":{\"sidebar\":false,\"date\":\"2021-03-05 00:00:00\",\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background7.jpeg\",\"tags\":[\"å…¶å®ƒ\"],\"title\":\"å…³äºç ”ç©¶æŠ€æœ¯çš„æ€ç»´å’Œè§„åˆ’\",\"tag\":[\"å…¶å®ƒ\"],\"description\":\"å…³äºç ”ç©¶æŠ€æœ¯çš„æ€ç»´å’Œè§„åˆ’\\n ç ”ç©¶æŠ€æœ¯çš„æ€ç»´\\n ç ”ç©¶æ¯é¡¹æŠ€æœ¯çš„æ„ä¹‰\\nå½“æˆ‘æ¯æ¬¡ç ”ç©¶ä¸€é¡¹æ–°çš„æŠ€æœ¯çš„æ—¶å€™ï¼Œæˆ‘éƒ½ä¼šæ€è€ƒè¿™é¡¹æŠ€æœ¯çš„æ„ä¹‰ï¼š\\n- è¿™é¡¹æŠ€æœ¯çš„å‘å±•èƒŒæ™¯\\n- ä¸ºä»€ä¹ˆè¦å‘å±•è¿™é¡¹æŠ€æœ¯ï¼Ÿæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ\\n- è¿™é¡¹æŠ€\"}},{\"route\":\"/posts/linux/centos7-upgrade-to-stream9\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/algorithm-1.jpeg\",\"date\":\"2024-02-01 00:00:00\",\"tag\":[\"è™šæ‹Ÿæœº\",\"linux\"],\"title\":\"CentOS 7 å‡çº§è‡³ CentOS Stream 9 æ“ä½œæ•™ç¨‹\",\"description\":\"CentOS 7 å‡çº§è‡³ CentOS Stream 9 æ“ä½œæ•™ç¨‹\\næœ¬æ“ä½œæ•™ç¨‹ä»“åº“åœ°å€ï¼šhttps://github.com/hyperter96/OhMyStream9ï¼Œæ‰€æœ‰Shellè„šæœ¬åœ¨`scr\"}},{\"route\":\"/posts/linux/install-vm-centos-stream9\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/algorithm-1.jpeg\",\"date\":\"2024-02-07 00:00:00\",\"tag\":[\"è™šæ‹Ÿæœº\",\"linux\"],\"title\":\"VMwareå®‰è£…CentOS Stream 9\",\"description\":\"VMwareå®‰è£…CentOS Stream 9\\n ä¸‹è½½Linuxé•œåƒ\\nä¸‹è½½åœ°å€ï¼šcentos-stream-9-stream-BaseOS-x86_64-isoå®‰è£…åŒ…ä¸‹è½½_å¼€æºé•œåƒç«™-é˜¿é‡Œäº‘ (ali\"}},{\"route\":\"/posts/mysql/mysql-index\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/mysql-cover.jpg\",\"date\":\"2024-05-05 00:00:00\",\"sticky\":1,\"tags\":[\"kubernetes\",\"MySQL\"],\"prev\":{\"text\":\"MySQLçŸ¥è¯†ç³»åˆ—ä¸€ï¼šMySQLæ¶æ„å›¾\",\"link\":\"/posts/mysql/mysql-infra\"},\"title\":\"MySQLçŸ¥è¯†ç³»åˆ—äºŒï¼šMySQLç´¢å¼•\",\"tag\":[\"kubernetes\",\"MySQL\"],\"description\":\"MySQLçŸ¥è¯†ç³»åˆ—äºŒï¼šMySQLç´¢å¼•\\nå­˜å‚¨å¼•æ“ä¸åº•å±‚å®ç°çš„æ•°æ®ç»“æ„\\n     \\næ•°æ®ç»“æ„ - ç´¢å¼•æ€ä¹ˆé€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ï¼Ÿä¸­åˆ†æè¿‡èƒ½ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ä¸»è¦æœ‰æ•£åˆ—è¡¨ï¼ˆHashè¡¨ï¼‰ã€çº¢é»‘æ ‘ã€è·³è¡¨ã€B+æ ‘ï¼ˆ\"}},{\"route\":\"/posts/mysql/mysql-infra\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/mysql-cover.jpg\",\"date\":\"2024-05-03 00:00:00\",\"sticky\":1,\"tags\":[\"kubernetes\",\"MySQL\"],\"next\":{\"text\":\"MySQLçŸ¥è¯†ç³»åˆ—äºŒï¼šMySQLç´¢å¼•\",\"link\":\"/posts/mysql/mysql-index\"},\"title\":\"MySQLçŸ¥è¯†ç³»åˆ—ä¸€ï¼šMySQLæ¶æ„å›¾\",\"tag\":[\"kubernetes\",\"MySQL\"],\"description\":\"MySQLçŸ¥è¯†ç³»åˆ—ä¸€ï¼šMySQLæ¶æ„å›¾\\nMysqlæœåŠ¡ç«¯æ¶æ„åˆ†ä¸ºServerå±‚å’Œå­˜å‚¨å¼•æ“å±‚ï¼ˆå¯æ’æ‹”å¼ï¼‰ï¼ŒServerå±‚ä¸»è¦åŒ…å«äº†è¿æ¥å™¨ã€ç¼“å­˜æ¨¡å—ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ï¼›å¯æ’æ‹”çš„å­˜å‚¨å¼•æ“ä¸»è¦æœ‰Inno\"}},{\"route\":\"/posts/programming/go/array-and-slices\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover1-slices.jpeg\",\"date\":\"2022-07-02 00:00:00\",\"tag\":[\"Go\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"next\":{\"text\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—äºŒ: åç¨‹\",\"link\":\"/posts/programming/go/goroutine\"},\"title\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸€: æ•°ç»„ä¸åˆ‡ç‰‡\",\"description\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸€: æ•°ç»„ä¸åˆ‡ç‰‡\\nè¿™ç¯‡æ–‡ç« æ€»ç»“äº† Go çš„çŸ¥è¯†ä½“ç³»æ•°ç»„ä¸åˆ‡ç‰‡ï¼ŒåŒ…æ‹¬å…¶ä¸­çš„åº•å±‚å®ç°ç­‰ç­‰ã€‚\\n:::warning æ³¨æ„\\nè¯´èµ· Golangï¼Œ å¤§å®¶éƒ½ä¼šç¬¬ä¸€æ—¶é—´æƒ³åˆ°é«˜å¹¶å‘å’Œ Golang \"}},{\"route\":\"/posts/programming/go/channel\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover1-slices.jpeg\",\"date\":\"2022-07-08 00:00:00\",\"tag\":[\"Go\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—å››ï¼šæ¥å£interface\",\"link\":\"/posts/programming/go/interface\"},\"next\":{\"text\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—å…­ï¼šäº’æ–¥é”mutex\",\"link\":\"/posts/programming/go/mutex\"},\"title\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—äº”ï¼šChannel\",\"description\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—äº”ï¼šChannel\\n ä»€ä¹ˆæ˜¯ channel ç®¡é“\\nå®ƒæ˜¯ä¸€ä¸ªæ•°æ®ç®¡é“ï¼Œå¯ä»¥å¾€é‡Œé¢å†™æ•°æ®ï¼Œä»é‡Œé¢è¯»æ•°æ®ã€‚\\nchannel æ˜¯ goroutine ä¹‹é—´æ•°æ®é€šä¿¡æ¡¥æ¢ï¼Œè€Œä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\\n\"}},{\"route\":\"/posts/programming/go/client-go/api-machinery\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg\",\"author\":\"ç†¬å°å‰‘\",\"date\":\"2023-01-12 00:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"prev\":{\"text\":\"Client-goç³»åˆ—å››: Informerå®æˆ˜\",\"link\":\"/posts/programming/go/client-go/informer-exercise\"},\"next\":{\"text\":\"Client-goç³»åˆ—å…­ï¼šClient-goç±»åº“ï¼ˆä¸Šï¼‰\",\"link\":\"/posts/programming/go/client-go/client-go-pkg-part1\"},\"title\":\"Client-goç³»åˆ—äº”ï¼šAPI Machinery\",\"description\":\"Client-goç³»åˆ—äº”ï¼šAPI Machinery\\næœ¬ç« æ¢è®¨äº† Kubernetes API Machineryï¼Œå®ƒæä¾›äº†ç”¨äºå¤„ç†éµå¾ª Kubernetes API å¯¹è±¡çº¦å®šçš„APIå¯¹è±¡çš„å®ç”¨å·¥å…·ã€‚\"}},{\"route\":\"/posts/programming/go/client-go/client-go-pkg-part1\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg\",\"author\":\"ç†¬å°å‰‘\",\"date\":\"2023-01-21 00:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"prev\":{\"text\":\"Client-goç³»åˆ—äº”ï¼šAPI Machinery\",\"link\":\"/posts/programming/go/client-go/api-machinery\"},\"next\":{\"text\":\"Client-goç³»åˆ—ä¸ƒï¼šClient-goç±»åº“ï¼ˆä¸‹ï¼‰\",\"link\":\"/posts/programming/go/client-go/client-go-pkg-part2\"},\"title\":\"Client-goç³»åˆ—å…­ï¼šClient-goç±»åº“ï¼ˆä¸Šï¼‰\",\"description\":\"Client-goç³»åˆ—å…­ï¼šClient-goç±»åº“ï¼ˆä¸Šï¼‰\\næœ¬ç« æ¢è®¨äº† Client-go åº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªé«˜çº§åˆ«åº“ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨ Go è¯­è¨€ä¸ Kubernetes API è¿›è¡Œäº¤äº’ã€‚Client-go \"}},{\"route\":\"/posts/programming/go/client-go/client-go-pkg-part2\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg\",\"author\":\"ç†¬å°å‰‘\",\"date\":\"2023-01-25 00:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"prev\":{\"text\":\"Client-goç³»åˆ—å…­ï¼šClient-goç±»åº“ï¼ˆä¸Šï¼‰\",\"link\":\"/posts/programming/go/client-go/client-go-pkg-part1\"},\"title\":\"Client-goç³»åˆ—ä¸ƒï¼šClient-goç±»åº“ï¼ˆä¸‹ï¼‰\",\"description\":\"Client-goç³»åˆ—ä¸ƒï¼šClient-goç±»åº“ï¼ˆä¸‹ï¼‰\\n åˆ é™¤èµ„æº\\nè¦ä»é›†ç¾¤ä¸­åˆ é™¤èµ„æºï¼Œå¯ä»¥å¯¹ä½ è¦åˆ é™¤çš„èµ„æºä½¿ç”¨åˆ é™¤æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œè¦ä» `project1` å‘½åç©ºé—´ä¸­åˆ é™¤ä¸€ä¸ªåä¸º `nginx-pod\"}},{\"route\":\"/posts/programming/go/client-go/clientset\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg\",\"date\":\"2022-12-22 00:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"prev\":{\"text\":\"Client-goç³»åˆ—ä¸€: Client-goçŸ¥è¯†ä½“ç³»\",\"link\":\"/posts/programming/go/client-go/intro\"},\"next\":{\"text\":\"Client-goç³»åˆ—ä¸‰ï¼šè®¤è¯†Informer\",\"link\":\"/posts/programming/go/client-go/informer\"},\"title\":\"Client-goç³»åˆ—äºŒ: è®¤è¯†ClientSet\",\"description\":\"Client-goç³»åˆ—äºŒ: è®¤è¯†ClientSet\\n\\n ClientSet ç®€ä»‹\\n`ClientSet`ä½¿ç”¨é¢„ç”Ÿæˆçš„ API å¯¹è±¡æ¥ä¸ kube-apiserver è¿›è¡Œäº¤äº’ï¼Œç±»ä¼¼äº RPC çš„å˜æˆä½“\"}},{\"route\":\"/posts/programming/go/client-go/informer-exercise\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg\",\"date\":\"2023-01-07 00:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"prev\":{\"text\":\"Client-goç³»åˆ—ä¸‰: è®¤è¯†Informer\",\"link\":\"/posts/programming/go/client-go/informer\"},\"next\":{\"text\":\"Client-goç³»åˆ—äº”ï¼šAPI Machinery\",\"link\":\"/posts/programming/go/client-go/api-machinery\"},\"title\":\"Client-goç³»åˆ—å››ï¼šInformerå®æˆ˜\",\"description\":\"Client-goç³»åˆ—å››ï¼šInformerå®æˆ˜\\nåˆ©ç”¨ `Informer` æœºåˆ¶æ¥å¼€å‘ä¸€ä¸ªç®€å•çš„ `controller` æ¥æ¸…ç† kubernetes é›†ç¾¤å†…å¼‚å¸¸çŠ¶æ€çš„ pod .\\n èƒŒæ™¯\\nå¹³æ—¶ k\"}},{\"route\":\"/posts/programming/go/client-go/informer\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg\",\"date\":\"2022-12-25 00:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"prev\":{\"text\":\"Client-goç³»åˆ—äºŒ: è®¤è¯†ClientSet\",\"link\":\"/posts/programming/go/client-go/clientset\"},\"next\":{\"text\":\"Client-goç³»åˆ—å››ï¼šInformerå®æˆ˜\",\"link\":\"/posts/programming/go/client-go/informer-exercise\"},\"title\":\"Client-goç³»åˆ—ä¸‰ï¼šè®¤è¯†Informer\",\"description\":\"Client-goç³»åˆ—ä¸‰ï¼šè®¤è¯†Informer\\nInformer å¯¹äºå®ç° kubernetes çš„ `controller` æ¨¡å¼éå¸¸é‡è¦.\\n Informer ç®€ä»‹\\n\\n&gt;\\n&gt; è¿™æ˜¾ç„¶æ˜¯\"}},{\"route\":\"/posts/programming/go/client-go/intro\",\"meta\":{\"sidebar\":false,\"date\":\"2022-10-02 00:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"next\":{\"text\":\"Client-goç³»åˆ—äºŒ: è®¤è¯†ClientSet\",\"link\":\"/posts/programming/go/client-go/clientset\"},\"title\":\"Client-goç³»åˆ—ä¸€ï¼šClient-goçŸ¥è¯†ä½“ç³»\",\"description\":\"Client-goç³»åˆ—ä¸€ï¼šClient-goçŸ¥è¯†ä½“ç³»\\nåˆæ­¥è®¤è¯† Client-go ä¸»ä½“æ¡†æ¶.\\n å…³äºclient-go\\n`client-go`æ˜¯kuberneteså®˜æ–¹æä¾›çš„goè¯­è¨€çš„å®¢æˆ·ç«¯åº“ï¼Œgo\",\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-image.png\"}},{\"route\":\"/posts/programming/go/defer\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover1-slices.jpeg\",\"date\":\"2022-07-13 00:00:00\",\"tag\":[\"Go\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—å…­ï¼šäº’æ–¥é”mutex\",\"link\":\"/posts/programming/go/mutex\"},\"title\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸ƒï¼šå»¶è¿Ÿå‡½æ•°è°ƒç”¨Defer\",\"description\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸ƒï¼šå»¶è¿Ÿå‡½æ•°è°ƒç”¨Defer\\n`defer`è¯­å¥ç”¨äºå»¶è¿Ÿå‡½æ•°çš„è°ƒç”¨ï¼Œæ¯æ¬¡`defer`éƒ½ä¼šæŠŠä¸€ä¸ªå‡½æ•°å‹å…¥æ ˆä¸­ï¼Œå‡½æ•°è¿”å›å‰å†æŠŠå»¶è¿Ÿçš„å‡½æ•°å–å‡ºå¹¶æ‰§è¡Œã€‚\\nä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬æŠŠåˆ›å»º`defer\"}},{\"route\":\"/posts/programming/go/goroutine\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover2-goroutine.jpeg\",\"date\":\"2022-07-03 00:00:00\",\"tag\":[\"Go\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸€: æ•°ç»„ä¸åˆ‡ç‰‡\",\"link\":\"/posts/programming/go/array-and-slices\"},\"next\":{\"text\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰: ç­‰å¾…ç»„waitGroup\",\"link\":\"/posts/programming/go/waitgroup\"},\"title\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—äºŒ: åç¨‹\",\"description\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—äºŒ: åç¨‹\\nè¿™ç¯‡æ–‡ç« æ€»ç»“äº† Go çš„çŸ¥è¯†ä½“ç³»ï¼šåç¨‹ï¼ŒåŒ…æ‹¬å…¶ä¸­çš„åº•å±‚å®ç°ç­‰ç­‰ã€‚\\n åç¨‹(coroutine)\\nåœ¨è®² goroutine ä¹‹å‰è®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹åç¨‹ (coroutine)\"}},{\"route\":\"/posts/programming/go/interface\",\"meta\":{\"sidebar\":false,\"cover\":\"https://hyper2t.github.io/interface/featured-image.jpeg\",\"date\":\"2022-07-06 00:00:00\",\"tag\":[\"Go\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰: ç­‰å¾…ç»„waitGroup\",\"link\":\"/posts/programming/go/waitgroup\"},\"next\":{\"text\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—äº”ï¼šChannel\",\"link\":\"/posts/programming/go/channel\"},\"title\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—å››ï¼šæ¥å£interface\",\"description\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—å››ï¼šæ¥å£interface\\nè¿™ç¯‡æ–‡ç« æ€»ç»“äº† Golang çš„çŸ¥è¯†ä½“ç³»: `interface`ï¼ŒåŒ…æ‹¬å…¶ä¸­çš„åº•å±‚å®ç°ç­‰ç­‰ã€‚\\n:::warning æ³¨æ„ğŸ“¢ï¼š\\nè¯´èµ· Golangï¼Œ å¤§å®¶\"}},{\"route\":\"/posts/programming/go/mutex\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover1-slices.jpeg\",\"date\":\"2022-07-10 00:00:00\",\"tag\":[\"Go\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—äº”ï¼šChannel\",\"link\":\"/posts/programming/go/channel\"},\"next\":{\"text\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸ƒï¼šå»¶è¿Ÿå‡½æ•°è°ƒç”¨Defer\",\"link\":\"/posts/programming/go/defer\"},\"title\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—å…­ï¼šäº’æ–¥é”mutex\",\"description\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—å…­ï¼šäº’æ–¥é”mutex\\n `sync.Mutex` äº’æ–¥é”\\n`sync.Mutex` æ˜¯ä¸€ä¸ªäº’æ–¥é”ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ä¿æŠ¤ä¸´ç•ŒåŒºï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ª Go åç¨‹è¿›å…¥ä¸´ç•ŒåŒºã€‚\\nä»€ä¹ˆæ˜¯ä¸´ç•ŒåŒºï¼Ÿ\"}},{\"route\":\"/posts/programming/go/waitgroup\",\"meta\":{\"sidebar\":false,\"cover\":\"https://hyper2t.github.io/waitgroup/featured-image.jpeg\",\"date\":\"2022-07-04 00:00:00\",\"tag\":[\"Go\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—äºŒ: åç¨‹\",\"link\":\"/posts/programming/go/goroutine\"},\"next\":{\"text\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—å››ï¼šæ¥å£interface\",\"link\":\"/posts/programming/go/interface\"},\"title\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰: ç­‰å¾…ç»„waitGroup\",\"description\":\"Go åŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰: ç­‰å¾…ç»„waitGroup\\nè¿™ç¯‡æ–‡ç« æ€»ç»“äº† Golang çš„çŸ¥è¯†ä½“ç³»: `waitGroup`ï¼ŒåŒ…æ‹¬å…¶ä¸­çš„åº•å±‚å®ç°ç­‰ç­‰ã€‚\\nå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ­£éœ€è¦çŸ¥é“ `goroutine` æ˜¯å¦\"}},{\"route\":\"/posts/programming/rust/borrowing\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover8.jpg\",\"date\":\"2023-11-09 00:00:00\",\"tag\":[\"Rust\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸ƒï¼šæ‰€æœ‰æƒ\",\"link\":\"/posts/programming/rust/ownership\"},\"title\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—å…«ï¼šå¼•ç”¨ä¸å€Ÿç”¨\",\"description\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—å…«ï¼šå¼•ç”¨ä¸å€Ÿç”¨\\nä¸ŠèŠ‚ä¸­æåˆ°ï¼Œå¦‚æœä»…ä»…æ”¯æŒé€šè¿‡è½¬ç§»æ‰€æœ‰æƒçš„æ–¹å¼è·å–ä¸€ä¸ªå€¼ï¼Œé‚£ä¼šè®©ç¨‹åºå˜å¾—å¤æ‚ã€‚ Rust èƒ½å¦åƒå…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œä½¿ç”¨æŸä¸ªå˜é‡çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥ã€‚\\nRust\"}},{\"route\":\"/posts/programming/rust/disable-warning\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background3.jpeg\",\"date\":\"2023-11-01 00:00:00\",\"tag\":[\"Rust\",\"ç¼–ç¨‹åŸºç¡€\"],\"title\":\"å¦‚ä½•åœ¨Rustç¤ºä¾‹ä¸­ç¦ç”¨æœªä½¿ç”¨çš„ä»£ç è­¦å‘Š\",\"description\":\"å¦‚ä½•åœ¨Rustç¤ºä¾‹ä¸­ç¦ç”¨æœªä½¿ç”¨çš„ä»£ç è­¦å‘Š\\n é”™è¯¯æç¤º\\nåœ¨Rustä»£ç ä¸­ï¼Œæœ‰æ—¶ä½ å£°æ˜äº†ä¸€ä¸ªå˜é‡ã€ç±»å‹æˆ–å®šä¹‰äº†ä¸€äº›ä¸œè¥¿ï¼Œä½†åœ¨ä»£ç ä¸­ä»æœªä½¿ç”¨è¿‡ï¼Œè¿™æ—¶å°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚\\næ¯”å¦‚è¯´ã€‚\\nä½ å£°æ˜äº†ä¸€ä¸ªç»“æ„ä½“ï¼Œä½†ä»æœªæ„\"}},{\"route\":\"/posts/programming/rust/fundamental-type\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover3.jpg\",\"date\":\"2023-11-04 00:00:00\",\"tag\":[\"Rust\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—äºŒï¼šè¯­å¥ã€è¡¨è¾¾å¼ã€æ ¼å¼åŒ–è¾“å‡º\",\"link\":\"/posts/programming/rust/statement-expr-print\"},\"next\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—å››ï¼šå˜é‡ç»‘å®š\",\"link\":\"/posts/programming/rust/variable-bindings\"},\"title\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰ï¼šæ•°æ®åŸºç¡€ç±»å‹\",\"description\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰ï¼šæ•°æ®åŸºç¡€ç±»å‹\\n æ•°ç»„å’Œåˆ‡ç‰‡\\næ•°ç»„ï¼ˆarrayï¼‰æ˜¯ä¸€ç»„æ‹¥æœ‰ç›¸åŒç±»å‹ T çš„å¯¹è±¡çš„é›†åˆï¼Œåœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„ã€‚æ•°ç»„ä½¿ç”¨ä¸­æ‹¬å· `[]` æ¥åˆ›å»ºï¼Œä¸”å®ƒä»¬çš„å¤§å°åœ¨ç¼–è¯‘æ—¶ä¼šè¢«ç¡®å®šã€‚æ•°ç»„çš„\"}},{\"route\":\"/posts/programming/rust/get-to-know-cargo\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover.png\",\"date\":\"2023-11-02 00:00:00\",\"tag\":[\"Rust\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"next\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—äºŒï¼šè¯­å¥ã€è¡¨è¾¾å¼ã€æ ¼å¼åŒ–è¾“å‡º\",\"link\":\"/posts/programming/rust/statement-expr-print\"},\"title\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸€ï¼šè®¤è¯†Cargo\",\"description\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸€ï¼šè®¤è¯†Cargo\\nä½œä¸ºä¸€é—¨ç°ä»£åŒ–è¯­è¨€ï¼ŒRust å¸æ”¶äº†å¤šä¸ªè¯­è¨€çš„åŒ…ç®¡ç†ä¼˜ç‚¹ï¼Œä¸ºå¤§å®¶æä¾›è¶…çº§å¤§æ€å™¨ï¼š `cargo`ï¼ŒçœŸçš„ï¼Œå†æŒ‘å‰”çš„å¼€å‘è€…ï¼Œéƒ½å¯¹å®ƒèµä¸ç»å£ã€‚ğŸ‘\\næ€»è€Œè¨€ä¹‹ï¼Œ`car\"}},{\"route\":\"/posts/programming/rust/ownership\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover7.jpg\",\"date\":\"2023-11-08 00:00:00\",\"tag\":[\"Rust\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—å…­ï¼šå‡½æ•°\",\"link\":\"/posts/programming/rust/rust-function\"},\"next\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—å…«ï¼šå¼•ç”¨ä¸å€Ÿç”¨\",\"link\":\"/posts/programming/rust/borrowing\"},\"title\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸ƒï¼šæ‰€æœ‰æƒ\",\"description\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸ƒï¼šæ‰€æœ‰æƒ\\næ‰€æœ‰çš„ç¨‹åºéƒ½å¿…é¡»å’Œè®¡ç®—æœºå†…å­˜æ‰“äº¤é“ï¼Œå¦‚ä½•ä»å†…å­˜ä¸­ç”³è¯·ç©ºé—´æ¥å­˜æ”¾ç¨‹åºçš„è¿è¡Œå†…å®¹ï¼Œå¦‚ä½•åœ¨ä¸éœ€è¦çš„æ—¶å€™é‡Šæ”¾è¿™äº›ç©ºé—´ï¼Œæˆäº†é‡ä¸­ä¹‹é‡ï¼Œä¹Ÿæ˜¯æ‰€æœ‰ç¼–ç¨‹è¯­è¨€è®¾è®¡çš„éš¾ç‚¹ä¹‹ä¸€ã€‚åœ¨è®¡ç®—æœºè¯­è¨€\"}},{\"route\":\"/posts/programming/rust/rust-function\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover6.jpeg\",\"date\":\"2023-11-07 00:00:00\",\"tag\":[\"Rust\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—äº”ï¼šç±»å‹ç³»ç»Ÿ\",\"link\":\"/posts/programming/rust/types-system\"},\"next\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸ƒï¼šæ‰€æœ‰æƒ\",\"link\":\"/posts/programming/rust/ownership\"},\"title\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—å…­ï¼šå‡½æ•°\",\"description\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—å…­ï¼šå‡½æ•°\\nRust çš„å‡½æ•°æˆ‘ä»¬åœ¨ä¹‹å‰å·²ç»è§è¿‡ä¸å°‘ï¼Œè·Ÿå…¶ä»–è¯­è¨€å‡ ä¹æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚å› æ­¤æœ¬ç« çš„å­¦ä¹ ä¹‹è·¯å°†è½»æ¾å’Œæ„‰å¿«ï¼Œéªšå¹´ä»¬ï¼Œè¯·çæƒœè¿™ç§æ„‰å¿«ï¼Œä¸‹ä¸€ç« ä½ å°†ä½“éªŒåˆ°ä¸ä¸€æ ·çš„ Rustã€‚\\nåœ¨å‡½æ•°ç•Œ\"}},{\"route\":\"/posts/programming/rust/statement-expr-print\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover2.png\",\"date\":\"2023-11-03 00:00:00\",\"tag\":[\"Rust\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸€ï¼šè®¤è¯†Cargo\",\"link\":\"/posts/programming/rust/get-to-know-cargo\"},\"next\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰ï¼šæ•°æ®åŸºç¡€ç±»å‹\",\"link\":\"/posts/programming/rust/fundamental-type\"},\"title\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—äºŒï¼šè¯­å¥ã€è¡¨è¾¾å¼ã€æ ¼å¼åŒ–è¾“å‡º\",\"description\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—äºŒï¼šè¯­å¥ã€è¡¨è¾¾å¼ã€æ ¼å¼åŒ–è¾“å‡º\\nRust çš„å‡½æ•°ä½“æ˜¯ç”±ä¸€ç³»åˆ—è¯­å¥ç»„æˆï¼Œæœ€åç”±ä¸€ä¸ªè¡¨è¾¾å¼æ¥è¿”å›å€¼ï¼Œä¾‹å¦‚ï¼š\\n```rust\\nfn add_with_extra(x: i32, y: i3\"}},{\"route\":\"/posts/programming/rust/types-system\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover5.jpg\",\"date\":\"2023-11-06 00:00:00\",\"tag\":[\"Rust\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—å››ï¼šå˜é‡ç»‘å®š\",\"link\":\"/posts/programming/rust/variable-bindings\"},\"next\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—å…­ï¼šå‡½æ•°\",\"link\":\"/posts/programming/rust/rust-function\"},\"title\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—äº”ï¼šç±»å‹ç³»ç»Ÿ\",\"description\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—äº”ï¼šç±»å‹ç³»ç»Ÿ\\nRust æä¾›äº†å¤šç§æœºåˆ¶ï¼Œç”¨äºæ”¹å˜æˆ–å®šä¹‰åŸç”Ÿç±»å‹å’Œç”¨æˆ·å®šä¹‰ç±»å‹ã€‚æ¥ä¸‹æ¥ä¼šè®²åˆ°ï¼š\\n- åŸç”Ÿç±»å‹çš„ç±»å‹è½¬æ¢ï¼ˆcastï¼‰ã€‚\\n- æŒ‡å®šå­—é¢é‡çš„ç±»å‹ã€‚\\n- ä½¿ç”¨ç±»å‹æ¨æ–­ï¼ˆtyp\"}},{\"route\":\"/posts/programming/rust/variable-bindings\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover4.jpg\",\"date\":\"2023-11-05 00:00:00\",\"tag\":[\"Rust\",\"ç¼–ç¨‹åŸºç¡€\"],\"sticky\":1,\"prev\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—ä¸‰ï¼šæ•°æ®åŸºç¡€ç±»å‹\",\"link\":\"/posts/programming/rust/fundamental-type\"},\"next\":{\"text\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—äº”ï¼šç±»å‹ç³»ç»Ÿ\",\"link\":\"/posts/programming/rust/types-system\"},\"title\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—å››ï¼šå˜é‡ç»‘å®š\",\"description\":\"RuståŸºç¡€çŸ¥è¯†ç³»åˆ—å››ï¼šå˜é‡ç»‘å®š\\nRust é€šè¿‡é™æ€ç±»å‹ç¡®ä¿ç±»å‹å®‰å…¨ã€‚å˜é‡ç»‘å®šå¯ä»¥åœ¨å£°æ˜æ—¶è¯´æ˜ç±»å‹ï¼Œä¸è¿‡åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨èƒ½å¤Ÿä»ä¸Šä¸‹æ–‡æ¨å¯¼å‡ºå˜é‡çš„ç±»å‹ï¼Œä»è€Œå¤§å¤§å‡å°‘äº†ç±»å‹è¯´æ˜çš„å·¥ä½œã€‚\\nä½¿ç”¨ `let\"}},{\"route\":\"/posts/programming/webassembly/run-wasm-app-from-host\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-and-wasm-cover.png\",\"date\":\"2024-03-11 00:00:00\",\"tag\":[\"Rust\",\"WebAssembly\",\"å…¨æ ˆå¼€å‘\"],\"sticky\":1,\"prev\":{\"text\":\"WebAssemblyç³»åˆ—ä¸€ï¼šRust Web å…¨æ ˆå¼€å‘ä¹‹ç¼–å†™ WebAssembly åº”ç”¨\",\"link\":\"/posts/programming/webassembly/webassembly-full-stack-app\"},\"title\":\"WebAssemblyç³»åˆ—äºŒï¼šä½¿ç”¨ WasmEdge Rust SDK æ„å»ºå¹¶è¿è¡Œ WebAssembly åº”ç”¨ç¨‹åº\",\"description\":\"WebAssemblyç³»åˆ—äºŒï¼šä½¿ç”¨ WasmEdge Rust SDK æ„å»ºå¹¶è¿è¡Œ WebAssembly åº”ç”¨ç¨‹åº\\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åˆ›å»º WebAssembly åº”ç”¨ç¨‹åº[^wasm]ï¼ˆä¹Ÿæ˜¯\"}},{\"route\":\"/posts/programming/webassembly/webassembly-full-stack-app\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-and-wasm-cover.png\",\"date\":\"2024-03-02 00:00:00\",\"tag\":[\"Rust\",\"WebAssembly\",\"å…¨æ ˆå¼€å‘\"],\"sticky\":1,\"next\":{\"text\":\"WebAssemblyç³»åˆ—äºŒï¼šä½¿ç”¨ WasmEdge Rust SDK æ„å»ºå¹¶è¿è¡Œ WebAssembly åº”ç”¨ç¨‹åº\",\"link\":\"/posts/programming/webassembly/run-wasm-app-from-host\"},\"title\":\"WebAssemblyç³»åˆ—ä¸€ï¼šRust Web å…¨æ ˆå¼€å‘ä¹‹ç¼–å†™ WebAssembly åº”ç”¨\",\"description\":\"WebAssemblyç³»åˆ—ä¸€ï¼šRust Web å…¨æ ˆå¼€å‘ä¹‹ç¼–å†™ WebAssembly åº”ç”¨\\n WebAssemblyä»‹ç»\\n ä»€ä¹ˆæ˜¯ WebAssemblyï¼Ÿ\\nWebAssembly æ˜¯ä¸€ç§æ–°çš„ç¼–ç æ–¹\"}},{\"route\":\"/posts/quantum/ph219-lecture1\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/quantum_computing_future.jpg\",\"date\":\"2025-02-07 00:00:00\",\"tag\":[\"é‡å­è®¡ç®—\"],\"sticky\":1,\"title\":\"é‡å­è®¡ç®—è¯¾ç¨‹Ph219ç¬¬ä¸€è®²-é‡å­ç³»ç»Ÿä»‹ç»\",\"description\":\"é‡å­è®¡ç®—è¯¾ç¨‹Ph219ç¬¬ä¸€è®²-é‡å­ç³»ç»Ÿä»‹ç»\\n æµ‹é‡å’Œåç¼©\\nè–›å®šè°”å®£ç§°ï¼Œä¸æ‰“å¼€ç›’å­ï¼ŒçŒ«å°±å¤„äºç”Ÿå’Œæ­»çš„â€œå åŠ æ€â€ï¼Œåˆç§°ï¼šâ€œå½“æˆ‘ä»¬æ‰“å¼€ç›’å­ï¼Œç»è¿‡äº†æˆ‘ä»¬çš„è§‚å¯Ÿï¼ŒçŒ«å°±ä¼šåç¼©åˆ°ä¸€ä¸ªç¡®å®šçš„ç”Ÿã€æ­»çŠ¶æ€ä¸Šâ€ã€‚\\nä»€ä¹ˆå«åš\"}},{\"route\":\"/posts/troubleshooting/k8s-pod-abnormal-analysis\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/k8s-2.jpeg\",\"categories\":[\"kubernetes\"],\"date\":\"2023-05-06 11:45:56\",\"tags\":[\"kubernetes\",\"æ•…éšœåˆ†æ\"],\"title\":\"K8Sæ•…éšœåˆ†æç³»åˆ—ä¸€ï¼šåŸºäºçœŸå®åœºæ™¯è§£è¯»K8S_Podçš„å„ç§å¼‚å¸¸\",\"tag\":[\"kubernetes\",\"æ•…éšœåˆ†æ\"],\"description\":\"K8Sæ•…éšœåˆ†æç³»åˆ—ä¸€ï¼šåŸºäºçœŸå®åœºæ™¯è§£è¯»K8S_Podçš„å„ç§å¼‚å¸¸\\n Pod ç”Ÿå‘½å‘¨æœŸ\\nåœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒPod ä¼šå‡ºç° 5 ç§é˜¶æ®µï¼ˆPhaseï¼‰ã€‚\\n- Pendingï¼šPod è¢« K8s åˆ›å»ºå‡ºæ¥åï¼Œèµ·\"}},{\"route\":\"/posts/velero/intro-and-practice\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/velero-cover.png\",\"date\":\"2024-01-05 00:00:00\",\"tag\":[\"Velero\",\"å¤‡ä»½æ¢å¤\",\"kubernetes\"],\"sticky\":1,\"title\":\"åˆ©ç”¨Veleroå¯¹K8Så¤‡ä»½è¿˜åŸä¸é›†ç¾¤è¿ç§»å®æˆ˜\",\"description\":\"åˆ©ç”¨Veleroå¯¹K8Så¤‡ä»½è¿˜åŸä¸é›†ç¾¤è¿ç§»å®æˆ˜\\n ç®€ä»‹\\nVelero æ˜¯ä¸€æ¬¾äº‘åŸç”Ÿæ—¶ä»£çš„ç¾éš¾æ¢å¤å’Œè¿ç§»å·¥å…·ï¼Œé‡‡ç”¨ Go è¯­è¨€ç¼–å†™ï¼Œå¹¶åœ¨ github ä¸Šè¿›è¡Œäº†å¼€æºï¼Œåˆ©ç”¨ velero ç”¨æˆ·å¯ä»¥å®‰å…¨çš„å¤‡\"}}],\"footer\":{\"copyright\":\"MIT License | çš®ç‰¹á´¾áµ—\"},\"themeColor\":\"vp-green\",\"author\":\"çš®ç‰¹á´¾áµ—\",\"friend\":[{\"nickname\":\"çš®ç‰¹á´¾áµ—\",\"des\":\"ä½ çš„æŒ‡å°–ç”¨äºæ”¹å˜ä¸–ç•Œçš„åŠ›é‡\",\"avatar\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog@gh-pages/selfie.jpeg\",\"url\":\"https://cs.hyperter.top\"},{\"nickname\":\"æ„ç¦è¡Œ\",\"des\":\"æŒ‡æœˆå°ç­‘(æ¢ç´¢äº‘åŸç”Ÿ)\",\"avatar\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/yiqixing.jpg\",\"url\":\"https://www.lixueduan.com/\"},{\"nickname\":\"ç†¬å°å‰‘\",\"des\":\"Service Meshå¸ƒé“å¸ˆ, äº‘åŸç”Ÿå¸ƒé“å¸ˆ, Dapr Approver\",\"avatar\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/skyao.png\",\"url\":\"https://skyao.io/\"},{\"nickname\":\"åŸå­ä¹‹éŸ³\",\"des\":\"C++ Rust Unrealå¤§å®¶åŠ æ²¹\",\"avatar\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/yuanZiZhiYin.jpg\",\"url\":\"https://space.bilibili.com/437860379\"}],\"comment\":{\"repo\":\"hyperter96/tech-blog\",\"repoId\":\"R_kgDOLckbDg\",\"category\":\"General\",\"categoryId\":\"DIC_kwDOLckbDs4CdyEa\",\"label\":\"è¯„è®º\",\"icon\":\"<svg enable-background=\\\"new 0 0 512 512\\\" height=\\\"512px\\\" id=\\\"Layer_1\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 512 512\\\" width=\\\"512px\\\" xml:space=\\\"preserve\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\"><path d=\\\"M170.476,166.19h155.097c4.285,0,7.76-3.469,7.76-7.754s-3.475-7.765-7.76-7.765H170.476c-4.285,0-7.754,3.48-7.754,7.765  S166.191,166.19,170.476,166.19z\\\"/><path d=\\\"M348.088,203.362H202.74c-4.284,0-7.759,3.469-7.759,7.754s3.475,7.765,7.759,7.765h145.348c4.284,0,7.754-3.48,7.754-7.765  S352.372,203.362,348.088,203.362z\\\"/><path d=\\\"M306.695,256.052H170.476c-4.285,0-7.754,3.469-7.754,7.754c0,4.284,3.469,7.754,7.754,7.754h136.219  c4.279,0,7.754-3.47,7.754-7.754C314.448,259.521,310.974,256.052,306.695,256.052z\\\"/><path d=\\\"M396.776,86.288H115.225c-29.992,0-54.403,22.562-54.403,50.308v154.83c0,27.735,24.411,50.297,54.403,50.297h166.034  l119.812,83.989v-84.135c27.996-2.038,50.108-23.753,50.108-50.151v-154.83C451.179,108.85,426.768,86.288,396.776,86.288z   M427.906,291.426c0,14.902-13.972,27.025-31.131,27.025h-18.978v62.523l-89.193-62.523h-173.38  c-17.164,0-31.131-12.123-31.131-27.025v-154.83c0-14.913,13.967-27.035,31.131-27.035h281.551  c17.159,0,31.131,12.123,31.131,27.035V291.426z\\\"/></svg>\",\"mobileMinify\":false,\"inputPosition\":\"bottom\",\"lang\":\"zh-CN\",\"mapping\":\"pathname\"},\"hotArticle\":{\"title\":\"ğŸ”¥ ç²¾é€‰æ–‡ç« \",\"nextText\":\"æ¢ä¸€ç»„\",\"pageSize\":3,\"empty\":\"æš‚æ— ç²¾é€‰å†…å®¹\"},\"popover\":{\"title\":\"å…¬å‘Š\",\"mobileMinify\":true,\"body\":[{\"type\":\"text\",\"content\":\"ğŸ‘‡å¾®ä¿¡æ‰«ç æ·»åŠ å¥½å‹ğŸ‘‡\"},{\"type\":\"image\",\"src\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/qrcode3.png\"},{\"type\":\"button\",\"content\":\"äº‘åŸç”Ÿæ–‡æ¡£\",\"link\":\"https://ikubevirt.cn\"},{\"type\":\"button\",\"content\":\"ç”Ÿæ´»åšå®¢\",\"props\":{\"type\":\"success\"},\"link\":\"https://life.hyperter.top\"}],\"duration\":-1},\"buttonAfterArticle\":{\"openTitle\":\"æŠ•å¸\",\"closeTitle\":\"ä¸‹æ¬¡ä¸€å®š\",\"content\":\"<img src=\\\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/wechatpay-code.jpg\\\">\",\"icon\":\"wechatPay\"},\"mermaid\":true},\"sidebar\":[{\"text\":\"\",\"items\":[]}],\"outline\":{\"level\":[2,3],\"label\":\"ç›®å½•\"},\"returnToTopLabel\":\"å›åˆ°é¡¶éƒ¨\",\"sidebarMenuLabel\":\"ç›¸å…³æ–‡ç« \",\"lastUpdatedText\":\"ä¸Šæ¬¡æ›´æ–°äº\",\"logo\":\"/favicon.ico\",\"editLink\":{\"pattern\":\"https://github.com/hyperter96/tech-blog/tree/main/docs/:path\",\"text\":\"å» GitHub ä¸Šç¼–è¾‘å†…å®¹\"},\"nav\":[{\"text\":\"é¦–é¡µ\",\"link\":\"/\"},{\"text\":\"é¢è¯•\",\"items\":[{\"text\":\"TCPç¯‡\",\"link\":\"/posts/interview/tcp.html\"}]},{\"text\":\"è¶£å‘³\",\"items\":[{\"text\":\"é€®ä½é‚£åªçŒ«ï¼\",\"link\":\"/fun/catch-the-cat.html\"}]},{\"text\":\"å…³äºæˆ‘\",\"link\":\"/aboutme.html\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/hyperter96/tech-blog\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>