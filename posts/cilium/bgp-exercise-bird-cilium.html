<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cilium系列二：使用bird和cilium部署BGP模式的k8s集群 | 皮特ᴾᵗ的博客技术站</title>
    <meta name="description" content="热衷于云原生技术，一直为实现自我价值而执着！">
    <meta name="generator" content="VitePress v1.0.2">
    <link rel="preload stylesheet" href="/assets/style.Yojh31EL.css" as="style">
    
    <script type="module" src="/assets/app.C5fS_3C9.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Bu8hRsVA.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework._Kr-eMMD.js">
    <link rel="modulepreload" href="/assets/chunks/theme.AIOLJGva.js">
    <link rel="modulepreload" href="/assets/posts_cilium_bgp-exercise-bird-cilium.md.BeuDvBX4.lean.js">
    <link rel="icon" href="/favicon.ico">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <script>import("/pagefind/pagefind.js").then(i=>{window.__pagefind__=i,i.init()}).catch(()=>{});</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-cec16fd8 data-v-0ee98b82><!--[--><!--[--><!--]--><!----><!--[--><div style="display:none;" class="theme-blog-popover" data-pagefind-ignore="all" data-v-c4131e1b><div class="header" data-v-c4131e1b><div class="title-wrapper" data-v-c4131e1b><i class="el-icon" style="font-size:20px;" data-v-c4131e1b><!--[--><svg width="512" height="512" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-c4131e1b><path fill="currentColor" d="M880 112c-3.8 0-7.7.7-11.6 2.3L292 345.9H128c-8.8 0-16 7.4-16 16.6v299c0 9.2 7.2 16.6 16 16.6h101.6c-3.7 11.6-5.6 23.9-5.6 36.4c0 65.9 53.8 119.5 120 119.5c55.4 0 102.1-37.6 115.9-88.4l408.6 164.2c3.9 1.5 7.8 2.3 11.6 2.3c16.9 0 32-14.2 32-33.2V145.2C912 126.2 897 112 880 112M344 762.3c-26.5 0-48-21.4-48-47.8c0-11.2 3.9-21.9 11-30.4l84.9 34.1c-2 24.6-22.7 44.1-47.9 44.1" data-v-c4131e1b></path></svg><!--]--></i><span class="title" data-v-c4131e1b>公告</span></div><i class="el-icon close-icon" style="font-size:20px;" data-v-c4131e1b><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" data-v-c4131e1b><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336z"></path></svg><!--]--></i></div><div class="body content" data-v-c4131e1b><!--[--><p style="" data-v-c4131e1b>👇微信扫码添加好友👇</p><img src="https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/qrcode3.png" style="" data-v-c4131e1b><button ariadisabled="false" type="button" class="el-button el-button--primary" style="" data-v-c4131e1b><!--v-if--><span class=""><!--[-->云原生文档<!--]--></span></button><button ariadisabled="false" type="button" class="el-button el-button--success" style="" data-v-c4131e1b><!--v-if--><span class=""><!--[-->生活博客<!--]--></span></button><!--]--><!----></div><div class="footer content" data-v-c4131e1b><!--[--><!--]--></div></div><div style="" class="theme-blog-popover-close" data-v-c4131e1b><i class="el-icon" style="" data-v-c4131e1b><!--[--><svg width="512" height="512" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-c4131e1b><path fill="currentColor" d="M880 112c-3.8 0-7.7.7-11.6 2.3L292 345.9H128c-8.8 0-16 7.4-16 16.6v299c0 9.2 7.2 16.6 16 16.6h101.6c-3.7 11.6-5.6 23.9-5.6 36.4c0 65.9 53.8 119.5 120 119.5c55.4 0 102.1-37.6 115.9-88.4l408.6 164.2c3.9 1.5 7.8 2.3 11.6 2.3c16.9 0 32-14.2 32-33.2V145.2C912 126.2 897 112 880 112M344 762.3c-26.5 0-48-21.4-48-47.8c0-11.2 3.9-21.9 11-30.4l84.9 34.1c-2 24.6-22.7 44.1-47.9 44.1" data-v-c4131e1b></path></svg><!--]--></i></div><!--]--><!--]--><!--[--><span tabindex="-1" data-v-90bc8193></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-90bc8193> Skip to content </a><!--]--><!----><header class="VPNav" data-v-0ee98b82 data-v-7d14d9ec><div class="VPNavBar top" data-v-7d14d9ec data-v-7407bb7e><div class="wrapper" data-v-7407bb7e><div class="container" data-v-7407bb7e><div class="title" data-v-7407bb7e><div class="VPNavBarTitle" data-v-7407bb7e data-v-8fc9fa6a><a class="title" href="/" data-v-8fc9fa6a><!--[--><!--]--><!--[--><img class="VPImage logo" src="/favicon.ico" alt data-v-836efe69><!--]--><span data-v-8fc9fa6a>皮特ᴾᵗ的博客技术站</span><!--[--><!--]--></a></div></div><div class="content" data-v-7407bb7e><div class="content-body" data-v-7407bb7e><!--[--><!--]--><div class="blog-search search" data-pagefind-ignore="all" data-v-7407bb7e style="--298d4096:1;" data-v-19515926><div class="nav-search-btn-wait" data-v-19515926><span data-v-19515926><svg width="14" height="14" viewBox="0 0 20 20" data-v-19515926><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" data-v-19515926></path></svg></span><span style="" class="search-tip" data-v-19515926>Search</span><span style="" class="metaKey" data-v-19515926> K </span></div><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-7407bb7e data-v-f573d318><span id="main-nav-aria-label" class="visually-hidden" data-v-f573d318>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-f573d318 data-v-4cd4f5b6><!--[--><span data-v-4cd4f5b6>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f573d318 data-v-4cac540c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-4cac540c><span class="text" data-v-4cac540c><!----><span data-v-4cac540c>面试</span><span class="vpi-chevron-down text-icon" data-v-4cac540c></span></span></button><div class="menu" data-v-4cac540c><div class="VPMenu" data-v-4cac540c data-v-1e8da741><div class="items" data-v-1e8da741><!--[--><!--[--><div class="VPMenuLink" data-v-1e8da741 data-v-c4c1f861><a class="VPLink link" href="/posts/interview/tcp.html" data-v-c4c1f861><!--[-->TCP篇<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f573d318 data-v-4cac540c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-4cac540c><span class="text" data-v-4cac540c><!----><span data-v-4cac540c>趣味</span><span class="vpi-chevron-down text-icon" data-v-4cac540c></span></span></button><div class="menu" data-v-4cac540c><div class="VPMenu" data-v-4cac540c data-v-1e8da741><div class="items" data-v-1e8da741><!--[--><!--[--><div class="VPMenuLink" data-v-1e8da741 data-v-c4c1f861><a class="VPLink link" href="/fun/catch-the-cat.html" data-v-c4c1f861><!--[-->逮住那只猫！<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/aboutme.html" tabindex="0" data-v-f573d318 data-v-4cd4f5b6><!--[--><span data-v-4cd4f5b6>关于我</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-7407bb7e data-v-62b4534c><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-62b4534c data-v-a6a5d4f7 data-v-af5aa62c><span class="check" data-v-af5aa62c><span class="icon" data-v-af5aa62c><!--[--><span class="vpi-sun sun" data-v-a6a5d4f7></span><span class="vpi-moon moon" data-v-a6a5d4f7></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-7407bb7e data-v-b2667c88 data-v-eeec2cf6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hyperter96/tech-blog" aria-label="github" target="_blank" rel="noopener" data-v-eeec2cf6 data-v-88162b05><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-7407bb7e data-v-d0bc4d9c data-v-4cac540c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-4cac540c><span class="vpi-more-horizontal icon" data-v-4cac540c></span></button><div class="menu" data-v-4cac540c><div class="VPMenu" data-v-4cac540c data-v-1e8da741><!----><!--[--><!--[--><!----><div class="group" data-v-d0bc4d9c><div class="item appearance" data-v-d0bc4d9c><p class="label" data-v-d0bc4d9c>Appearance</p><div class="appearance-action" data-v-d0bc4d9c><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bc4d9c data-v-a6a5d4f7 data-v-af5aa62c><span class="check" data-v-af5aa62c><span class="icon" data-v-af5aa62c><!--[--><span class="vpi-sun sun" data-v-a6a5d4f7></span><span class="vpi-moon moon" data-v-a6a5d4f7></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bc4d9c><div class="item social-links" data-v-d0bc4d9c><div class="VPSocialLinks social-links-list" data-v-d0bc4d9c data-v-eeec2cf6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/hyperter96/tech-blog" aria-label="github" target="_blank" rel="noopener" data-v-eeec2cf6 data-v-88162b05><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--[--><!--[--><!--[--><div class="VPFlyout VPNolebaseEnhancedReadabilitiesMenu VPNolebaseEnhancedReadabilitiesMenuFlyout" aria-label="阅读增强插件" role="menuitem" data-v-399d80c9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-399d80c9><span class="text" data-v-399d80c9><span class="i-icon-park-outline:book-open option-icon" data-v-399d80c9></span><!----><span class="vpi-chevron-down text-icon" data-v-399d80c9></span></span></button><div class="menu" data-v-399d80c9><div class="VPMenu" data-v-6abf1fc7 data-v-399d80c9><!----><!--[--><!--]--></div></div></div><!--]--><!--]--><!--]--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-7407bb7e data-v-36c946ca><span class="container" data-v-36c946ca><span class="top" data-v-36c946ca></span><span class="middle" data-v-36c946ca></span><span class="bottom" data-v-36c946ca></span></span></button></div></div></div></div><div class="divider" data-v-7407bb7e><div class="divider-line" data-v-7407bb7e></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-0ee98b82 data-v-b4b1198d><div class="container" data-v-b4b1198d><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-b4b1198d data-v-5024c8e4><button data-v-5024c8e4>回到顶部</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-pagefind-body data-v-0ee98b82 data-v-29cdf1d8><div class="VPDoc has-aside" data-v-29cdf1d8 data-v-1ddb44d6><!--[--><!--]--><div class="container" data-v-1ddb44d6><div class="aside" data-v-1ddb44d6><div class="aside-curtain" data-v-1ddb44d6></div><div class="aside-container" data-v-1ddb44d6><div class="aside-content" data-v-1ddb44d6><div class="VPDocAside" data-v-1ddb44d6 data-v-6238759d><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-6238759d data-v-6dc5f8e5><div class="content" data-v-6dc5f8e5><div class="outline-marker" data-v-6dc5f8e5></div><div class="outline-title" role="heading" aria-level="2" data-v-6dc5f8e5>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-6dc5f8e5><span class="visually-hidden" id="doc-outline-aria-label" data-v-6dc5f8e5> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-6dc5f8e5 data-v-e57f3a18><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-6238759d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-1ddb44d6><div class="content-container" data-v-1ddb44d6><!--[--><!--[--><!--[--><!--[--><!--]--><!----><!--]--><!--]--><!--]--><main class="main" data-v-1ddb44d6><div style="position:relative;" class="vp-doc _posts_cilium_bgp-exercise-bird-cilium" data-v-1ddb44d6><div><h1 id="cilium系列二-使用bird和cilium部署bgp模式的k8s集群" tabindex="-1">Cilium系列二：使用bird和cilium部署BGP模式的k8s集群 <a class="header-anchor" href="#cilium系列二-使用bird和cilium部署bgp模式的k8s集群" aria-label="Permalink to &quot;Cilium系列二：使用bird和cilium部署BGP模式的k8s集群&quot;">​</a></h1><p>这是使用 Cilium BGP 控制平面 (BGP CP) 向外部 BGP 路由器通告路由以及在两个集群之间路由的演示。 每个集群执行以下操作：</p><ol><li>运行 2 个作为部署进行管理的 nginx pod。</li><li>将 nginx pod 作为服务公开。</li><li>使用 Cilium IP 池将外部 IP 分配给服务。</li><li>使用 BGP CP 通告 nginx 服务。</li></ol><h2 id="前置条件" tabindex="-1">前置条件 <a class="header-anchor" href="#前置条件" aria-label="Permalink to &quot;前置条件&quot;">​</a></h2><ol><li><code>kubectl</code></li><li><code>helm</code></li><li><code>kind</code></li><li><code>cilium-cli</code></li></ol><h2 id="安装集群" tabindex="-1">安装集群 <a class="header-anchor" href="#安装集群" aria-label="Permalink to &quot;安装集群&quot;">​</a></h2><p>使用<code>kind</code>安装第一个集群，</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: Cluster</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: kind.x-k8s.io/v1alpha4</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">networking:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  disableDefaultCNI: true   # do not install kindnet</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  kubeProxyMode: none       # do not run kube-proxy</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  podSubnet: &quot;10.241.0.0/16&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  serviceSubnet: &quot;10.11.0.0/16&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">name: cilium</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nodes:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- role: control-plane</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- role: worker</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- role: worker</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意</p><p>使用两个工作节点，因此 nginx 部署中的每个 pod 都被安排到一个单独的节点。</p></div><p>创建用于第二个集群的 Docker 网络：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d=bridge</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;com.docker.network.bridge.enable_ip_masquerade=true&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --attachable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;kind2&quot;</span></span></code></pre></div><p>设置 <code>KIND_EXPERIMENTAL_DOCKER_NETWORK</code> 环境变量，让 <code>kind</code> 使用此网络而不是默认的 <code>kind</code> 网络：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KIND_EXPERIMENTAL_DOCKER_NETWORK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kind2</span></span></code></pre></div><p>创建第二个集群，</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: Cluster</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: kind.x-k8s.io/v1alpha4</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">networking:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  disableDefaultCNI: true   # do not install kindnet</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  kubeProxyMode: none       # do not run kube-proxy</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  podSubnet: &quot;10.242.0.0/16&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  serviceSubnet: &quot;10.12.0.0/16&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">name: cilium2</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nodes:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- role: control-plane</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- role: worker</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- role: worker</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><p>删除环境变量，以便将来的集群安装使用默认类型的 Docker 网络。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">unset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KIND_EXPERIMENTAL_DOCKER_NETWORK</span></span></code></pre></div><p>您现在有两个不同网络的 k8s 集群，且暂时无法相互通信。两个集群的节点信息如下，</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-gbgkI" id="tab-tAgjeNq" checked="checked"><label for="tab-tAgjeNq">kind-cilium2</label><input type="radio" name="group-gbgkI" id="tab-dIjmkSG"><label for="tab-dIjmkSG">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wide</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   INTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   OS-IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                         KERNEL-VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        CONTAINER-RUNTIME</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium2-control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   2d5h</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.27.3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   172.19.0.4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Debian</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GNU/Linux</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (bullseye)   5.15.133.1-microsoft-standard-WSL2+   containerd://1.7.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium2-worker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    svr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             2d5h</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.27.3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   172.19.0.3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Debian</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GNU/Linux</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (bullseye)   5.15.133.1-microsoft-standard-WSL2+   containerd://1.7.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium2-worker2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          2d5h</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.27.3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   172.19.0.2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Debian</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GNU/Linux</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (bullseye)   5.15.133.1-microsoft-standard-WSL2+   containerd://1.7.1</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wide</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                   STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   INTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   OS-IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                         KERNEL-VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        CONTAINER-RUNTIME</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   2d5h</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.27.3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   172.18.0.2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Debian</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GNU/Linux</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (bullseye)   5.15.133.1-microsoft-standard-WSL2+   containerd://1.7.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-worker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          2d5h</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.27.3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   172.18.0.3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Debian</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GNU/Linux</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (bullseye)   5.15.133.1-microsoft-standard-WSL2+   containerd://1.7.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-worker2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          2d5h</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.27.3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   172.18.0.4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Debian</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GNU/Linux</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (bullseye)   5.15.133.1-microsoft-standard-WSL2+   containerd://1.7.1</span></span></code></pre></div></div></div><h2 id="安装cilium" tabindex="-1">安装Cilium <a class="header-anchor" href="#安装cilium" aria-label="Permalink to &quot;安装Cilium&quot;">​</a></h2><p>在第二个集群中安装 <code>Cilium v1.14</code>。 Kind 应该为 <code>kind-cilium2</code> 的 <code>context</code> 设置 <code>kubectl context</code>。 在本指南中使用 <code>kubectl config use-context</code> 命令在 <code>kind-cilium</code> 和 <code>kind-cilium2</code> 的 <code>context</code> 之间进行更改，例如 <code>cilium</code> 和 <code>cilium 2</code> 集群。</p><div class="warning custom-block"><p class="custom-block-title">注意</p><p>如果这是第一次使用 <code>Helm</code> 安装 <code>Cilium</code>，请使用 <code>install</code> 子命令而不是 <code>upgrade</code>。</p></div><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-3utUR" id="tab-gvPfjbh" checked="checked"><label for="tab-gvPfjbh">kind-cilium2</label><input type="radio" name="group-3utUR" id="tab-Q2Tj_YS"><label for="tab-Q2Tj_YS">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upgrade</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --kube-context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium/cilium</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --version</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.14.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --values</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kubeProxyReplacement: strict</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">k8sServiceHost: cilium2-control-plane # use master node in kind network</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">k8sServicePort: 6443               # use api server port</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hostServices:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  enabled: false</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">externalIPs:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  enabled: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nodePort:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  enabled: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hostPort:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  enabled: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">image:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  pullPolicy: IfNotPresent</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ipam:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mode: kubernetes</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tunnel: disabled</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ipv4NativeRoutingCIDR: 10.11.0.0/16</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bgpControlPlane:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  enabled: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">autoDirectNodeRoutes: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upgrade</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --kube-context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium/cilium</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --version</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.14.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --values</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kubeProxyReplacement: strict</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">k8sServiceHost: cilium-control-plane # use master node in kind network</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">k8sServicePort: 6443               # use api server port</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hostServices:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  enabled: false</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">externalIPs:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  enabled: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nodePort:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  enabled: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hostPort:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  enabled: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">image:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  pullPolicy: IfNotPresent</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ipam:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mode: kubernetes</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tunnel: disabled</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ipv4NativeRoutingCIDR: 10.12.0.0/16</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bgpControlPlane:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  enabled: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">autoDirectNodeRoutes: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div></div></div><p>等待cilium安装成功，</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-zNY_J" id="tab-oEinRll" checked="checked"><label for="tab-oEinRll">kind-cilium2</label><input type="radio" name="group-zNY_J" id="tab-xEHBIci"><label for="tab-xEHBIci">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --wait</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    /¯¯\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /¯¯</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\_</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">_/¯¯</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Cilium:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> \__/¯¯\__/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Operator:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /¯¯\__/¯¯\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Envoy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DaemonSet:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    disabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (using </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">embedded</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> \__/¯¯\__/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Hubble</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Relay:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       disabled</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    \__/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       ClusterMesh:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        disabled</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DaemonSet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             Desired:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Ready:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2/2,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Available:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2/2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             cilium-operator</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Desired:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Ready:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2/2,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Available:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2/2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Containers:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            cilium-operator</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Running:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                       cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             Running:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Pods:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          3/3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> managed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Cilium</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1.14.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> versions</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             quay.io/cilium/cilium:v1.14.0@sha256:5a94b561f4651fcfd85970a50bc78b201cfbd6e2ab1a03848eab25a82832653a:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                       cilium-operator</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    quay.io/cilium/operator-generic:v1.14.0@sha256:3014d4bcb8352f0ddef90fa3b5eb1bbf179b91024813a90a0066eb4517ba93c9:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --wait</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    /¯¯\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /¯¯</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\_</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">_/¯¯</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Cilium:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> \__/¯¯\__/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Operator:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /¯¯\__/¯¯\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Envoy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DaemonSet:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    disabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (using </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">embedded</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> \__/¯¯\__/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Hubble</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Relay:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       disabled</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    \__/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       ClusterMesh:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        disabled</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             cilium-operator</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Desired:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Ready:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2/2,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Available:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2/2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DaemonSet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             Desired:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Ready:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2/2,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Available:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2/2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Containers:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             Running:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                       cilium-operator</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Running:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Pods:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          3/3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> managed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Cilium</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1.14.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> versions</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             quay.io/cilium/cilium:v1.14.0@sha256:5a94b561f4651fcfd85970a50bc78b201cfbd6e2ab1a03848eab25a82832653a:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                       cilium-operator</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    quay.io/cilium/operator-generic:v1.14.0@sha256:3014d4bcb8352f0ddef90fa3b5eb1bbf179b91024813a90a0066eb4517ba93c9:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span></code></pre></div></div></div><h2 id="运行外部bgp路由" tabindex="-1">运行外部BGP路由 <a class="header-anchor" href="#运行外部bgp路由" aria-label="Permalink to &quot;运行外部BGP路由&quot;">​</a></h2><p>我们使用 Bird 作为外部路由器，并与每个集群中的 Cilium BGP 路由器对等。<code>bird.conf</code>的配置如下，</p><details class="details custom-block"><summary><code>bird.conf</code></summary><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>log &quot;bird.log&quot; all;</span></span>
<span class="line"><span># debug protocols all;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>protocol device {</span></span>
<span class="line"><span>    scan time 10;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># BGP peer cilium-control-plane node config</span></span>
<span class="line"><span>protocol bgp cluster1_cp {</span></span>
<span class="line"><span>    # IP of Bird container interface to kind-cilium cluster</span></span>
<span class="line"><span>    router id 172.18.0.5;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ipv4 {</span></span>
<span class="line"><span>        import all;</span></span>
<span class="line"><span>        export all;</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Local settings (Assuming AS 65000 for our BIRD instance)</span></span>
<span class="line"><span>    local as 65000;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Peer cilium-control-plane node</span></span>
<span class="line"><span>    neighbor 172.18.0.2 as 65100;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># BGP peer cilium-worker node config</span></span>
<span class="line"><span>protocol bgp cluster1_worker {</span></span>
<span class="line"><span>    # IP of Bird container interface to kind-cilium cluster</span></span>
<span class="line"><span>    router id 172.18.0.5; # eth0 IP of Bird container</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ipv4 {</span></span>
<span class="line"><span>        import all;</span></span>
<span class="line"><span>        export all;</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Local settings (Assuming AS 65000 for our BIRD instance)</span></span>
<span class="line"><span>    local as 65000;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Peer cilium-worker node</span></span>
<span class="line"><span>    neighbor 172.18.0.3 as 65100;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># BGP peer cilium-worker2 node config</span></span>
<span class="line"><span>protocol bgp cluster1_worker2 {</span></span>
<span class="line"><span>    # IP of Bird container interface to kind-cilium cluster</span></span>
<span class="line"><span>    router id 172.18.0.5;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ipv4 {</span></span>
<span class="line"><span>        import all;</span></span>
<span class="line"><span>        export all;</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Local settings (Assuming AS 65000 for our BIRD instance)</span></span>
<span class="line"><span>    local as 65000;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Peer cilium-worker2 node</span></span>
<span class="line"><span>    neighbor 172.18.0.4 as 65100;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># BGP peer cilium2-control-plane node config</span></span>
<span class="line"><span>protocol bgp cluster2_cp {</span></span>
<span class="line"><span>    # IP of Bird container interface to kind-cilium2 cluster</span></span>
<span class="line"><span>    router id 172.19.0.5;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ipv4 {</span></span>
<span class="line"><span>        import all;</span></span>
<span class="line"><span>        export all;</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Local settings (Assuming AS 65000 for our BIRD instance)</span></span>
<span class="line"><span>    local as 65000;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Peer cilium2-control-plane node</span></span>
<span class="line"><span>    neighbor 172.19.0.4 as 65200;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># BGP peer cilium2-worker node config</span></span>
<span class="line"><span>protocol bgp cluster2_worker {</span></span>
<span class="line"><span>    # IP of Bird container interface to kind-cilium2 cluster</span></span>
<span class="line"><span>    router id 172.19.0.5;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ipv4 {</span></span>
<span class="line"><span>        import all;</span></span>
<span class="line"><span>        export all;</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Local settings (Assuming AS 65000 for our BIRD instance)</span></span>
<span class="line"><span>    local as 65000;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Peer cilium2-worker node</span></span>
<span class="line"><span>    neighbor 172.19.0.3 as 65200;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># BGP peer cilium2-worker2 node config</span></span>
<span class="line"><span>protocol bgp cluster2_worker2 {</span></span>
<span class="line"><span>    # IP of Bird container interface to kind-cilium2 cluster</span></span>
<span class="line"><span>    router id 172.19.0.5;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ipv4 {</span></span>
<span class="line"><span>        import all;</span></span>
<span class="line"><span>        export all;</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Local settings (Assuming AS 65000 for our BIRD instance)</span></span>
<span class="line"><span>    local as 65000;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Peer cilium-worker2 node</span></span>
<span class="line"><span>    neighbor 172.19.0.2 as 65200;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Direct routes</span></span>
<span class="line"><span>protocol direct {</span></span>
<span class="line"><span>    interface &quot;eth*&quot;, &quot;lo&quot;;  # Listen to these interfaces for direct routes</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># This protocol manages kernel route table</span></span>
<span class="line"><span>protocol kernel {</span></span>
<span class="line"><span>    learn;          # Learn existing routes from kernel</span></span>
<span class="line"><span>    persist;        # Don&#39;t remove routes on BIRD shutdown</span></span>
<span class="line"><span>    scan time 20;   # Scan kernel routing table every 20 seconds</span></span>
<span class="line"><span>    ipv4 {</span></span>
<span class="line"><span>        export all;     # Default is export none</span></span>
<span class="line"><span>        import none;    # Default is import all</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>}</span></span></code></pre></div></details><p>拉取 <code>bird</code> 的镜像，</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ghcr.io/akafeng/bird</span></span></code></pre></div><p>启动 <code>bird-router</code>的容器，</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pwd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">):/etc/bird/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cap-add=NET_ADMIN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --network=kind</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name=bird-router</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ghcr.io/akafeng/bird</span></span></code></pre></div><p>待容器启动以后，进入容器，</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bird-router</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sh</span></span></code></pre></div><p>重新加载 <code>bird</code> 的配置，</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">birdc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configure</span></span></code></pre></div><p>验证网络接口配置和路由表：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span></span></code></pre></div><p>验证 BGP 配置。</p><div class="warning custom-block"><p class="custom-block-title">注意</p><p>在为两个集群配置 Cilium BGP CP 之前，配置的对等点不会 <code>ESTABLISHED</code>。</p></div><h2 id="运行-nginx-sample-应用" tabindex="-1">运行 nginx sample 应用 <a class="header-anchor" href="#运行-nginx-sample-应用" aria-label="Permalink to &quot;运行 nginx sample 应用&quot;">​</a></h2><p>两个集群同时创建 nginx 应用，</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-1H1wz" id="tab-cI0yTxP" checked="checked"><label for="tab-cI0yTxP">kind-cilium2</label><input type="radio" name="group-1H1wz" id="tab-GPSVg-i"><label for="tab-GPSVg-i">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: apps/v1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: Deployment</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name: nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  selector:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    matchLabels:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      app: nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  replicas: 2</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  template:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      labels:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        app: nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      containers:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      - name: nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        image: nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        ports:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        - containerPort: 80</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: apps/v1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: Deployment</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name: nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  selector:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    matchLabels:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      app: nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  replicas: 2</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  template:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      labels:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        app: nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      containers:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      - name: nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        image: nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        ports:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        - containerPort: 80</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div></div></div><p>各获取 nginx Pod 的IP，</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-DSchh" id="tab-qVdaJV1" checked="checked"><label for="tab-qVdaJV1">kind-cilium2</label><input type="radio" name="group-DSchh" id="tab-YbDfzNF"><label for="tab-YbDfzNF">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wide</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx-55f598f8d-76knw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          39h</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.242.2.61</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    cilium2-worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx-55f598f8d-lttxc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          39h</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.242.1.251</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   cilium2-worker2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wide</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx-55f598f8d-mxcw6</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          39h</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.241.1.140</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   cilium-worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx-55f598f8d-xd4t8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          39h</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.241.2.19</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    cilium-worker2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div></div></div><p>同一个集群下，测试两个nginx是否连通，</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-zqc9P" id="tab-zGs9Iks" checked="checked"><label for="tab-zGs9Iks">kind-cilium2</label><input type="radio" name="group-zqc9P" id="tab-Qf9lCPg"><label for="tab-Qf9lCPg">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/nginx-55f598f8d-76knw</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%{http_code}&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://10.242.1.251</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">200</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/nginx-55f598f8d-mxcw6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%{http_code}&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://10.241.2.19</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">200</span></span></code></pre></div></div></div><p>每个集群内的连接已成功验证，您现在可以继续下一部分。</p><p>使用负载均衡器服务公开每个集群的 nginx 部署。 首先创建用于向负载均衡器服务分配地址的 IPAM 池：</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-dTXvs" id="tab-M41LY4H" checked="checked"><label for="tab-M41LY4H">kind-cilium2</label><input type="radio" name="group-dTXvs" id="tab-12_J_Ne"><label for="tab-12_J_Ne">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: &quot;cilium.io/v2alpha1&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: CiliumLoadBalancerIPPool</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name: demo</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  cidrs:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  - cidr: &quot;10.12.0.0/16&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: &quot;cilium.io/v2alpha1&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: CiliumLoadBalancerIPPool</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name: demo</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  cidrs:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  - cidr: &quot;10.11.0.0/16&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div></div></div><p>并暴露 nginx 服务，</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-sT2ik" id="tab-AisRoTO" checked="checked"><label for="tab-AisRoTO">kind-cilium2</label><input type="radio" name="group-sT2ik" id="tab-uNvFHHv"><label for="tab-uNvFHHv">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> expose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --type=LoadBalancer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --port=80</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --labels</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app=nginx</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> expose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --type=LoadBalancer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --port=80</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --labels</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app=nginx</span></span></code></pre></div></div></div><p>每个集群的 nginx 服务都应该有一个从 IPAM 池分配的外部 IP。 检查两个集群中nginx服务的外部IP，</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-OZkNs" id="tab-H-2vjpb" checked="checked"><label for="tab-H-2vjpb">kind-cilium2</label><input type="radio" name="group-OZkNs" id="tab-0KKdfq4"><label for="tab-0KKdfq4">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> svc/nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           CLUSTER-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)        </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   LoadBalancer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.12.173.3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.12.225.247</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   80:32313/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   39h</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> svc/nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           CLUSTER-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)        </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   LoadBalancer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.11.144.48</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.11.192.248</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   80:32047/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   39h</span></span></code></pre></div></div></div><p>在接下来的步骤中，BGP 将公布外部 IP，以提供负载均衡器服务的外部/集群间连接。</p><h2 id="配置-bgp" tabindex="-1">配置 BGP <a class="header-anchor" href="#配置-bgp" aria-label="Permalink to &quot;配置 BGP&quot;">​</a></h2><p>Cilium BGP 配置分为两部分：</p><ol><li>注释将运行 BGP 的节点并配置对等策略以配置 BGP 对端</li><li>通告路由等。</li></ol><p>有关 BGP 控制平面的其他详细信息，请参阅<a href="https://docs.cilium.io/en/v1.14/network/bgp-control-plane/" target="_blank" rel="noreferrer">官方文档</a>。</p><p>注释两个集群的节点，</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-_BE5L" id="tab-cB9v8UV" checked="checked"><label for="tab-cB9v8UV">kind-cilium2</label><input type="radio" name="group-_BE5L" id="tab-e0kNI2v"><label for="tab-e0kNI2v">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node/cilium2-control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium.io/bgp-virtual-router.65200=&quot;local-port=179&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node/cilium2-worker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium.io/bgp-virtual-router.65200=&quot;local-port=179&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node/cilium2-worker2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium.io/bgp-virtual-router.65200=&quot;local-port=179&quot;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node/cilium-control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium.io/bgp-virtual-router.65100=&quot;local-port=179&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node/cilium-worker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium.io/bgp-virtual-router.65100=&quot;local-port=179&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node/cilium-worker2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium.io/bgp-virtual-router.65100=&quot;local-port=179&quot;</span></span></code></pre></div></div></div><div class="warning custom-block"><p class="custom-block-title">注意</p><p>在典型部署中，BGP CP 将不会在控制平面节点上运行，因为它们不运行工作负载 Pod。</p></div><p>由于在此演示中每个集群都处于单独管理之下，因此使用了不同的自治系统 (AS) 编号，分别为 65100 和 65200。</p><p>将 BGP peer policy 应用于两个集群，</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-bF6dw" id="tab-sdaHTAD" checked="checked"><label for="tab-sdaHTAD">kind-cilium2</label><input type="radio" name="group-bF6dw" id="tab-otKYlHF"><label for="tab-otKYlHF">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: cilium.io/v2alpha1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: CiliumBGPPeeringPolicy</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name: demo</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nodeSelector:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    matchLabels:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      kubernetes.io/os: linux</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  virtualRouters:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - exportPodCIDR: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      localASN: 65200</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      neighbors:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        - peerASN: 65000</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          peerAddress: 172.19.0.5/32 # eth1 IP of Bird router</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      serviceSelector:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        matchLabels:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          app: nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: cilium.io/v2alpha1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: CiliumBGPPeeringPolicy</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name: demo</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  nodeSelector:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    matchLabels:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      kubernetes.io/os: linux</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  virtualRouters:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - exportPodCIDR: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      localASN: 65100</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      neighbors:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        - peerASN: 65000</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          peerAddress: 172.18.0.5/32 # eth0 IP of Bird router</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      serviceSelector:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        matchLabels:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          app: nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div></div></div><div class="warning custom-block"><p class="custom-block-title">注意</p><p><code>exportPodCIDR</code> 字段的设置是为了让节点通告 Pod CIDR。 这将允许外部 Bird 路由器将响应流量路由回 cURL 客户端。</p></div><p>由于 BGP CP 不会将路由添加到数据路径（即本地节点路由表），因此您必须在节点上创建到对方集群的 Service 和 Pod CIDR 的静态路由。</p><p>在两个集群中添加静态路由。 使用 <code>kubectl --context kind-cilium get po -n kube-system | grep cilium</code> 如果您需要 Cilium pod 的容器名称，</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-DCDeC" id="tab-lG7fzH4" checked="checked"><label for="tab-lG7fzH4">kind-cilium2</label><input type="radio" name="group-DCDeC" id="tab-rxtzp5E"><label for="tab-rxtzp5E">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-g7djj</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                    1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   49</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   2d5h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-jq5xr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                    1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   49</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   2d5h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-operator-5c748d6d-5hnfx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    2d5h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-operator-5c748d6d-q8gsl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    2d5h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-sh6qh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                    1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   49</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   2d5h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">etcd-cilium2-control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    2d6h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kube-apiserver-cilium2-control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    2d6h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kube-controller-manager-cilium2-control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    2d6h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kube-scheduler-cilium2-control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    2d6h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/cilium-g7djj</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.11.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.19.0.5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/cilium-g7djj</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.241.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.19.0.5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/cilium-jq5xr</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.11.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.19.0.5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/cilium-jq5xr</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.241.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.19.0.5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/cilium-sh6qh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.11.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.19.0.5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/cilium-sh6qh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.241.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.19.0.5</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-2kfdw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   49</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   2d5h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-88mkj</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   2d5h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-operator-5b5cc99864-nf657</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    2d5h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-operator-5b5cc99864-xtbgh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    2d5h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-vrcj9</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   2d5h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">etcd-cilium-control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               2d2h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kube-apiserver-cilium-control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               2d2h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kube-controller-manager-cilium-control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    2d6h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kube-scheduler-cilium-control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (2d2h </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    2d6h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/cilium-2kfdw</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.12.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.18.0.5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/cilium-2kfdw</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.242.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.18.0.5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/cilium-88mkj</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.12.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.18.0.5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/cilium-88mkj</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.242.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.18.0.5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/cilium-vrcj9</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.12.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.18.0.5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> po/cilium-vrcj9</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.242.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.18.0.5</span></span></code></pre></div></div></div><h2 id="验证-bgp-路由连通两个集群" tabindex="-1">验证 BGP 路由连通两个集群 <a class="header-anchor" href="#验证-bgp-路由连通两个集群" aria-label="Permalink to &quot;验证 BGP 路由连通两个集群&quot;">​</a></h2><p>验证是否已使用 Bird 路由器建立了两个集群的 BGP speaker：</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-TTxne" id="tab-PXdwTIa" checked="checked"><label for="tab-PXdwTIa">kind-cilium2</label><input type="radio" name="group-TTxne" id="tab-YhpqIvs"><label for="tab-YhpqIvs">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bgp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> peers</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    Local</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Peer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Peer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Session</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> State</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Uptime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      Family</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Received</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Advertised</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium2-control-plane</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   65200</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      65000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     172.19.0.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     established</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     30h35m47s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ipv4/unicast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                                                                        ipv6/unicast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium2-worker</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          65200</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      65000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     172.19.0.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     established</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     30h35m45s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ipv4/unicast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                                                                        ipv6/unicast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium2-worker2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         65200</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      65000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     172.19.0.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     established</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     30h35m47s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ipv4/unicast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                                                                        ipv6/unicast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          0</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cilium</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --context</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kind-cilium</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bgp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> peers</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                   Local</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Peer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Peer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Session</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> State</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Uptime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      Family</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Received</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Advertised</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-control-plane</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   65100</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      65000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     172.18.0.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     established</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     30h36m33s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ipv4/unicast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                                                                       ipv6/unicast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-worker</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          65100</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      65000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     172.18.0.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     established</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     30h36m34s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ipv4/unicast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                                                                       ipv6/unicast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cilium-worker2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         65100</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      65000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     172.18.0.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     established</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     30h36m31s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ipv4/unicast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                                                                       ipv6/unicast</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          0</span></span></code></pre></div></div></div><p>进入 bird-router，</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bird-router</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sh</span></span></code></pre></div><p>验证路由表已更新，</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.18.0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.11.192.248</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.18.0.2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bird</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metric</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.12.225.247</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.19.0.2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bird</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metric</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.241.0.0/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.18.0.2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bird</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metric</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.241.1.0/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.18.0.3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bird</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metric</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.241.2.0/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.18.0.4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bird</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metric</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.242.0.0/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.19.0.4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bird</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metric</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.242.1.0/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.19.0.2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bird</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metric</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.242.2.0/24</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.19.0.3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bird</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> metric</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.18.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kernel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scope</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.18.0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.19.0.0/16</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kernel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scope</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.19.0.5</span></span></code></pre></div><p>验证两个集群中的nginx服务是否连通，</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-EdKt5" id="tab-japPlgr" checked="checked"><label for="tab-japPlgr">kind-cilium2</label><input type="radio" name="group-EdKt5" id="tab-Unj2EFR"><label for="tab-Unj2EFR">kind-cilium</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%{http_code}&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://10.12.225.247</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">200</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%{http_code}&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://10.11.192.248</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">200</span></span></code></pre></div></div></div></div></div></main><footer class="VPDocFooter" data-v-1ddb44d6 data-v-177cdd86><!--[--><!--]--><div class="edit-info" data-v-177cdd86><div class="edit-link" data-v-177cdd86><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/hyperter96/tech-blog/tree/main/docs/posts/cilium/bgp-exercise-bird-cilium.md" target="_blank" rel="noreferrer" data-v-177cdd86><!--[--><span class="vpi-square-pen edit-link-icon" data-v-177cdd86></span> 去 GitHub 上编辑内容<!--]--></a></div><div class="last-updated" data-v-177cdd86><p class="VPLastUpdated" data-v-177cdd86 data-v-f5865ae3>上次更新于: <time datetime="2024-05-28T08:29:40.000Z" data-v-f5865ae3></time></p></div></div><nav class="prev-next" data-v-177cdd86><div class="pager" data-v-177cdd86><a class="VPLink link pager-link prev" href="/posts/cilium/cilium-intro.html" data-v-177cdd86><!--[--><span class="desc" data-v-177cdd86>Previous page</span><span class="title" data-v-177cdd86>Cilium系列一：Cilium架构体系</span><!--]--></a></div><div class="pager" data-v-177cdd86><a class="VPLink link pager-link next" href="/posts/cilium/exercise-cluster-mesh.html" data-v-177cdd86><!--[--><span class="desc" data-v-177cdd86>Next page</span><span class="title" data-v-177cdd86>Cilium系列三：Cilium在集群网格Cluster Mesh中的实践</span><!--]--></a></div></nav></footer><!--[--><!--[--><!--[--><!--[--><!--]--><!----><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"posts_interview_tcp.md\":\"D_r7oepm\",\"posts_interview_tcp-基础认识.md\":\"eIncchh1\",\"index.md\":\"pqY71bsF\",\"posts_jaeger_exercise-jaeger-in-prod.md\":\"D2a1yPrh\",\"fun_catch-the-cat.md\":\"CpLI_0bC\",\"posts_programming_go_goroutine.md\":\"DST-azXQ\",\"posts_programming_go_interface.md\":\"DGLcrzIg\",\"aboutme.md\":\"Bfgwmjjh\",\"posts_programming_go_mutex.md\":\"CGYrBjVf\",\"posts_linux_install-vm-centos-stream9.md\":\"D6o0-_Zm\",\"posts_programming_go_client-go_intro.md\":\"D0BoShCe\",\"posts_programming_go_client-go_informer.md\":\"DqCcJcKs\",\"posts_cilium_cilium-gateway-api.md\":\"BBG1cE2P\",\"posts_programming_go_defer.md\":\"CTZaVCzj\",\"posts_programming_rust_borrowing.md\":\"C_am6_-I\",\"posts_kubeovn_vpc-nat-gateway-config.md\":\"d4VSG9HE\",\"posts_programming_rust_fundamental-type.md\":\"BJKUCNdE\",\"posts_jaeger_jaeger-in-gin-and-grpc.md\":\"B7H6P6H2\",\"posts_programming_go_waitgroup.md\":\"DHv5uWQg\",\"posts_programming_go_client-go_informer-exercise.md\":\"B3HW7jz7\",\"posts_dragonfly_dragonfly-intro.md\":\"gv2sM-Mu\",\"posts_kubevela_kubevela-integrate-multicluster-with-ocm.md\":\"BiKh6C7T\",\"posts_dragonfly_exercise-dragonfly-with-nydus.md\":\"rJ0PJYFH\",\"posts_kubevela_get-to-know-kubevela.md\":\"CwoW4pV2\",\"posts_programming_go_client-go_client-go-pkg-part2.md\":\"Wh2HE4JC\",\"posts_learning-path.md\":\"oCa8QXqd\",\"posts_kubeovn_kubeovn-intro.md\":\"DVa5vK_8\",\"posts_mysql_mysql-infra.md\":\"DL-kq-Ja\",\"posts_cilium_cilium-intro.md\":\"BOnlAAXh\",\"posts_cilium_exercise-cluster-mesh.md\":\"CtPvFKbc\",\"posts_programming_rust_ownership.md\":\"CyMDtVBa\",\"posts_programming_rust_variable-bindings.md\":\"BtHJsf-U\",\"posts_programming_go_channel.md\":\"CVKF0fxF\",\"posts_cilium_bgp-exercise-bird-cilium.md\":\"BeuDvBX4\",\"posts_kubevela_addon-build-instruction.md\":\"CDoaK_g3\",\"posts_kubevela_application-controller-source-code-analysis-2.md\":\"Fj6MgrWV\",\"posts_kubevirt_hotplug-interface.md\":\"DNhM8RRI\",\"posts_programming_rust_statement-expr-print.md\":\"BlIqWJXR\",\"posts_programming_go_client-go_api-machinery.md\":\"B0hugwKX\",\"posts_cilium_install-cluster-with-kubeovn.md\":\"DZ_uYCTJ\",\"posts_kubevirt_quick-deploy-centos7.md\":\"CXIO-yOZ\",\"posts_programming_webassembly_run-wasm-app-from-host.md\":\"ZwvtJSZl\",\"posts_programming_rust_rust-function.md\":\"BeuukLbi\",\"posts_programming_webassembly_webassembly-full-stack-app.md\":\"OoJlzAAB\",\"posts_troubleshooting_k8s-pod-abnormal-analysis.md\":\"CsJwXKIH\",\"posts_programming_rust_disable-warning.md\":\"B9q_iOAl\",\"posts_linux_centos7-upgrade-to-stream9.md\":\"BBW0BeD9\",\"posts_programming_go_client-go_clientset.md\":\"DALNzrqi\",\"posts_programming_go_client-go_client-go-pkg-part1.md\":\"BWLMZEqq\",\"posts_programming_go_array-and-slices.md\":\"Lsvi3ux-\",\"posts_programming_rust_types-system.md\":\"a-2IlHkJ\",\"posts_kubevela_application-controller-source-code-analysis-1.md\":\"DaLjtmYp\",\"posts_velero_intro-and-practice.md\":\"BpTYMJwR\",\"posts_programming_rust_get-to-know-cargo.md\":\"WNZ_H_1r\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"皮特ᴾᵗ的博客技术站\",\"description\":\"热衷于云原生技术，一直为实现自我价值而执着！\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"blog\":{\"pagesData\":[{\"route\":\"/aboutme\",\"meta\":{\"sidebar\":false,\"title\":\"关于自己\",\"date\":\"2021-11-12 16:00:00\",\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/lighthouse.jpg\",\"tags\":[\"其它\"],\"tag\":[\"其它\"],\"description\":\"---\\n96年出生，标准的理工男一枚,毕业于(加拿大滑铁卢大学),热爱开源与知识分享~\\n除了技术，本人也是对心理学有浓厚的兴趣，热衷于研究mbti，希望可以多一点了解自己还有身边的人，理解为人相处之道\"}},{\"route\":\"/fun/catch-the-cat\",\"meta\":{\"date\":\"2021-02-01 19:04:49\",\"draft\":false,\"title\":\"逮住那只猫！\",\"sidebar\":false,\"tags\":[\"其它\"],\"tag\":[\"其它\"],\"cover\":\"\"}},{\"route\":\"/posts/learning-path\",\"meta\":{\"sidebar\":false,\"date\":\"2021-03-04 16:00:00\",\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background7.jpeg\",\"tags\":[\"其它\"],\"title\":\"关于研究技术的思维和规划\",\"tag\":[\"其它\"],\"description\":\" 研究技术的思维\\n 研究每项技术的意义\\n当我每次研究一项新的技术的时候，我都会思考这项技术的意义：\\n- 这项技术的发展背景\\n- 为什么要发展这项技术？有什么好处？\\n- 这项技术解决了什么问题？\\n当学完\"}},{\"route\":\"/posts/cilium/bgp-exercise-bird-cilium\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/cilium-bgp-demo.svg\",\"date\":\"2024-02-04 16:00:00\",\"tag\":[\"Cilium\",\"网络\",\"cni\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Cilium系列一：Cilium架构体系\",\"link\":\"/posts/cilium/cilium-intro\"},\"next\":{\"text\":\"Cilium系列三：Cilium在集群网格Cluster Mesh中的实践\",\"link\":\"/posts/cilium/exercise-cluster-mesh\"},\"title\":\"Cilium系列二：使用bird和cilium部署BGP模式的k8s集群\",\"description\":\"这是使用 Cilium BGP 控制平面 (BGP CP) 向外部 BGP 路由器通告路由以及在两个集群之间路由的演示。 每个集群执行以下操作：\\n1. 运行 2 个作为部署进行管理的 nginx po\"}},{\"route\":\"/posts/cilium/cilium-gateway-api\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/kubernetes-gateway-api-cilium.jpg\",\"date\":\"2024-02-21 16:00:00\",\"tag\":[\"Cilium\",\"网络\",\"cni\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Cilium系列四：Cilium集成kubeOVN安装k8s集群\",\"link\":\"/posts/cilium/install-cluster-with-kubeOVN\"},\"title\":\"Cilium系列五：Cilium集成Gateway API\",\"description\":\" 前置条件\\n- Cilium 必须配置为启用 NodePort，使用 `nodePort.enabled=true` 或使用 `kubeProxyReplacement=true`或者`kubePro\"}},{\"route\":\"/posts/cilium/cilium-intro\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cilium.io/static/620dc85c97b669d3417218f1602224df/905a7/intro.webp\",\"date\":\"2024-02-03 16:00:00\",\"tag\":[\"Cilium\",\"网络\",\"cni\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Cilium系列二：使用bird和cilium部署BGP模式的k8s集群\",\"link\":\"/posts/cilium/bgp-exercise-bird-cilium\"},\"title\":\"Cilium系列一：Cilium架构体系\",\"description\":\"Cilium 是一款开源软件，也是 CNCF 的孵化项目，目前已有公司提供商业化支持，还有基于 Cilium 实现的服务网格解决方案。最初它仅是作为一个 Kubernetes 网络组件。Cilium \"}},{\"route\":\"/posts/cilium/exercise-cluster-mesh\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/cluster-mesh.png\",\"date\":\"2024-02-06 16:00:00\",\"tag\":[\"Cilium\",\"网络\",\"cni\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Cilium系列二：使用bird和cilium部署BGP模式的k8s集群\",\"link\":\"/posts/cilium/bgp-exercise-bird-cilium\"},\"next\":{\"text\":\"Cilium系列四：Cilium集成kubeOVN安装k8s集群\",\"link\":\"/posts/cilium/install-cluster-with-kubeOVN\"},\"title\":\"Cilium系列三：Cilium在集群网格Cluster Mesh中的实践\",\"description\":\"Cilium Cluster Mesh 允许您连接多个集群的网络，只要所有集群都运行 Cilium 作为其 CNI，每个集群中的 pod 都可以发现和访问网格中所有其他集群中的服务。这允许有效地将多个\"}},{\"route\":\"/posts/cilium/install-cluster-with-kubeOVN\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/cilium-kubeOVN-cover.png\",\"date\":\"2024-02-19 16:00:00\",\"tag\":[\"Cilium\",\"网络\",\"cni\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Cilium系列三：Cilium在集群网格Cluster Mesh中的实践\",\"link\":\"/posts/cilium/exercise-cluster-mesh\"},\"next\":{\"text\":\"Cilium系列五：Cilium集成Gateway API\",\"link\":\"/posts/cilium/cilium-gateway-api\"},\"title\":\"Cilium系列四：Cilium集成kubeOVN安装k8s集群\",\"description\":\" 前提条件\\n- helm\\n- sealos二进制cli\\n- kubeOVN的安装脚本`install.sh`\\n节点规划如下：\\n|角色| 节点IP |集群版本|\\n|----|-------|------\"}},{\"route\":\"/posts/dragonfly/dragonfly-intro\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/dragonfly_cover.jpg\",\"date\":\"2024-01-06 16:00:00\",\"tag\":[\"P2P\",\"Dragonfly\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Dragonfly系列二：Dragonfly 和 Nydus Mirror 模式集成实践\",\"link\":\"/posts/dragonfly/exercise-dragonfly-with-nydus\"},\"title\":\"Dragonfly系列一：Dragonfly架构体系\",\"description\":\"Dragonfly是一个基于P2P的开源文件分发和图像加速系统。 它由云原生计算基金会 (CNCF) 作为孵化级项目托管。 其目标是解决云原生架构中的所有分发问题。 目前 Dragonfly 的重点是\"}},{\"route\":\"/posts/dragonfly/exercise-dragonfly-with-nydus\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/dragonfly_cover.jpg\",\"date\":\"2024-01-08 16:00:00\",\"tag\":[\"P2P\",\"Dragonfly\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Dragonfly系列一：Dragonfly架构体系\",\"link\":\"/posts/dragonfly/dragonfly-intro\"},\"title\":\"Dragonfly系列二：Dragonfly 和 Nydus Mirror 模式集成实践\",\"description\":\"`Nydus` 作为 `Dragonfly` 的子项目优化了 `OCIv1` 镜像格式，并以此设计了一个镜像文件系统， 使容器可以按需下载镜像，不再需要下载完整镜像即可启动容器。 在最新版本中 `Dr\"}},{\"route\":\"/posts/interview/tcp-基础认识\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/lazer.png\",\"author\":\"皮特ᴾᵗ\",\"date\":\"2024-02-09 16:00:00\",\"categories\":[\"TCP\",\"面试\"],\"prev\":{\"text\":\"面试系列之：TCP篇\",\"link\":\"/posts/interview/tcp\"},\"title\":\"面试系列之：TCP基础认识\",\"tag\":[\"TCP\",\"面试\"],\"description\":\" TCP 头格式有哪些？\\n我们先来看看 TCP 头的格式，标注颜色的表示与本文关联比较大的字段，其他字段不做详细阐述。\\n序列号：在建立连接时由计算机生成的随机数作为其初始值，通过`SYN`包传给接收端\"}},{\"route\":\"/posts/interview/tcp\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/lazer.png\",\"author\":\"皮特ᴾᵗ\",\"date\":\"2024-02-02 01:04:00\",\"categories\":[\"TCP\",\"面试\"],\"next\":{\"text\":\"面试系列之：TCP基础认识\",\"link\":\"/posts/interview/tcp-基础认识\"},\"title\":\"面试系列之：TCP篇\",\"tag\":[\"TCP\",\"面试\"],\"description\":\" 框架图\\n<script setup\\n  import XmindViewer from '../../.vitepress/theme/components/XmindViewer.vue'\\n</s\"}},{\"route\":\"/posts/jaeger/exercise-jaeger-in-prod\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/Jaeger-cover1.jpg\",\"date\":\"2023-05-10 16:00:00\",\"author\":\"意琦行\",\"tag\":[\"Jaeger\",\"分布式链路追踪\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Jaeger系列一：Jaeger 在 gin 框架和 gRPC 中的使用\",\"link\":\"/posts/jaeger/jaeger-in-gin-and-grpc\"},\"title\":\"Jaeger系列二：Jaeger线上环境部署\",\"description\":\"本文主要记录了如何在生产环境中部署Jaeger各个组件，包括 `Agent`、`Collector`、`Query`、`Storage` 等等。\\n  概述\\n测试部署时有官方提供的 `all-in-on\"}},{\"route\":\"/posts/jaeger/jaeger-in-gin-and-grpc\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/Jaeger-cover1.jpg\",\"date\":\"2023-05-03 16:00:00\",\"author\":\"意琦行\",\"tag\":[\"Jaeger\",\"分布式链路追踪\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Jaeger系列二：Jaeger线上环境部署\",\"link\":\"/posts/jaeger/exercise-jaeger-in-prod\"},\"title\":\"Jaeger系列一：Jaeger 在 gin 框架和 gRPC 中的使用\",\"description\":\"本文通过简单的例子记录了如何在 gin 框架和 gRPC 中使用 Jaeger 进行链路追踪。\\n `Gin`\\n通过 `Middleware` 可以追踪到最外层的 `Handler`，更深层方法需要追踪\"}},{\"route\":\"/posts/kubeOVN/kubeOVN-intro\",\"meta\":{\"sidebar\":false,\"date\":\"2023-12-10 16:00:00\",\"tag\":[\"KubeOVN\",\"网络\",\"cni\",\"SDN\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"KubeOVN系列二：配置VPC网关连通外部公网\",\"link\":\"/posts/kubeOVN/vpc-nat-gateway-config\"},\"title\":\"KubeOVN系列一：KubeOVN架构体系\",\"description\":\"总体来看，Kube-OVN 作为 Kubernetes 和 OVN 之间的一个桥梁，将成熟的 SDN 和云原生相结合。 这意味着 Kube-OVN 不仅通过 OVN 实现了 Kubernetes 下的\",\"cover\":\"https://kubeovn.github.io/docs/v1.12.x/static/architecture.png\"}},{\"route\":\"/posts/kubeOVN/vpc-nat-gateway-config\",\"meta\":{\"sidebar\":false,\"date\":\"2023-12-12 16:00:00\",\"tag\":[\"KubeOVN\",\"网络\",\"cni\",\"SDN\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"KubeOVN系列一：KubeOVN架构体系\",\"link\":\"/posts/kubeOVN/kubeOVN-intro\"},\"title\":\"KubeOVN系列二：配置VPC网关连通外部公网\",\"description\":\"Kube-OVN 支持多租户隔离级别的 VPC 网络。不同 VPC 网络相互独立，可以分别配置 Subnet 网段， 路由策略，安全策略，出网网关，EIP 等配置。\\n\\n 创建自定义VPC\\n按照命名空间\",\"cover\":\"https://kubeovn.github.io/docs/v1.12.x/static/network-topology.png\"}},{\"route\":\"/posts/kubevela/addon-build-instruction\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background4.jpeg\",\"date\":\"2023-10-17 16:00:00\",\"author\":\"姜洪烨\",\"tag\":[\"Kubevela\",\"应用交付\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevela系列三：Application Controller 源码分析(下)\",\"link\":\"/posts/kubevela/application-controller-source-code-analysis-2\"},\"next\":{\"text\":\"Kubevela系列五：Kubevela集成多集群OCM\",\"link\":\"/posts/kubevela/kubevela-integrate-multicluster-ocm\"},\"title\":\"Kubevela系列四：插件指南-轻松扩展你的平台专属能力\",\"description\":\"KubeVela 插件（addon）可以方便地扩展 KubeVela 的能力。正如我们所知，KubeVela 是一个微内核高度可扩展的平台，用户可以通过 模块定义（Definition）扩展 Kube\"}},{\"route\":\"/posts/kubevela/application-controller-source-code-analysis-1\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/k8s-1.jpeg\",\"date\":\"2023-09-21 16:00:00\",\"author\":\"意琦行\",\"tag\":[\"Kubevela\",\"应用交付\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevela系列一：初识 KubeVela，基于 OAM 模型的应用交付平台\",\"link\":\"/posts/kubevela/get-to-know-kubevela\"},\"next\":{\"text\":\"Kubevela系列三：Application Controller 源码分析(下)\",\"link\":\"/posts/kubevela/application-controller-source-code-analysis-2\"},\"title\":\"Kubevela系列二：Application Controller 源码分析(上)\",\"description\":\"本文主要分析 KubeVela 中的 App Controller 部分源码，分享 app 对象 apply 到集群之后 KubeVela 的运作流程，从而更好的理解 KubeVela。\\n本文旨在通过\"}},{\"route\":\"/posts/kubevela/application-controller-source-code-analysis-2\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/k8s-2.jpeg\",\"date\":\"2023-09-22 16:00:00\",\"author\":\"意琦行\",\"tag\":[\"Kubevela\",\"应用交付\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevela系列二：Application Controller 源码分析(上)\",\"link\":\"/posts/kubevela/application-controller-source-code-analysis-1\"},\"next\":{\"text\":\"Kubevela系列四：插件指南-轻松扩展你的平台专属能力\",\"link\":\"/posts/kubevela/addon-build-instruction\"},\"title\":\"Kubevela系列三：Application Controller 源码分析(下)\",\"description\":\"本文主要分析 KubeVela 中的 App Controller 部分源码，分享 app 对象 apply 到集群之后 KubeVela 的运作流程，从而更好的理解 KubeVela。\\n本文旨在通过\"}},{\"route\":\"/posts/kubevela/get-to-know-kubevela\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/kubevela-cover1-application.png\",\"date\":\"2023-09-08 16:00:00\",\"author\":\"意琦行\",\"tag\":[\"Kubevela\",\"应用交付\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Kubevela系列二：Application Controller 源码分析(上)\",\"link\":\"/posts/kubevela/application-controller-source-code-analysis-1\"},\"title\":\"Kubevela系列一：初识 KubeVela，基于 OAM 模型的应用交付平台\",\"description\":\"本文主要介绍了 KubeVela 是什么，解决了什么问题，以及如何解决的。\\n Kubevela介绍\\n Kubevela是什么\\n:::info 以下是 KubeVela 官网的描述：\\nKubeVela \"}},{\"route\":\"/posts/kubevela/kubevela-integrate-multicluster-with-ocm\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background6.jpeg\",\"date\":\"2023-10-19 16:00:00\",\"tag\":[\"Kubevela\",\"应用交付\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevela系列四：插件指南-轻松扩展你的平台专属能力\",\"link\":\"/posts/kubevela/addon-build-instruction\"},\"title\":\"Kubevela系列五：Kubevela集成多集群OCM\",\"description\":\"本章节将会介绍如何使用 KubeVela 分发多集群应用。\\n 简介\\n如今，在越来越多的场景下，开发者和系统运维人员开始将应用部署在多个集群中：\\n* 由于 Kubernetes 集群存在着部署规模的局限\"}},{\"route\":\"/posts/kubevirt/hotplug-interface\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background2.jpg\",\"date\":\"2023-10-02 16:00:00\",\"tag\":[\"Kubevirt\",\"虚拟机\",\"kubernetes\"],\"sticky\":1,\"prev\":{\"text\":\"Kubevirt系列一：虚拟机CentOS 7部署实践\",\"link\":\"/posts/kubevirt/quick-deploy-centos7\"},\"title\":\"Kubevirt系列二：虚拟机网卡热插拔\",\"description\":\" 设计动机\\n向正在运行的虚拟机热插拔/热拔出（添加/删除）NIC 是可用于多个平台的行业标准，允许动态连接 L2 网络。 当工作负载 (VM) 在连接/删除网络时无法容忍重新启动时，或者例如在网络之前\"}},{\"route\":\"/posts/kubevirt/quick-deploy-centos7\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/aliyun-image-source.png\",\"date\":\"2023-09-30 16:00:00\",\"tag\":[\"Kubevirt\",\"虚拟机\",\"kubernetes\"],\"sticky\":1,\"next\":{\"text\":\"Kubevirt系列二：虚拟机网卡热插拔\",\"link\":\"/posts/kubevirt/hotplug-interface\"},\"title\":\"Kubevirt系列一：虚拟机CentOS 7部署实践\",\"description\":\"俗话说，实践是检验真理的唯一标准，不妨让我们尝试用kubeVirt部署一台属于自己的虚拟机吧~\\n 准备环境\\n首先，我们需要安装`libvirt`和`qemu`，\\n```shell\\nyum instal\"}},{\"route\":\"/posts/linux/centos7-upgrade-to-stream9\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/algorithm-1.jpeg\",\"date\":\"2024-01-31 16:00:00\",\"tag\":[\"虚拟机\",\"linux\"],\"title\":\"CentOS 7 升级至 CentOS Stream 9 操作教程\",\"description\":\"本操作教程仓库地址：https://github.com/hyperter96/OhMyStream9，所有Shell脚本在`scripts`目录下。\\n CentOS 7 升级至 CentOS 8\\n:\"}},{\"route\":\"/posts/linux/install-vm-centos-stream9\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/algorithm-1.jpeg\",\"date\":\"2024-02-06 16:00:00\",\"tag\":[\"虚拟机\",\"linux\"],\"title\":\"VMware安装CentOS Stream 9\",\"description\":\" 下载Linux镜像\\n下载地址：centos-stream-9-stream-BaseOS-x86_64-iso安装包下载_开源镜像站-阿里云 (aliyun.com)\\n 创建新的虚拟机\\n也可以点击文\"}},{\"route\":\"/posts/mysql/mysql-infra\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/mysql-cover.jpg\",\"date\":\"2024-05-02 16:00:00\",\"sticky\":1,\"tags\":[\"kubernetes\",\"MySQL\"],\"title\":\"MySQL知识系列一：MySQL架构图\",\"tag\":[\"kubernetes\",\"MySQL\"],\"description\":\"Mysql服务端架构分为Server层和存储引擎层（可插拔式），Server层主要包含了连接器、缓存模块、分析器、优化器、执行器；可插拔的存储引擎主要有InnoDB、MyISAM、Memory。当一个\"}},{\"route\":\"/posts/troubleshooting/k8s-pod-abnormal-analysis\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/k8s-2.jpeg\",\"categories\":[\"kubernetes\"],\"date\":\"2023-05-06 03:45:56\",\"tags\":[\"kubernetes\",\"故障分析\"],\"title\":\"K8S故障分析系列一：基于真实场景解读K8S_Pod的各种异常\",\"tag\":[\"kubernetes\",\"故障分析\"],\"description\":\" Pod 生命周期\\n在整个生命周期中，Pod 会出现 5 种阶段（Phase）。\\n- Pending：Pod 被 K8s 创建出来后，起始于 Pending 阶段。在 Pending 阶段，Pod 将\"}},{\"route\":\"/posts/velero/intro-and-practice\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/velero-cover.png\",\"date\":\"2024-01-04 16:00:00\",\"tag\":[\"Velero\",\"备份恢复\",\"kubernetes\"],\"sticky\":1,\"title\":\"利用Velero对K8S备份还原与集群迁移实战\",\"description\":\" 简介\\nVelero 是一款云原生时代的灾难恢复和迁移工具，采用 Go 语言编写，并在 github 上进行了开源，利用 velero 用户可以安全的备份、恢复和迁移 Kubernetes 集群资源和\"}},{\"route\":\"/posts/programming/go/array-and-slices\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover1-slices.jpeg\",\"date\":\"2022-07-01 16:00:00\",\"tag\":[\"Go\",\"编程基础\"],\"sticky\":1,\"next\":{\"text\":\"Go 基础知识系列二: 协程\",\"link\":\"/posts/programming/go/goroutine\"},\"title\":\"Go 基础知识系列一: 数组与切片\",\"description\":\"这篇文章总结了 Go 的知识体系数组与切片，包括其中的底层实现等等。\\n:::warning 注意\\n说起 Golang， 大家都会第一时间想到高并发和 Golang 作为主流的后端开发语言的优势，本文主\"}},{\"route\":\"/posts/programming/go/channel\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover1-slices.jpeg\",\"date\":\"2022-07-07 16:00:00\",\"tag\":[\"Go\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Go 基础知识系列四：接口interface\",\"link\":\"/posts/programming/go/interface\"},\"next\":{\"text\":\"Go 基础知识系列六：互斥锁mutex\",\"link\":\"/posts/programming/go/mutex\"},\"title\":\"Go 基础知识系列五：Channel\",\"description\":\" 什么是 channel 管道\\n它是一个数据管道，可以往里面写数据，从里面读数据。\\nchannel 是 goroutine 之间数据通信桥梁，而且是线程安全的。\\nchannel 遵循先进先出原则。\\n写\"}},{\"route\":\"/posts/programming/go/defer\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover1-slices.jpeg\",\"date\":\"2022-07-12 16:00:00\",\"tag\":[\"Go\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Go 基础知识系列六：互斥锁mutex\",\"link\":\"/posts/programming/go/mutex\"},\"title\":\"Go 基础知识系列七：延迟函数调用Defer\",\"description\":\"`defer`语句用于延迟函数的调用，每次`defer`都会把一个函数压入栈中，函数返回前再把延迟的函数取出并执行。\\n为了方便描述，我们把创建`defer`的函数称为主函数，`defer`语句后面的函\"}},{\"route\":\"/posts/programming/go/goroutine\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover2-goroutine.jpeg\",\"date\":\"2022-07-02 16:00:00\",\"tag\":[\"Go\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Go 基础知识系列一: 数组与切片\",\"link\":\"/posts/programming/go/array-and-slices\"},\"next\":{\"text\":\"Go 基础知识系列三: 等待组waitGroup\",\"link\":\"/posts/programming/go/waitgroup\"},\"title\":\"Go 基础知识系列二: 协程\",\"description\":\"这篇文章总结了 Go 的知识体系：协程，包括其中的底层实现等等。\\n 协程(coroutine)\\n在讲 goroutine 之前让我们先了解一下协程 (coroutine)，和线程类似，共享堆，不共享栈\"}},{\"route\":\"/posts/programming/go/interface\",\"meta\":{\"sidebar\":false,\"cover\":\"https://hyper2t.github.io/interface/featured-image.jpeg\",\"date\":\"2022-07-05 16:00:00\",\"tag\":[\"Go\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Go 基础知识系列三: 等待组waitGroup\",\"link\":\"/posts/programming/go/waitgroup\"},\"next\":{\"text\":\"Go 基础知识系列五：Channel\",\"link\":\"/posts/programming/go/channel\"},\"title\":\"Go 基础知识系列四：接口interface\",\"description\":\"这篇文章总结了 Golang 的知识体系: `interface`，包括其中的底层实现等等。\\n:::warning 注意📢：\\n说起 Golang， 大家都会第一时间想到高并发和 Golang 作为主\"}},{\"route\":\"/posts/programming/go/mutex\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/go-cover1-slices.jpeg\",\"date\":\"2022-07-09 16:00:00\",\"tag\":[\"Go\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Go 基础知识系列五：Channel\",\"link\":\"/posts/programming/go/channel\"},\"next\":{\"text\":\"Go 基础知识系列七：延迟函数调用Defer\",\"link\":\"/posts/programming/go/defer\"},\"title\":\"Go 基础知识系列六：互斥锁mutex\",\"description\":\" `sync.Mutex` 互斥锁\\n`sync.Mutex` 是一个互斥锁，它的作用就是保护临界区，确保同一时间只有一个 Go 协程进入临界区。\\n什么是临界区？为什么有临界区？\\n\\n>\\n> 防止多个协程\"}},{\"route\":\"/posts/programming/go/waitgroup\",\"meta\":{\"sidebar\":false,\"cover\":\"https://hyper2t.github.io/waitgroup/featured-image.jpeg\",\"date\":\"2022-07-03 16:00:00\",\"tag\":[\"Go\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Go 基础知识系列二: 协程\",\"link\":\"/posts/programming/go/goroutine\"},\"next\":{\"text\":\"Go 基础知识系列四：接口interface\",\"link\":\"/posts/programming/go/interface\"},\"title\":\"Go 基础知识系列三: 等待组waitGroup\",\"description\":\"这篇文章总结了 Golang 的知识体系: `waitGroup`，包括其中的底层实现等等。\\n很多情况下，我们正需要知道 `goroutine` 是否完成。这需要借助 `sync` 包的 `WaitG\"}},{\"route\":\"/posts/programming/rust/borrowing\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover8.jpg\",\"date\":\"2023-11-08 16:00:00\",\"tag\":[\"Rust\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Rust基础知识系列七：所有权\",\"link\":\"/posts/programming/rust/ownership\"},\"title\":\"Rust基础知识系列八：引用与借用\",\"description\":\"上节中提到，如果仅仅支持通过转移所有权的方式获取一个值，那会让程序变得复杂。 Rust 能否像其它编程语言一样，使用某个变量的指针或者引用呢？答案是可以。\\nRust 通过 借用(Borrowing) \"}},{\"route\":\"/posts/programming/rust/disable-warning\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/background3.jpeg\",\"date\":\"2023-10-31 16:00:00\",\"tag\":[\"Rust\",\"编程基础\"],\"title\":\"如何在Rust示例中禁用未使用的代码警告\",\"description\":\" 错误提示\\n在Rust代码中，有时你声明了一个变量、类型或定义了一些东西，但在代码中从未使用过，这时就会抛出一个错误。\\n比如说。\\n你声明了一个结构体，但从未构造过字段\\n```rust\\nstruct E\"}},{\"route\":\"/posts/programming/rust/fundamental-type\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover3.jpg\",\"date\":\"2023-11-03 16:00:00\",\"tag\":[\"Rust\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Rust基础知识系列二：语句、表达式、格式化输出\",\"link\":\"/posts/programming/rust/statement-expr-print\"},\"next\":{\"text\":\"Rust基础知识系列四：变量绑定\",\"link\":\"/posts/programming/rust/variable-bindings\"},\"title\":\"Rust基础知识系列三：数据基础类型\",\"description\":\" 数组和切片\\n数组（array）是一组拥有相同类型 T 的对象的集合，在内存中是连续存储的。数组使用中括号 `[]` 来创建，且它们的大小在编译时会被确定。数组的类型标记为 `[T; length]`\"}},{\"route\":\"/posts/programming/rust/get-to-know-cargo\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover.png\",\"date\":\"2023-11-01 16:00:00\",\"tag\":[\"Rust\",\"编程基础\"],\"sticky\":1,\"next\":{\"text\":\"Rust基础知识系列二：语句、表达式、格式化输出\",\"link\":\"/posts/programming/rust/statement-expr-print\"},\"title\":\"Rust基础知识系列一：认识Cargo\",\"description\":\"作为一门现代化语言，Rust 吸收了多个语言的包管理优点，为大家提供超级大杀器： `cargo`，真的，再挑剔的开发者，都对它赞不绝口。👍\\n总而言之，`cargo` 提供了一系列的工具，从项目的建立\"}},{\"route\":\"/posts/programming/rust/ownership\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover7.jpg\",\"date\":\"2023-11-07 16:00:00\",\"tag\":[\"Rust\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Rust基础知识系列六：函数\",\"link\":\"/posts/programming/rust/rust-function\"},\"next\":{\"text\":\"Rust基础知识系列八：引用与借用\",\"link\":\"/posts/programming/rust/borrowing\"},\"title\":\"Rust基础知识系列七：所有权\",\"description\":\"所有的程序都必须和计算机内存打交道，如何从内存中申请空间来存放程序的运行内容，如何在不需要的时候释放这些空间，成了重中之重，也是所有编程语言设计的难点之一。在计算机语言不断演变过程中，出现了三种流派：\"}},{\"route\":\"/posts/programming/rust/rust-function\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover6.jpeg\",\"date\":\"2023-11-06 16:00:00\",\"tag\":[\"Rust\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Rust基础知识系列五：类型系统\",\"link\":\"/posts/programming/rust/types-system\"},\"next\":{\"text\":\"Rust基础知识系列七：所有权\",\"link\":\"/posts/programming/rust/ownership\"},\"title\":\"Rust基础知识系列六：函数\",\"description\":\"Rust 的函数我们在之前已经见过不少，跟其他语言几乎没有什么区别。因此本章的学习之路将轻松和愉快，骚年们，请珍惜这种愉快，下一章你将体验到不一样的 Rust。\\n在函数界，有一个函数只闻其名不闻其声，\"}},{\"route\":\"/posts/programming/rust/statement-expr-print\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover2.png\",\"date\":\"2023-11-02 16:00:00\",\"tag\":[\"Rust\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Rust基础知识系列一：认识Cargo\",\"link\":\"/posts/programming/rust/get-to-know-cargo\"},\"next\":{\"text\":\"Rust基础知识系列三：数据基础类型\",\"link\":\"/posts/programming/rust/fundamental-type\"},\"title\":\"Rust基础知识系列二：语句、表达式、格式化输出\",\"description\":\"Rust 的函数体是由一系列语句组成，最后由一个表达式来返回值，例如：\\n```rust\\nfn add_with_extra(x: i32, y: i32) -\\n    let x = x + 1; /\"}},{\"route\":\"/posts/programming/rust/types-system\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover5.jpg\",\"date\":\"2023-11-05 16:00:00\",\"tag\":[\"Rust\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Rust基础知识系列四：变量绑定\",\"link\":\"/posts/programming/rust/variable-bindings\"},\"next\":{\"text\":\"Rust基础知识系列六：函数\",\"link\":\"/posts/programming/rust/rust-function\"},\"title\":\"Rust基础知识系列五：类型系统\",\"description\":\"Rust 提供了多种机制，用于改变或定义原生类型和用户定义类型。接下来会讲到：\\n- 原生类型的类型转换（cast）。\\n- 指定字面量的类型。\\n- 使用类型推断（type inference）。\\n- 给\"}},{\"route\":\"/posts/programming/rust/variable-bindings\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-cover4.jpg\",\"date\":\"2023-11-04 16:00:00\",\"tag\":[\"Rust\",\"编程基础\"],\"sticky\":1,\"prev\":{\"text\":\"Rust基础知识系列三：数据基础类型\",\"link\":\"/posts/programming/rust/fundamental-type\"},\"next\":{\"text\":\"Rust基础知识系列五：类型系统\",\"link\":\"/posts/programming/rust/types-system\"},\"title\":\"Rust基础知识系列四：变量绑定\",\"description\":\"Rust 通过静态类型确保类型安全。变量绑定可以在声明时说明类型，不过在多数情况下，编译器能够从上下文推导出变量的类型，从而大大减少了类型说明的工作。\\n使用 `let` 绑定操作可以将值（比如字面量）\"}},{\"route\":\"/posts/programming/webassembly/run-wasm-app-from-host\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-and-wasm-cover.png\",\"date\":\"2024-03-10 16:00:00\",\"tag\":[\"Rust\",\"WebAssembly\",\"全栈开发\"],\"sticky\":1,\"prev\":{\"text\":\"WebAssembly系列一：Rust Web 全栈开发之编写 WebAssembly 应用\",\"link\":\"/posts/programming/webassembly/webassembly-full-stack-app\"},\"title\":\"WebAssembly系列二：使用 WasmEdge Rust SDK 构建并运行 WebAssembly 应用程序\",\"description\":\"在本文中，我们将介绍如何创建 WebAssembly 应用程序[^wasm]（也是 wasm 应用程序）以及如何在 WasmEdge 运行时上运行它。\\n\\n^wasm]: [WebAssembly 应用\"}},{\"route\":\"/posts/programming/webassembly/webassembly-full-stack-app\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/rust-and-wasm-cover.png\",\"date\":\"2024-03-01 16:00:00\",\"tag\":[\"Rust\",\"WebAssembly\",\"全栈开发\"],\"sticky\":1,\"next\":{\"text\":\"WebAssembly系列二：使用 WasmEdge Rust SDK 构建并运行 WebAssembly 应用程序\",\"link\":\"/posts/programming/webassembly/run-wasm-app-from-host\"},\"title\":\"WebAssembly系列一：Rust Web 全栈开发之编写 WebAssembly 应用\",\"description\":\" WebAssembly介绍\\n 什么是 WebAssembly？\\nWebAssembly 是一种新的编码方式，可以在现代浏览器中运行\\n- 它是一种低级的类汇编语言\\n- 具有紧凑的二进制格式\\n- 可以接\"}},{\"route\":\"/posts/programming/go/client-go/api-machinery\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg\",\"author\":\"熬小剑\",\"date\":\"2023-01-11 16:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"prev\":{\"text\":\"Client-go系列四: Informer实战\",\"link\":\"/posts/programming/go/client-go/informer-exercise\"},\"next\":{\"text\":\"Client-go系列六：Client-go类库（上）\",\"link\":\"/posts/programming/go/client-go/client-go-pkg-part1\"},\"title\":\"Client-go系列五：API Machinery\",\"description\":\"本章探讨了 Kubernetes API Machinery，它提供了用于处理遵循 Kubernetes API 对象约定的API对象的实用工具。这些约定包括：\\n- API对象嵌入了一个共同的元数据结\"}},{\"route\":\"/posts/programming/go/client-go/client-go-pkg-part1\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg\",\"author\":\"熬小剑\",\"date\":\"2023-01-20 16:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"prev\":{\"text\":\"Client-go系列五：API Machinery\",\"link\":\"/posts/programming/go/client-go/api-machinery\"},\"next\":{\"text\":\"Client-go系列七：Client-go类库（下）\",\"link\":\"/posts/programming/go/client-go/client-go-pkg-part2\"},\"title\":\"Client-go系列六：Client-go类库（上）\",\"description\":\"本章探讨了 Client-go 库，它是一个高级别库，开发者可以使用 Go 语言与 Kubernetes API 进行交互。Client-go 库汇集了 Kubernetes API 和 API Ma\"}},{\"route\":\"/posts/programming/go/client-go/client-go-pkg-part2\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg\",\"author\":\"熬小剑\",\"date\":\"2023-01-24 16:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"prev\":{\"text\":\"Client-go系列六：Client-go类库（上）\",\"link\":\"/posts/programming/go/client-go/client-go-pkg-part1\"},\"title\":\"Client-go系列七：Client-go类库（下）\",\"description\":\" 删除资源\\n要从集群中删除资源，可以对你要删除的资源使用删除方法。例如，要从 `project1` 命名空间中删除一个名为 `nginx-pod` 的 Pod，可以使用：\\n```go\\nerr = cl\"}},{\"route\":\"/posts/programming/go/client-go/clientset\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg\",\"date\":\"2022-12-21 16:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"prev\":{\"text\":\"Client-go系列一: Client-go知识体系\",\"link\":\"/posts/programming/go/client-go/intro\"},\"next\":{\"text\":\"Client-go系列三：认识Informer\",\"link\":\"/posts/programming/go/client-go/informer\"},\"title\":\"Client-go系列二: 认识ClientSet\",\"description\":\"\\n ClientSet 简介\\n`ClientSet`使用预生成的 API 对象来与 kube-apiserver 进行交互，类似于 RPC 的变成体验，好处是类型化的客户端使用程序编译来强制执行数据安\"}},{\"route\":\"/posts/programming/go/client-go/informer-exercise\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg\",\"date\":\"2023-01-06 16:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"prev\":{\"text\":\"Client-go系列三: 认识Informer\",\"link\":\"/posts/programming/go/client-go/informer\"},\"next\":{\"text\":\"Client-go系列五：API Machinery\",\"link\":\"/posts/programming/go/client-go/api-machinery\"},\"title\":\"Client-go系列四：Informer实战\",\"description\":\"利用 `Informer` 机制来开发一个简单的 `controller` 来清理 kubernetes 集群内异常状态的 pod .\\n 背景\\n平时 kubernetes 集群经常出现各种 pod 状\"}},{\"route\":\"/posts/programming/go/client-go/informer\",\"meta\":{\"sidebar\":false,\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-cover.jpeg\",\"date\":\"2022-12-24 16:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"prev\":{\"text\":\"Client-go系列二: 认识ClientSet\",\"link\":\"/posts/programming/go/client-go/clientset\"},\"next\":{\"text\":\"Client-go系列四：Informer实战\",\"link\":\"/posts/programming/go/client-go/informer-exercise\"},\"title\":\"Client-go系列三：认识Informer\",\"description\":\"Informer 对于实现 kubernetes 的 `controller` 模式非常重要.\\n Informer 简介\\n\\n>\\n> 这显然是不合理的，实际上除了常用的 CRUD 操作之外，我们还需要进\"}},{\"route\":\"/posts/programming/go/client-go/intro\",\"meta\":{\"sidebar\":false,\"date\":\"2022-10-01 16:00:00\",\"tag\":[\"Go\",\"Client-go\"],\"sticky\":1,\"next\":{\"text\":\"Client-go系列二: 认识ClientSet\",\"link\":\"/posts/programming/go/client-go/clientset\"},\"title\":\"Client-go系列一：Client-go知识体系\",\"description\":\"初步认识 Client-go 主体框架.\\n 关于client-go\\n`client-go`是kubernetes官方提供的go语言的客户端库，go应用使用该库可以访问kubernetes的API Se\",\"cover\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/client-go-image.png\"}}],\"footer\":{\"copyright\":\"MIT License | 皮特ᴾᵗ\"},\"themeColor\":\"vp-green\",\"author\":\"皮特ᴾᵗ\",\"friend\":[{\"nickname\":\"皮特ᴾᵗ\",\"des\":\"你的指尖用于改变世界的力量\",\"avatar\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog@gh-pages/selfie.jpeg\",\"url\":\"https://cs.hyperter.top\"},{\"nickname\":\"意琦行\",\"des\":\"指月小筑(探索云原生)\",\"avatar\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/yiqixing.jpg\",\"url\":\"https://www.lixueduan.com/\"},{\"nickname\":\"熬小剑\",\"des\":\"Service Mesh布道师, 云原生布道师, Dapr Approver\",\"avatar\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/skyao.png\",\"url\":\"https://skyao.io/\"},{\"nickname\":\"原子之音\",\"des\":\"C++ Rust Unreal大家加油\",\"avatar\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/yuanZiZhiYin.jpg\",\"url\":\"https://space.bilibili.com/437860379\"}],\"comment\":{\"repo\":\"hyperter96/tech-blog\",\"repoId\":\"R_kgDOLckbDg\",\"category\":\"General\",\"categoryId\":\"DIC_kwDOLckbDs4CdyEa\",\"label\":\"评论\",\"icon\":\"<svg enable-background=\\\"new 0 0 512 512\\\" height=\\\"512px\\\" id=\\\"Layer_1\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 512 512\\\" width=\\\"512px\\\" xml:space=\\\"preserve\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\"><path d=\\\"M170.476,166.19h155.097c4.285,0,7.76-3.469,7.76-7.754s-3.475-7.765-7.76-7.765H170.476c-4.285,0-7.754,3.48-7.754,7.765  S166.191,166.19,170.476,166.19z\\\"/><path d=\\\"M348.088,203.362H202.74c-4.284,0-7.759,3.469-7.759,7.754s3.475,7.765,7.759,7.765h145.348c4.284,0,7.754-3.48,7.754-7.765  S352.372,203.362,348.088,203.362z\\\"/><path d=\\\"M306.695,256.052H170.476c-4.285,0-7.754,3.469-7.754,7.754c0,4.284,3.469,7.754,7.754,7.754h136.219  c4.279,0,7.754-3.47,7.754-7.754C314.448,259.521,310.974,256.052,306.695,256.052z\\\"/><path d=\\\"M396.776,86.288H115.225c-29.992,0-54.403,22.562-54.403,50.308v154.83c0,27.735,24.411,50.297,54.403,50.297h166.034  l119.812,83.989v-84.135c27.996-2.038,50.108-23.753,50.108-50.151v-154.83C451.179,108.85,426.768,86.288,396.776,86.288z   M427.906,291.426c0,14.902-13.972,27.025-31.131,27.025h-18.978v62.523l-89.193-62.523h-173.38  c-17.164,0-31.131-12.123-31.131-27.025v-154.83c0-14.913,13.967-27.035,31.131-27.035h281.551  c17.159,0,31.131,12.123,31.131,27.035V291.426z\\\"/></svg>\",\"mobileMinify\":false,\"inputPosition\":\"bottom\",\"lang\":\"zh-CN\",\"mapping\":\"pathname\"},\"hotArticle\":{\"title\":\"🔥 精选文章\",\"nextText\":\"换一组\",\"pageSize\":3,\"empty\":\"暂无精选内容\"},\"popover\":{\"title\":\"公告\",\"mobileMinify\":true,\"body\":[{\"type\":\"text\",\"content\":\"👇微信扫码添加好友👇\"},{\"type\":\"image\",\"src\":\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/qrcode3.png\"},{\"type\":\"button\",\"content\":\"云原生文档\",\"link\":\"https://ikubevirt.cn\"},{\"type\":\"button\",\"content\":\"生活博客\",\"props\":{\"type\":\"success\"},\"link\":\"https://life.hyperter.top\"}],\"duration\":-1},\"buttonAfterArticle\":{\"openTitle\":\"投币\",\"closeTitle\":\"下次一定\",\"content\":\"<img src=\\\"https://cdn.jsdelivr.net/gh/hyperter96/tech-blog/docs/assets/images/wechatpay-code.jpg\\\">\",\"icon\":\"wechatPay\"}},\"sidebar\":[{\"text\":\"\",\"items\":[]}],\"outline\":{\"level\":[2,3],\"label\":\"目录\"},\"returnToTopLabel\":\"回到顶部\",\"sidebarMenuLabel\":\"相关文章\",\"lastUpdatedText\":\"上次更新于\",\"logo\":\"/favicon.ico\",\"editLink\":{\"pattern\":\"https://github.com/hyperter96/tech-blog/tree/main/docs/:path\",\"text\":\"去 GitHub 上编辑内容\"},\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"面试\",\"items\":[{\"text\":\"TCP篇\",\"link\":\"/posts/interview/tcp.html\"}]},{\"text\":\"趣味\",\"items\":[{\"text\":\"逮住那只猫！\",\"link\":\"/fun/catch-the-cat.html\"}]},{\"text\":\"关于我\",\"link\":\"/aboutme.html\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/hyperter96/tech-blog\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>